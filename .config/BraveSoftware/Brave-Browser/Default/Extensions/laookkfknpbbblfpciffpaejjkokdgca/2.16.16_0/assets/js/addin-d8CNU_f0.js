import{u as t}from"./style-TaIEnhS-.js";import{h as e}from"./handlebarLoader-xbtIzd6B.js";import"./ViewState-_YxhE_TX.js";import"./icon-alert--q0yLTMi.js";import"./localStorage-4iHdj-SC.js";import"./preload-helper-DmNsytk6.js";import"./string-GDe0WbEj.js";import"./main-FH8FpKq2.js";const o={1:function(t,e,o,i,s){return'<li>\n\t<span id="add-icon" class="todo-list-add-icon"><i class="icon icon-plus"></i></span>\n\t<input id="list-new" class="todo-input todo-list-add-input" type="text" placeholder="    New List"  autocomplete="off"/>\n\t<span class="loading todo-list-add-loading"><i class="loading-icon"></i> <span >Loading...</span></span>\n'},3:function(t,e,o,i,s){return'\t<div id="list-new" class="upsell-row">\n\t\t<div class="copy">+ New List</div>\n\t\t<span class="badge badge-plus">Plus</span>\n\t</div>\n</li>\n'},compiler:[8,">= 4.3.0"],main:function(t,e,o,i,s){var n,d=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(n=d(o,"if").call(null!=e?e:t.nullContext||{},null!=e?d(e,"isPlus"):e,{name:"if",hash:{},fn:t.program(1,s,0),inverse:t.program(3,s,0),data:s,loc:{start:{line:1,column:0},end:{line:12,column:7}}}))?n:""},useData:!0},i={1:function(t,e,o,i,s){var n,d=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'\t<div class="icon-wrapper more-toggle" data-test="todo-item-dropdown-toggle">\n\t\t'+(null!=(n=(d(o,"iconEllipsis")||e&&d(e,"iconEllipsis")||t.hooks.helperMissing).call(null!=e?e:t.nullContext||{},"more-icon",{name:"iconEllipsis",hash:{},data:s,loc:{start:{line:3,column:2},end:{line:3,column:34}}}))?n:"")+"\n\t</div>\n"},3:function(t,e,o,i,s){var n,d=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(n=d(o,"if").call(null!=e?e:t.nullContext||{},null!=e?d(e,"providerLogo"):e,{name:"if",hash:{},fn:t.program(4,s,0),inverse:t.program(1,s,0),data:s,loc:{start:{line:5,column:0},end:{line:11,column:0}}}))?n:""},4:function(t,e,o,i,s){var n,d=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'\t<div class="project-chooser-toggle"><span class="icon-wrapper control control-dropdown"><img class="provider-icon" src="'+t.escapeExpression("function"==typeof(n=null!=(n=d(o,"providerLogo")||(null!=e?d(e,"providerLogo"):e))?n:t.hooks.helperMissing)?n.call(null!=e?e:t.nullContext||{},{name:"providerLogo",hash:{},data:s,loc:{start:{line:6,column:121},end:{line:6,column:137}}}):n)+'"><svg class="todo-menu-dropdown-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 34 32"><path d="M16,17H2a1,1,0,0,1,0-2H16a1,1,0,0,1,0,2Z"/><path d="M16,10H2A1,1,0,0,1,2,8H16a1,1,0,0,1,0,2Z"/><path d="M16,24H2a1,1,0,0,1,0-2H16a1,1,0,0,1,0,2Z"/><path d="M28.5,19.12a.87.87,0,0,1-.62-.26l-4.5-4.5a.88.88,0,0,1,1.24-1.24L28.5,17l3.88-3.88a.88.88,0,0,1,1.24,1.24l-4.5,4.5A.87.87,0,0,1,28.5,19.12Z"/></svg></span></div>\n'},compiler:[8,">= 4.3.0"],main:function(t,e,o,i,s){var n,d,a=null!=e?e:t.nullContext||{},r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return(null!=(n=r(o,"if").call(a,null!=e?r(e,"iClassName"):e,{name:"if",hash:{},fn:t.program(1,s,0),inverse:t.program(3,s,0),data:s,loc:{start:{line:1,column:0},end:{line:11,column:7}}}))?n:"")+'<div class="dropdown '+t.escapeExpression("function"==typeof(d=null!=(d=r(o,"dropdownClassName")||(null!=e?r(e,"dropdownClassName"):e))?d:t.hooks.helperMissing)?d.call(a,{name:"dropdownClassName",hash:{},data:s,loc:{start:{line:12,column:21},end:{line:12,column:42}}}):d)+'">\n\t<ul class="dropdown-list"></ul>\n\t<ul class="dropdown-list dropdown-detail"></ul>\n</div>\n'},useData:!0},s={1:function(t,e,o,i,s){var n,d=null!=e?e:t.nullContext||{},a=t.hooks.helperMissing,r="function",l=t.escapeExpression,c=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'\t\t<div class="description empty-link" data-target-list-id="'+l(typeof(n=null!=(n=c(o,"targetListId")||(null!=e?c(e,"targetListId"):e))?n:a)===r?n.call(d,{name:"targetListId",hash:{},data:s,loc:{start:{line:4,column:59},end:{line:4,column:75}}}):n)+'" data-use-command="'+l(typeof(n=null!=(n=c(o,"use_command")||(null!=e?c(e,"use_command"):e))?n:a)===r?n.call(d,{name:"use_command",hash:{},data:s,loc:{start:{line:4,column:95},end:{line:4,column:110}}}):n)+'">\n\t\t\t'+l(typeof(n=null!=(n=c(o,"submessage")||(null!=e?c(e,"submessage"):e))?n:a)===r?n.call(d,{name:"submessage",hash:{},data:s,loc:{start:{line:5,column:3},end:{line:5,column:17}}}):n)+'\n\t\t\t<i class="icon icon-angle-right"></i>\n\t\t</div>\n'},3:function(t,e,o,i,s){var n,d=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'\t\t<div class="description">\n\t\t\t'+t.escapeExpression("function"==typeof(n=null!=(n=d(o,"submessage")||(null!=e?d(e,"submessage"):e))?n:t.hooks.helperMissing)?n.call(null!=e?e:t.nullContext||{},{name:"submessage",hash:{},data:s,loc:{start:{line:10,column:3},end:{line:10,column:17}}}):n)+"\n\t\t</div>\n"},compiler:[8,">= 4.3.0"],main:function(t,e,o,i,s){var n,d,a=null!=e?e:t.nullContext||{},r=t.hooks.helperMissing,l="function",c=t.escapeExpression,h=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<li class="empty">\n\t<p class="title empty-title">'+c(typeof(d=null!=(d=h(o,"message")||(null!=e?h(e,"message"):e))?d:r)===l?d.call(a,{name:"message",hash:{},data:s,loc:{start:{line:2,column:30},end:{line:2,column:41}}}):d)+"</p>\n"+(null!=(n=h(o,"if").call(a,null!=e?h(e,"subMessageClickable"):e,{name:"if",hash:{},fn:t.program(1,s,0),inverse:t.program(3,s,0),data:s,loc:{start:{line:3,column:1},end:{line:12,column:8}}}))?n:"")+'\t<button class="button new-todo-button" data-test="todo-new-empty">New '+c(typeof(d=null!=(d=h(o,"listType")||(null!=e?h(e,"listType"):e))?d:r)===l?d.call(a,{name:"listType",hash:{},data:s,loc:{start:{line:13,column:71},end:{line:13,column:83}}}):d)+"</button>\n</li>\n"},useData:!0},n={1:function(t,e,o,i,s){var n,d=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'\t\t<li class="todo-folder-parent">\n\t\t\t<svg class="icon icon-folder" draggable="false" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64"><path d="M0 11C0 7.68629 2.68629 5 6 5H20.8836C22.552 5 24.1451 5.69469 25.2803 6.91729L28.2197 10.0827C29.3549 11.3053 30.948 12 32.6164 12H58C61.3137 12 64 14.6863 64 18V53C64 56.3137 61.3137 59 58 59H6C2.68629 59 0 56.3137 0 53V11Z" /></svg>\n\t\t\t<span>'+t.escapeExpression("function"==typeof(n=null!=(n=d(o,"parentTitle")||(null!=e?d(e,"parentTitle"):e))?n:t.hooks.helperMissing)?n.call(null!=e?e:t.nullContext||{},{name:"parentTitle",hash:{},data:s,loc:{start:{line:5,column:9},end:{line:5,column:24}}}):n)+'</span>\n\t\t\t<svg class="icon icon-tick" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 292.362 292.362"><path d="M286.935 69.377c-3.614-3.617-7.898-5.424-12.848-5.424H18.274c-4.952 0-9.233 1.807-12.85 5.424C1.807 72.998 0 77.279 0 82.228c0 4.948 1.807 9.229 5.424 12.847l127.907 127.907c3.621 3.617 7.902 5.428 12.85 5.428s9.233-1.811 12.847-5.428L286.935 95.074c3.613-3.617 5.427-7.898 5.427-12.847 0-4.948-1.814-9.229-5.427-12.85z"/></svg>\n\t\t</li>\n'},3:function(t,e,o,i,s){return"todo-list-section"},5:function(t,e,o,i,s){var n,d=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<img class="provider-icon list-icon" src="'+t.escapeExpression("function"==typeof(n=null!=(n=d(o,"iconUrl")||(null!=e?d(e,"iconUrl"):e))?n:t.hooks.helperMissing)?n.call(null!=e?e:t.nullContext||{},{name:"iconUrl",hash:{},data:s,loc:{start:{line:11,column:83},end:{line:11,column:94}}}):n)+'">'},compiler:[8,">= 4.3.0"],main:function(t,e,o,i,s){var n,d,a=null!=e?e:t.nullContext||{},r=t.hooks.helperMissing,l=t.escapeExpression,c="function",h=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<ul data-test="'+l((h(o,"lower")||e&&h(e,"lower")||r).call(a,null!=e?h(e,"title"):e,{name:"lower",hash:{},data:s,loc:{start:{line:1,column:15},end:{line:1,column:30}}}))+'" data-folder-id="'+l(typeof(d=null!=(d=h(o,"folderName")||(null!=e?h(e,"folderName"):e))?d:r)===c?d.call(a,{name:"folderName",hash:{},data:s,loc:{start:{line:1,column:48},end:{line:1,column:62}}}):d)+'" class="todo-folder">\n'+(null!=(n=h(o,"if").call(a,null!=e?h(e,"parentTitle"):e,{name:"if",hash:{},fn:t.program(1,s,0),inverse:t.noop,data:s,loc:{start:{line:2,column:1},end:{line:8,column:8}}}))?n:"")+'\t<li class="'+l(typeof(d=null!=(d=h(o,"class")||(null!=e?h(e,"class"):e))?d:r)===c?d.call(a,{name:"class",hash:{},data:s,loc:{start:{line:9,column:12},end:{line:9,column:21}}}):d)+" "+(null!=(n=h(o,"if").call(a,null!=e?h(e,"hasParent"):e,{name:"if",hash:{},fn:t.program(3,s,0),inverse:t.noop,data:s,loc:{start:{line:9,column:22},end:{line:9,column:63}}}))?n:"")+'" data-list-id="'+l(typeof(d=null!=(d=h(o,"listId")||(null!=e?h(e,"listId"):e))?d:r)===c?d.call(a,{name:"listId",hash:{},data:s,loc:{start:{line:9,column:79},end:{line:9,column:89}}}):d)+'">\n\t\t<div class="list-color" style="background-color: '+l(typeof(d=null!=(d=h(o,"color")||(null!=e?h(e,"color"):e))?d:r)===c?d.call(a,{name:"color",hash:{},data:s,loc:{start:{line:10,column:51},end:{line:10,column:60}}}):d)+'">&nbsp;</div>\n\t\t<span class="list-name">'+(null!=(n=h(o,"if").call(a,null!=e?h(e,"iconUrl"):e,{name:"if",hash:{},fn:t.program(5,s,0),inverse:t.noop,data:s,loc:{start:{line:11,column:26},end:{line:11,column:103}}}))?n:"")+l(typeof(d=null!=(d=h(o,"title")||(null!=e?h(e,"title"):e))?d:r)===c?d.call(a,{name:"title",hash:{},data:s,loc:{start:{line:11,column:103},end:{line:11,column:112}}}):d)+"</span>\n\t</li>\n</ul>\n"},useData:!0},d={compiler:[8,">= 4.3.0"],main:function(t,e,o,i,s){var n,d=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<span class="todo-item-wrapper has-more">\n\t<i class="loading-icon"></i>\n\t<i class="control error-icon" title="Error saving click to retry">!</i>\n\n\t<label><input class="todo-item-checkbox" data-test="todo-item-checkbox" type="checkbox"></label>\n\t<span class="todo-item-title" data-test="todo-item-title">'+t.escapeExpression("function"==typeof(n=null!=(n=d(o,"title")||(null!=e?d(e,"title"):e))?n:t.hooks.helperMissing)?n.call(null!=e?e:t.nullContext||{},{name:"title",hash:{},data:s,loc:{start:{line:6,column:59},end:{line:6,column:68}}}):n)+'</span>\n\t<div class="more"></div>\n</span>\n'},useData:!0},a={1:function(t,e,o,i,s){var n,d=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'\t\t<div class="project-chooser todo-provider-wrapper '+(null!=(n=d(o,"unless").call(null!=e?e:t.nullContext||{},null!=e?d(e,"supportLists"):e,{name:"unless",hash:{},fn:t.program(2,s,0),inverse:t.noop,data:s,loc:{start:{line:5,column:52},end:{line:5,column:95}}}))?n:"")+'">\n\t\t\t<div class="project-chooser-toggle"></div>\n\t\t\t<div class="project-chooser-dropdown"></div>\n\t\t</div>\n'},2:function(t,e,o,i,s){return"has-icon"},4:function(t,e,o,i,s){return"todo-folders"},6:function(t,e,o,i,s){var n,d=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<img class="provider-icon" src="'+t.escapeExpression("function"==typeof(n=null!=(n=d(o,"providerLogo")||(null!=e?d(e,"providerLogo"):e))?n:t.hooks.helperMissing)?n.call(null!=e?e:t.nullContext||{},{name:"providerLogo",hash:{},data:s,loc:{start:{line:12,column:61},end:{line:12,column:77}}}):n)+'">'},8:function(t,e,o,i,s){return"no-caps"},10:function(t,e,o,i,s){var n,d=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="message todo-message"><span class="title">'+t.escapeExpression("function"==typeof(n=null!=(n=d(o,"statusMessage")||(null!=e?d(e,"statusMessage"):e))?n:t.hooks.helperMissing)?n.call(null!=e?e:t.nullContext||{},{name:"statusMessage",hash:{},data:s,loc:{start:{line:30,column:75},end:{line:30,column:92}}}):n)+"</span></div>"},12:function(t,e,o,i,s){var n,d=null!=e?e:t.nullContext||{},a=t.hooks.helperMissing,r="function",l=t.escapeExpression,c=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="message todo-message"><span class="action" id="status-action" data-action="'+l(typeof(n=null!=(n=c(o,"action")||(null!=e?c(e,"action"):e))?n:a)===r?n.call(d,{name:"action",hash:{},data:s,loc:{start:{line:31,column:108},end:{line:31,column:118}}}):n)+'">'+l(typeof(n=null!=(n=c(o,"actionMessage")||(null!=e?c(e,"actionMessage"):e))?n:a)===r?n.call(d,{name:"actionMessage",hash:{},data:s,loc:{start:{line:31,column:120},end:{line:31,column:137}}}):n)+"</span></div>"},compiler:[8,">= 4.3.0"],main:function(t,e,o,i,s){var n,d,a=null!=e?e:t.nullContext||{},r=t.hooks.helperMissing,l="function",c=t.escapeExpression,h=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="todo-header-row">\n\t<div class="list-color" style="background-color: '+c(typeof(d=null!=(d=h(o,"color")||(null!=e?h(e,"color"):e))?d:r)===l?d.call(a,{name:"color",hash:{},data:s,loc:{start:{line:2,column:50},end:{line:2,column:59}}}):d)+'"></div>\n\n'+(null!=(n=h(o,"if").call(a,null!=e?h(e,"supportProjects"):e,{name:"if",hash:{},fn:t.program(1,s,0),inverse:t.noop,data:s,loc:{start:{line:4,column:1},end:{line:9,column:8}}}))?n:"")+'\t\n\t<div class="'+(null!=(n=h(o,"if").call(a,null!=e?h(e,"supportsFolders"):e,{name:"if",hash:{},fn:t.program(4,s,0),inverse:t.noop,data:s,loc:{start:{line:11,column:13},end:{line:11,column:55}}}))?n:"")+' active-list-container has-icon" data-test="todo-list-chooser">\n\t\t'+(null!=(n=h(o,"unless").call(a,null!=e?h(e,"supportProjects"):e,{name:"unless",hash:{},fn:t.program(6,s,0),inverse:t.noop,data:s,loc:{start:{line:12,column:2},end:{line:12,column:90}}}))?n:"")+'\n\t\t<span class="list-name active-list-name '+(null!=(n=h(o,"if").call(a,null!=e?h(e,"no_caps"):e,{name:"if",hash:{},fn:t.program(8,s,0),inverse:t.noop,data:s,loc:{start:{line:13,column:42},end:{line:13,column:71}}}))?n:"")+'" title="'+c(typeof(d=null!=(d=h(o,"listTitle")||(null!=e?h(e,"listTitle"):e))?d:r)===l?d.call(a,{name:"listTitle",hash:{},data:s,loc:{start:{line:13,column:80},end:{line:13,column:93}}}):d)+'" data-test="todo-active-list-title">'+c(typeof(d=null!=(d=h(o,"listTitle")||(null!=e?h(e,"listTitle"):e))?d:r)===l?d.call(a,{name:"listTitle",hash:{},data:s,loc:{start:{line:13,column:130},end:{line:13,column:143}}}):d)+'</span>\n\t\t<div class="list-chooser-toggle icon-wrapper"><svg class="icon icon-angle-down" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 55.751 55.751"><path d="M31.836 43.006c.282-.281.518-.59.725-.912L54.17 20.485a5.403 5.403 0 0 0 0-7.638 5.403 5.403 0 0 0-7.638 0l-18.608 18.61L9.217 12.753A5.4 5.4 0 0 0 0 16.571a5.363 5.363 0 0 0 1.582 3.816l21.703 21.706c.207.323.445.631.729.913a5.367 5.367 0 0 0 3.91 1.572 5.37 5.37 0 0 0 3.912-1.572z"/></svg></div>\n\t\t<div class="dropdown nipple nipple-top-left">\n\t\t\t<div class="list-chooser dropdown-list" data-test="todo-list-dropdown"></div>\n\t\t</div>\n\t</div>\n\n\t<div class="todo-header-controls">\n\t\t<div class="todo-header-control more" id="todo-top-menu"></div>\n\t\t<div class="todo-header-control mobile-close">\n\t\t\t<span class="icon-wrapper u--mobile-show-bg hide">\n\t\t\t\t<svg class="icon icon-hide" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 348.333 348.334"><path d="M336.559 68.611L231.016 174.165l105.543 105.549c15.699 15.705 15.699 41.145 0 56.85-7.844 7.844-18.128 11.769-28.407 11.769-10.296 0-20.581-3.919-28.419-11.769L174.167 231.003 68.609 336.563c-7.843 7.844-18.128 11.769-28.416 11.769-10.285 0-20.563-3.919-28.413-11.769-15.699-15.698-15.699-41.139 0-56.85l105.54-105.549L11.774 68.611c-15.699-15.699-15.699-41.145 0-56.844 15.696-15.687 41.127-15.687 56.829 0l105.563 105.554L279.721 11.767c15.705-15.687 41.139-15.687 56.832 0 15.705 15.699 15.705 41.145.006 56.844z"/></svg>\n\t\t\t</span>\n\t\t</div>\n\t</div>\n</div>\n\n'+(null!=(n=h(o,"if").call(a,null!=e?h(e,"statusMessage"):e,{name:"if",hash:{},fn:t.program(10,s,0),inverse:t.noop,data:s,loc:{start:{line:30,column:0},end:{line:30,column:112}}}))?n:"")+"\n"+(null!=(n=h(o,"if").call(a,null!=e?h(e,"actionMessage"):e,{name:"if",hash:{},fn:t.program(12,s,0),inverse:t.noop,data:s,loc:{start:{line:31,column:0},end:{line:31,column:157}}}))?n:"")+"\n"},useData:!0},r={1:function(t,e,o,i,s){var n,d=null!=e?e:t.nullContext||{},a=t.hooks.helperMissing,r="function",l=t.escapeExpression,c=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'\t\t<li class="'+l(typeof(n=null!=(n=c(o,"class")||(null!=e?c(e,"class"):e))?n:a)===r?n.call(d,{name:"class",hash:{},data:s,loc:{start:{line:3,column:13},end:{line:3,column:22}}}):n)+'" data-list-id="'+l(typeof(n=null!=(n=c(o,"listId")||(null!=e?c(e,"listId"):e))?n:a)===r?n.call(d,{name:"listId",hash:{},data:s,loc:{start:{line:3,column:38},end:{line:3,column:48}}}):n)+'">\n\t\t\t<div class="list-color" style="background-color: '+l(typeof(n=null!=(n=c(o,"color")||(null!=e?c(e,"color"):e))?n:a)===r?n.call(d,{name:"color",hash:{},data:s,loc:{start:{line:4,column:52},end:{line:4,column:61}}}):n)+'">&nbsp;</div>'+l(typeof(n=null!=(n=c(o,"parentTitle")||(null!=e?c(e,"parentTitle"):e))?n:a)===r?n.call(d,{name:"parentTitle",hash:{},data:s,loc:{start:{line:4,column:75},end:{line:4,column:90}}}):n)+"\n\t\t</li>\n"},3:function(t,e,o,i,s){return"todo-list-section"},5:function(t,e,o,i,s){var n,d=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="list-color" style="background-color: '+t.escapeExpression("function"==typeof(n=null!=(n=d(o,"color")||(null!=e?d(e,"color"):e))?n:t.hooks.helperMissing)?n.call(null!=e?e:t.nullContext||{},{name:"color",hash:{},data:s,loc:{start:{line:8,column:72},end:{line:8,column:81}}}):n)+'">&nbsp;</div>'},7:function(t,e,o,i,s){var n,d=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<img class="provider-icon list-icon" src="'+t.escapeExpression("function"==typeof(n=null!=(n=d(o,"iconUrl")||(null!=e?d(e,"iconUrl"):e))?n:t.hooks.helperMissing)?n.call(null!=e?e:t.nullContext||{},{name:"iconUrl",hash:{},data:s,loc:{start:{line:9,column:83},end:{line:9,column:94}}}):n)+'">'},compiler:[8,">= 4.3.0"],main:function(t,e,o,i,s){var n,d,a=null!=e?e:t.nullContext||{},r=t.hooks.helperMissing,l=t.escapeExpression,c="function",h=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<ul data-test="'+l((h(o,"lower")||e&&h(e,"lower")||r).call(a,null!=e?h(e,"title"):e,{name:"lower",hash:{},data:s,loc:{start:{line:1,column:15},end:{line:1,column:30}}}))+'">\n'+(null!=(n=h(o,"if").call(a,null!=e?h(e,"parentTitle"):e,{name:"if",hash:{},fn:t.program(1,s,0),inverse:t.noop,data:s,loc:{start:{line:2,column:1},end:{line:6,column:8}}}))?n:"")+'\t<li class="'+l(typeof(d=null!=(d=h(o,"class")||(null!=e?h(e,"class"):e))?d:r)===c?d.call(a,{name:"class",hash:{},data:s,loc:{start:{line:7,column:12},end:{line:7,column:21}}}):d)+" "+(null!=(n=h(o,"if").call(a,null!=e?h(e,"hasParent"):e,{name:"if",hash:{},fn:t.program(3,s,0),inverse:t.noop,data:s,loc:{start:{line:7,column:22},end:{line:7,column:63}}}))?n:"")+'" data-list-id="'+l(typeof(d=null!=(d=h(o,"listId")||(null!=e?h(e,"listId"):e))?d:r)===c?d.call(a,{name:"listId",hash:{},data:s,loc:{start:{line:7,column:79},end:{line:7,column:89}}}):d)+'">\n\t\t'+(null!=(n=h(o,"unless").call(a,null!=e?h(e,"hasParent"):e,{name:"unless",hash:{},fn:t.program(5,s,0),inverse:t.noop,data:s,loc:{start:{line:8,column:2},end:{line:8,column:106}}}))?n:"")+'\n\t\t<span class="list-name">'+(null!=(n=h(o,"if").call(a,null!=e?h(e,"iconUrl"):e,{name:"if",hash:{},fn:t.program(7,s,0),inverse:t.noop,data:s,loc:{start:{line:9,column:26},end:{line:9,column:103}}}))?n:"")+l(typeof(d=null!=(d=h(o,"title")||(null!=e?h(e,"title"):e))?d:r)===c?d.call(a,{name:"title",hash:{},data:s,loc:{start:{line:9,column:103},end:{line:9,column:112}}}):d)+'</span>\n\t\t<span class="todo-count">'+l(typeof(d=null!=(d=h(o,"count")||(null!=e?h(e,"count"):e))?d:r)===c?d.call(a,{name:"count",hash:{},data:s,loc:{start:{line:10,column:27},end:{line:10,column:36}}}):d)+"</span>\n\t</li>\n</ul>\n"},useData:!0},l=Object.assign({"./collections/projecttodolists.js":t=>{t.collect.ProjectTodoLists=m.collect.SyncedCollection.extend({loadedFromCache:!1,listStatus:null,initialize:function(e,o){if(this.model=t.models.TodoList,this.listenTo(this,"reset",this.collectionChanged),this.listenTo(this,"sync refresh",this.collectionSync),this.listenTo(this,"change:count",this.handleCountChanged),this.listenTo(m,"globalEvent:resetLists",this.resetLists),this.project=o.project,o&&(this.project=o.project,o.isDummy?o.offlineOnly=!0:(o.prefetchTodos&&(this.externallyFetchedOnce=!0),o.provider&&(this.provider=o.provider))),o.idAttribute="csid",o.serverIdAttribute="id",(o=o||{}).name="todolist-"+this.project.id,o.localProps=["count","providerId","projectId","loadedOnce"],o.model=this.model,o.apiUrl=m.globals.urlRoot+"todos/lists",m.conditionalFeatures.featureEnabled("offlineDataOnly"))o.offlineOnly=!0;else{let t=function(t){var e=localStorage.getItem(t);e&&(e=JSON.parse(e)).isComputed&&(e.isComputed=!1,localStorage.setItem(t,JSON.stringify(e)),localStorage.setItem("activeTodoListId-1","1-inbox"))};t("todolist-1-1-today"),t("todolist-1-1-done")}m.collect.SyncedCollection.prototype.initialize.call(this,e,o);var i=this;o.isDummy&&i.setAsDummy(),setTimeout((function(){!o.isDummy&&o.offlineOnly&&setTimeout((function(){i.fetch({silent:!0,ignoreRender:!0,ignoreSave:!0}),i.populateDoneList(),i.populateTodayList(),i.populateInboxList(),m.trigger("todo:renderLists")}),200)}),1)},comparator:"order",resetLists:function(t){(!t||t.providerId==(this.provider||this.project.provider).id||t.listId&&this.get(t.listId))&&this.fetch({reset:!0})},handleAuthRequired:function(t){this.setStatus({status:"error",message:"Authentication Required…",actionMessage:"Connect",action:"auth.connect",actionParameter:t})},shouldIgnoreSync:function(t){return t.get("isComputed")},setAsDummy:function(){this.isDummy=!0,this.offlineOnly=!0,this.findWhere({id:this.project.get("id")})||(this.models=[],this.create({id:this.project.get("id"),title:this.project.get("title"),isDummy:!0},{project:this.project}))},forceFetch:function(){this.fetch({reset:!0})},selectedListCacheKey:function(){return this.project?"activeTodoListId-"+this.project.id:null},doFetchIfNeeded:function(){if(this.isDummy)return this.selectedList().doFetchIfNeeded(),void this.trigger("reset");this.forceFetch=!0,this.externallyFetchedOnce=!0,this.loadedFromCache?this.fetch():this.fetch({reset:!0})},parse:function(e){if(null!=e)return e.setAsDummy?(this.setAsDummy(),this.doFetchIfNeeded(!0),[]):(e.aux_data_cmd&&(this.aux_data_cmd=e.aux_data_cmd),e.aux_data&&(this.aux_data=e.aux_data),e.providerReset&&t.models.todoListManager.resetProvider(e.providerReset),Array.isArray(e)?e:e.lists)},handleCountChanged:function(){this.checkSelectedList()},collectionSync:function(t,e,o){o&&o.ignoreRender||(this.setStatus("Done"),this.checkSelectedList(this.forceFetch),this.forceFetch=!1,m.trigger("todo:renderLists"))},setStatus:function(t){this.listStatus=t,m.trigger("todo:loadingStateChange",t)},fetch:function(t){var e=this;if(this.isDummy)t.reset&&setTimeout((function(){e.trigger("reset")}));else{var o=t||{};if(this.project){var i={},s=this.project.get("providerId");i.data={provider_id:s,project_id:this.project.get("id")},m.models.customization.get("archived-"+s)&&(i.data.loadArchived=!0),o=_.extend(o,i)}o.error=function(){this.externallyFetchedOnce=!0,e.setStatus({status:"error",message:"Trouble connecting…",actionMessage:"Retry",action:"todo.connection.retry"})},(o&&null!=o.reset||this.listStatus&&"loading"!=this.listStatus.status)&&this.setStatus({status:"loading",message:"Loading..."}),o.project=this.project,m.collect.SyncedCollection.prototype.fetch.call(this,o)}},collectionChanged:function(t,e,o){o&&o.ignoreRender||(this.setStatus(null),this.checkSelectedList(this.forceFetch),this.forceFetch=!1)},populateDoneList:function(){this.getListOfType("done")||this.create({isComputed:!0,id:"1-done",csid:"1-done",title:"Done",type:"done",stock:!0,order:300,serverSetId:!0},{provider:this.provider,project:this.project})},populateTodayList:function(){this.getListOfType("today")||this.create({isComputed:!0,id:"1-today",csid:"1-today",title:"Today",type:"today",stock:!0,order:200,serverSetId:!0,selected:!0},{provider:this.provider,project:this.project})},populateInboxList:function(){if(!this.findWhere({csid:"1-inbox"})){this.create({id:"1-inbox",csid:"1-inbox",serverSetId:!0,title:"Inbox",type:"inbox",stock:!0,order:100,reorder:!0},{project:this.project})}},selectedList:function(){var t,e={},o=this.selectedListId;if(!o){var i=this.selectedListCacheKey();i&&(o=localStorage.getItem(i))}if(e[this.idAttribute]=o,!(t=this.findWhere(e))){if(!(t=this.findWhere({selected:!0}))&&(t=this.getListOfType("today"))){var s=this.getListOfType("inbox");s&&s.doFetchIfNeeded()}t||(t=this.getListOfType("inbox")),t?this.selectItem(t.id):this.models.length&&(t=this.models[0],this.selectItem(t.id)),!t&&this.models.length&&(t=this.models[0])}return t?(this.selectItem(t.id),t):null},getListOfType:function(t){return this.findWhere({type:t})},getListById:function(t){var e={};return e[this.idAttribute]=t,this.findWhere(e)},isDoneList:function(){var t=this.selectedList();return!(!t||!t.get("done"))},checkSelectedList:function(){if(!this.selectedListId){var t=null,e=this.selectedListCacheKey();if(e){var o=localStorage.getItem(e);o&&(t=this.getListById(o))}t||(t=this.findWhere({selected:!0})),!t&&this.models.length>0&&(t=this.models[0]),t?this.selectItem(t.id):this.selectItem(null)}},switchToDefaultList:function(){this.selectItem(this.getListOfType("inbox"))},selectItem:function(t){if(t!=this.selectedListId){var e=this.selectedListCacheKey();e&&localStorage.setItem(e,t),this.selectedListId=t,m.trigger("todo:listChanged"),null!=t&&this.externallyFetchedOnce&&this.selectedList().doFetchIfNeeded(!1,!0)}}})},"./collections/providertodoprojects.js":t=>{t.collect.ProviderTodoProjects=m.collect.SyncedCollection.extend({url:m.globals.urlRoot+"todos/projects",loadedFromCache:!1,projectStatus:null,initialize:function(e,o){o=o||{},this.model=t.models.TodoProject,this.listenTo(this,"reset refresh",this.collectionChanged),this.listenTo(this,"sync",this.collectionSync),this.listenTo(this,"change:count",this.handleCountChanged),this.listenTo(m,"globalEvent:resetLists",this.fetch),this.provider=o.provider,o.prefetchTodos&&(this.externallyFetchedOnce=!0),o.allProjects&&(this.allProjects=!0,this.url+="/all"),o.idAttribute="id",o.name="todoproject-"+this.provider.id,o.model=this.model,o.apiUrl=this.url,o.localProps=["providerId"],o.isDummy?(o.offlineOnly=!0,this.isDummy=!0):this.provider.isMomentum()?this.url=null:o.onlineOnly=!0,m.collect.SyncedCollection.prototype.initialize.call(this,e,o);var i=this;if(this.isDummy&&(this.loading=!0),i.isDummy||i.onlineOnly||i.fetch({ignoreRender:!0}),o.isDummy&&!i.findWhere({id:i.provider.get("id")})){i.models=[];var s={id:i.provider.get("id"),title:i.provider.get("title"),isDummy:!i.provider.get("supportProjects"),providerId:i.provider.get("id")};i.create(s,{provider:i.provider})}i.isDummy&&(i.loadedOnce=!0,i.loading=!1)},comparator:"order",selectedProjectCacheKey:function(){return this.provider?"activeTodoProjectId-"+this.provider.id:null},handleAuthRequired:function(t){this.setStatus({status:"error",message:"Authentication Required…",actionMessage:"Connect",action:"auth.connect",actionParameter:t})},doFetchIfNeeded:function(){this.forceFetch=!0,this.externallyFetchedOnce=!0,this.loadedFromCache?this.fetch():this.fetch({reset:!0})},parse:function(t){return t.aux_data_cmd&&(this.aux_data_cmd=t.aux_data_cmd),t.aux_data&&(this.aux_data=t.aux_data),Array.isArray(t)?t:t.projects},handleCountChanged:function(){this.checkSelectedProject()},collectionSync:function(t,e,o){o.ignoreRender||(this.setStatus(null),this.checkSelectedProject(this.forceFetch),this.forceFetch=!1)},setStatus:function(t){this.projectStatus=t,m.trigger("todo:loadingStateChange",t)},fetch:function(t){this.loading=!0;var e=this;if(!this.isDummy){var o=t||{};if(this.provider){var i={};i.data={provider_id:this.provider.id},o=_.extend(o,i)}return o.error=function(){this.externallyFetchedOnce=!0,e.setStatus({status:"error",message:"Trouble connecting…",actionMessage:"Retry",action:"todo.connection.retry"})},(o&&null!=o.reset||this.projectStatus&&"loading"!=this.projectStatus.status)&&this.setStatus({status:"loading",message:"Loading..."}),o.provider=this.provider,m.collect.SyncedCollection.prototype.fetch.call(this,o)}t&&t.reset&&setTimeout((function(){e.trigger("reset")}))},collectionChanged:function(){this.setStatus(null),this.checkSelectedProject(this.forceFetch),this.forceFetch=!1},selectedProject:function(){var t;return this.selectedProjectId&&this.findWhere({id:this.selectedProjectId})?this.findWhere({id:this.selectedProjectId}):((t=this.findWhere({selected:!0}))?this.selectItem(t.id):this.models.length&&(t=this.models[0],this.selectItem(t.id)),t||null)},checkSelectedProject:function(){if(!this.selectedProjectId){var t=null,e=this.selectedProjectCacheKey();if(e&&localStorage.getItem(e)){var o=localStorage.getItem(e);t=this.findWhere({id:o})}if(t||(t=this.findWhere({selected:!0})),!t&&this.models.length>0)return t=this.models[0],void this.selectItem(t.id);t?this.selectItem(t.id):this.selectItem(null)}},selectItem:function(t){if(t!=this.selectedProjectId){var e=this.findWhere({id:this.selectedProjectId});e&&e.resetSelection();var o=this.selectedProjectCacheKey();o&&localStorage.setItem(o,t),this.selectedProjectId=t,this.trigger("selectionChanged"),null!=t&&this.externallyFetchedOnce&&this.selectedProject().doFetchIfNeeded()}}})},"./collections/providertodoprojectsall.js":t=>{t.collect.ProviderTodoProjectsAll=Backbone.Collection.extend({url:m.globals.urlRoot+"todos/projects/all",loadedFromCache:!1,projectStatus:null,initialize:function(e,o){this.model=t.models.TodoProject,this.listenTo(this,"sync",this.collectionSync),this.provider=o.provider},comparator:"order",collectionSync:function(t,e,o){o.ignoreRender||(this.loaded=!0,this.loading=!1)},doFetchIfNeeded:function(t){return t||!this.loaded&&!this.loading?(this.fetch(),this.loading=!0,!1):!!this.loaded||void 0},parse:function(t){return t.aux_data_cmd&&(this.aux_data_cmd=t.aux_data_cmd),t.aux_data&&(this.aux_data=t.aux_data),Array.isArray(t)?t:t.projects},fetch:function(t){var e=this,o=t||{};if(o.reset=!0,this.provider){var i={};i.data={provider_id:this.provider.id},m.models.customization.get("archived-"+this.provider.id)&&(i.data.loadArchived=!0),o=_.extend(o,i)}return o.error=function(){e.loading=!1,m.trigger("todo:failedLoadingItems")},this.reset(null,{silent:!0}),m.collect.SyncedCollection.prototype.fetch.call(this,o)}})},"./collections/todoproviders.js":t=>{t.collect.TodoProviders=m.collect.SyncedCollection.extend({loadedOnce:!1,initialize:function(e,o){o=o||{},m.conditionalFeatures.featureEnabled("offlineDataOnly")&&(o.offlineOnly=!0),this.model=t.models.TodoProvider,o.idAttribute="id",o.name="todoprovider",o.model=this.model,o.readOnly=!0,o.apiUrl=m.globals.urlRoot+"todos/providers",m.collect.SyncedCollection.prototype.initialize.call(this,e,o)},parse:function(t){return t.connected?t.connected:Array.isArray(t)?t:null}})},"./collections/todosbase.js":t=>{t.collect.TodoProxy=Backbone.Collection.extend({initialize:function(e,o){this.model=t.models.TodoProxy,o&&o.parentList&&(this.parentList=o.parentList)}}),t.collect.TodosBase=m.collect.SyncedCollection.extend({initialize:function(e,o){m.conditionalFeatures.featureEnabled("offlineDataOnly")&&(o.offlineOnly=!0),(o=o||{}).parentList&&(this.parentList=o.parentList,this.parentList.project.provider.isMomentum()||(o.onlineOnly=!0)),this.model=t.models.Todo,localStorage.showTodoList||(localStorage.showTodoList=!1),this.listenTo(m,"newDay",this.onNewDay),this.listenTo(this,"reset refresh",this.onCollectionReset),this.listenTo(this,"sync",this.onSync),this.listenTo(this,"add remove change refresh",this.collectionChanged),this.listenTo(this,"reorder",this.reorderItem),o.name="todo-"+this.parentList.id,o.transientProps=["isLoading","saveFailed","isProxy","proxyValid","viewSectionId"],o.localProps=["providerId","projectId","csListId","serversideOrder","order"],o.model=this.model,o.apiUrl=m.globals.urlRoot+"todos",this.listenTo(this,"reorder",this.reorderItem),m.collect.SyncedCollection.prototype.initialize.call(this,e,o)},onCollectionReset:function(){this.fetchedOnce=!0,this.loadingFromServer=!1,this.clearCompleted(),this.onLoadingFromServerChanged(),this.trigger("loadingFromServerChanged")},onSync:function(t,e,o){o&&(o.ignoreRender||o.silent)||(this.loadingFromServer=!1,this.clearCompleted(),this.onLoadingFromServerChanged(),this.trigger("loadingFromServerChanged"),m.trigger("todo:listSync"))},onNewDay:function(){this.fetchedOnce&&(this.parentList&&t.models.todoListManager&&t.models.todoListManager.activeProvider.selectedList().id!==this.parentList.id||this.fetch())},onLoadingFromServerChanged:function(){},clearCompleted:function(){},collectionChanged:function(){localStorage.setItem("todos-updated",m.date()),this.onCollectionChanged()},onCollectionChanged:function(){},completeToday:function(){var t=this;return this.filter((function(e){var o=e.get("completedDate");if(o){var i="";if(o instanceof Date)i=m.utils.getDateString(o);else{var s=o.split("T");s.length>1&&(i=s[0])}var n=m.utils.getDateString();if(i!==m.date().toISOString().split("T")[0]&&i!==n)return!1}if(1==e.get("done")&&0==e.get("archive")&&0==e.get("deleted")&&e.get("csListId")==t.parentList.id)return!0}))},completedCount:function(){return this.completeToday().length},activeToday:function(){var t=this;return this.parentList.isDoneList()?this.where({deleted:!1,done:!0}):this.filter((function(e){if(!(0!=e.get("archive")||0!=e.get("deleted")||t.offlineOnly&&e.get("completedDate")&&m.utils.getDateString(e.get("completedDate"))!==m.utils.getDateString())){var o=e.get("csListId");if(o==t.parentList.id||!o)return!0;if("1-##default"==t.parentList.id)return!0}}))},done:function(){return this.where({done:!0})},deleted:function(){return this.where({deleted:!0})},remaining:function(){var t=this.activeToday();return this.parentList.isDoneList()?t:_.filter(t,(function(t){return!t.get("done")}))},nextOrder:function(){return this.length?this.last().get("order")+100:100},comparator:"order",create:function(t,e){return null==t.order&&(t.order=this.nextOrder()),m.collect.SyncedCollection.prototype.create.call(this,t,e)},reorderItem:function(){},handleOrdering:function(t){var e=[],o=this.serverIdAttribute;t.map((function(t){e.push(t[o])})),this.models.map((function(t){t.save({serversideOrder:e.indexOf(t.get(o))},{ignoreRender:!0,silent:!0})}))}})},"./collections/todosmain.js":t=>{t.collect.Todos=t.collect.TodosBase.extend({url:m.globals.urlRoot+"todos",previousCount:-1,listStatus:null,firstLoadCompleted:!1,reorderItem:function(t,e){this.offlineOnly&&this.reorderItemOffline(t,e);var o=this,i={operations:[{REORDER:Object.assign({},t)}]},s=this.findWhere({id:t.move_id});if(s){this.setStatus({status:"loading",message:"Loading..."}),s.set({isLoading:!0});var n=s.collection.parentList.project;i.providerId=n.provider.id,i.projectId=n.id,$.ajax({type:"PATCH",contentType:"application/json",data:JSON.stringify(i),url:m.globals.urlRootApi+"todos"}).done((function(){s.set({isLoading:!1}),o.fetch({success:e,skipLocalFetch:!o.onlineOnly})})).fail((function(){s.pendingReorderData=i,s.set({saveFailed:!0,isLoading:!1})}))}},handleAuthRequired:function(t){this.setStatus({status:"error",message:"Authentication Required…",actionMessage:"Connect",action:"auth.connect",actionParameter:t})},createOrderGaps:function(){var t=100;this.each((function(e){e.save({order:t},{silent:!0}),t+=100}))},reorderItemOffline:function(t){var e=this.offlineOnly?this.idAttribute:this.serverIdAttribute,o={};o[e]=t.move_id;var i=this.findWhere(o);o[e]=t.move_target_id;var s=this.findWhere(o),n=t.move_offset>0?1:-1,d=this.indexOf(s),a=1;if(d+n>=0&&d+n<this.length){var r=this.at(d+n);(a=Math.abs(r.get("order")-s.get("order")))<=20&&(this.createOrderGaps(),a=Math.abs(r.get("order")-s.get("order")))}var l=s.get("order")+Math.ceil(a/2)*n;i.save({order:l},{silent:!0})},shouldIgnoreSync:function(t){return!t.get("title")||0===t.get("title").length||"empty task..."===t.get("title")},onLoadingFromServerChanged:function(){this.setStatus("Done"),this.checkRemainingItemCount()},onCollectionChanged:function(){this.checkRemainingItemCount()},completedCount:function(){return this.completeToday().length},checkRemainingItemCount:function(){if(!this.loadingFromServer){this.firstLoadCompleted=!0;var t=this.remaining().length;t!=this.previousCount&&(this.previousCount=t,this.trigger("remainingCountChanged",t))}},doFetchIfNeeded:function(t){this.fetchedOnce||this.firstItemFetchStarted?this.fetch(this.moreLoaded?{remove:!1,listChanged:t}:{listChanged:t}):(this.firstItemFetchStarted=!0,this.fetch({reset:!0}))},loadMore:function(t){this.moreLoaded=!0,this.todoChangedListener||(this.todoChangedListener=!0,this.listenTo(m,"todo:changed",this.todoChanged)),this.fetch({endDate:t,remove:!1,skipLocalFetch:!0})},setStatus:function(t){this.listStatus=t,m.trigger("todo:loadingStateChange",t)},parse:function(t){if(null!=t){if(t.items){t.sections?this.itemSections=t.sections:this.itemSections=null,t.hasOldTodos?this.hasOldTodos=t.hasOldTodos:this.hasOldTodos=!1,t.menu_options?this.menuOptions=t.menu_options:this.menuOptions=null,t.default_commands?this.defaultCommands=t.default_commands:this.defaultCommands=null,this.noAssigned=t.noAssigned,this.groupingInfo=t.groupingInfo,this.statuses=t.statuses;var e=this.parentList.get("item_order");return e&&t.items.forEach((function(t){var o=e.indexOf(t.id.substr(2))+1;o>0&&(t.order=100*o)})),t.items}return t}},todoChanged:function(t){if(this.moreLoaded){var e=this.get(t);e&&e.fetch()}},activeToday:function(){var t=this,e=[];if(this.parentList.isDoneList()&&m.conditionalFeatures.featureEnabled("offlineDataOnly"))return e=this.parentList.project.getDoneTodos()||e,o(t.parentList,e),e;if(this.parentList.isTodayList()&&m.conditionalFeatures.featureEnabled("offlineDataOnly"))return e=this.parentList.project.getTodayTodos()||e,o(t.parentList,e),e;if(!this.fetchedOnce&&!this.firstItemFetchStarted)return setTimeout((function(){t.parentList.collection&&t.parentList.doFetchIfNeeded()}),10),[];if(this.parentList.isDoneList()){if(t.parentList.showAssignedTodosOnly)return;return e=this.where({deleted:!1,done:!0}),o(t.parentList,e),e}return e=this.filter((function(e){if((!t.parentList.showAssignedTodosOnly||e.get("assigned"))&&(!e.get("today")||t.parentList.isTodayList())&&(e.get("today")||!t.parentList.isTodayList())&&e.get("title")&&0!==e.get("title").length&&!(e.get("archive")||e.get("deleted")||e.get("completedDate")&&m.utils.getDateString(Date.parse(e.get("completedDate")))!==m.utils.getDateString())){var o=e.get("csListId");if(o===t.parentList.id||e.get("today")&&t.parentList.isTodayList()||!o)return!0;if("1-##default"===t.parentList.id)return!0}})),o(t.parentList,e),e;function o(t,e){var o=0;e.map((function(e){e.get("done")&&!t.isDoneList()||o++})),setTimeout((function(){var e=t.isComputed?"set":"save";t.collection&&t[e]({count:o},{silent:!0,ignoreRender:!0})}),1)}},fetch:function(t){var e=this;if(t=t||{},!this.offlineOnly){if(this.loadingFromServer)return;this.loadingFromServer=!0}var o={data:{}};return this.parentList&&this.parentList.get("id")&&(o.data.listId=this.parentList.get("id"),o.data.providerId=this.parentList.project.provider.get("id")),this.parentList.project&&!this.parentList.project.get("isDummy")&&(o.data.projectId=this.parentList.project.get("id")),0==Object.keys(o.data).length&&(t.skipServerFetch=!0),m.models.customization.get("assigned-"+this.parentList.id)&&(o.data.loadMineOnly=!0),m.models.customization.get("subtask-"+this.parentList.id)&&(o.data.loadSubtasks=!0),m.models.customization.get("showOld-"+this.parentList.id)&&(o.data.loadOldCompleted=!0),t&&t.endDate&&(o.data=o.data||{},o.data.endDate=t.endDate),o.error=function(){e.loadingFromServer=!1,e.setStatus({status:"error",message:"Trouble connecting…",actionMessage:"Retry",action:"todo.connection.retry"})},(t=_.extend(t,o))&&null!=t.reset?(this.setStatus({status:"loading",message:"Loading...",listChanged:t.listChanged}),this.moreLoaded=!1):this.listStatus&&"loading"!=this.listStatus.status&&this.setStatus({status:"loading",message:"Loading...",listChanged:t.listChanged}),t.parentList=this.parentList,m.collect.SyncedCollection.prototype.fetch.call(this,t)}})},"./collections/topdropdownmenuitems.js":t=>{t.collect.TopDropdownMenuItems=Backbone.Collection.extend({url:m.globals.urlRoot+"settings/todo/menu",fetchCompleted:!1,initialize:function(e,o){this.model=t.models.DropdownMenuItem,o&&o.listId&&(this.listId=o.listId)},parse:function(t){return Array.isArray(t)?t:t.menuoptions},fetchIfRequired:function(t){if(!this.fetchCompleted){this.fetchCompleted=!0;var e={data:{},reset:!0,error:function(){self.fetchCompleted=!1}};return t&&(e.data.providerId=t),this.fetch(e),!0}return!1},queueFetch:function(){this.fetchCompleted=!1},fetch:function(t){if(this.listId){var e={listId:this.listId};return t.data=_.extend(t.data||{},e),Backbone.Collection.prototype.fetch.call(this,t)}return null}})},"./commands/asana.js":()=>{m.commands.TodoAsanaMoveSectionMenu=m.models.Command.extend({defaults:{id:"todo.asana.move.section.menu"},execute:function(t,e,o){return this.parentContext=o,!0},canExecute:function(t){return t.collection.parentList.get("allow_move")},getSubmenu:function(){var t=[],e=this,o=e.parentContext.selectedList().id;return this.parentContext.selectedProject().listCollection.map((function(i){var s=o.substring(0,o.lastIndexOf("-")),n=i.id.substring(0,i.id.lastIndexOf("-"));if(e.parentContext.selectedList().id!=i.id&&n==s){var d={};d.listId=i.id,d.captionText=i.get("title"),d.count=i.get("count"),t.push(d),d.commandId="todo.asana.move.section",d.options={target_id:i.id}}})),{title:null,items:new Backbone.Collection(t)}}}),m.commandManager.registerCommandModel(m.commands.TodoAsanaMoveSectionMenu,!1),m.commands.TodoAsanaMoveSection=m.models.Command.extend({defaults:{id:"todo.asana.move.section"},execute:function(t,e){var o={listId:e.target_id};t.attemptSave(o),m.trigger("todo:loadingStateChange",null)},canExecute:function(t,e){return e&&t.get("listId")!=e.target_id}}),m.commandManager.registerCommandModel(m.commands.TodoAsanaMoveSection,!1)},"./commands/clickup.js":()=>{m.commands.TodoClickUpOpenConfig=m.models.Command.extend({defaults:{id:"todo.clickup.config"},execute:function(){m.commandManager.execute("settings.display",null,{section:"clickup"})}}),m.commandManager.registerCommandModel(m.commands.TodoClickUpOpenConfig,!1)},"./commands/github.js":()=>{m.commands.TodoGithubMoveSectionMenu=m.models.Command.extend({defaults:{id:"todo.github.move.section.menu"},execute:function(t,e,o){return this.parentContext=o,!0},canExecute:function(t){return t.collection.parentList.get("allow_move")},getSubmenu:function(){var t=[],e=this,o=e.parentContext.selectedList().id;return this.parentContext.selectedProject().listCollection.map((function(i){var s=o.substring(0,o.lastIndexOf("-")),n=i.id.substring(0,i.id.lastIndexOf("-"));if(e.parentContext.selectedList().id!=i.id&&n==s){var d={};d.listId=i.id,d.captionText=i.get("title"),d.count=i.get("count"),t.push(d),d.commandId="todo.github.move.section",d.options={target_id:i.id}}})),{title:null,items:new Backbone.Collection(t)}}}),m.commandManager.registerCommandModel(m.commands.TodoGithubMoveSectionMenu,!1),m.commands.TodoGithubMoveSection=m.models.Command.extend({defaults:{id:"todo.github.move.section"},execute:function(t,e){var o={listId:e.target_id};t.attemptSave(o),m.trigger("todo:loadingStateChange",null)},canExecute:function(t,e){return!!e&&t.get("listId")!=e.target_id}}),m.commandManager.registerCommandModel(m.commands.TodoGithubMoveSection,!1)},"./commands/todo.js":t=>{m.commands.TodoMove=m.models.Command.extend({defaults:{id:"todo.move.id"},execute:function(t,e){var o={},i=t.collection.parentList;o[i.collection.idAttribute]=e.target_id;var s=i.collection.findWhere(o),n={};m.Analytics.capture("todo move to",{feature:"todo",provider:"momentum",is_paid_event:i.isCustom()||s.isCustom(),from_list:i.formattedTodoListName(),to_list:s.formattedTodoListName()}),i.isTodayList()?m.utils.mergeObjects(n,t.getTodayStateChanges(!1)):i.isDoneList()&&m.utils.mergeObjects(n,t.getDoneStateChanges(!1)),s.isTodayList()?m.utils.mergeObjects(n,t.getTodayStateChanges(!0)):s.isDoneList()&&m.utils.mergeObjects(n,t.getDoneStateChanges(!0)),s.isTodayList()||s.isDoneList()||m.utils.mergeObjects(n,{listId:s.get("id"),csListId:s.id}),t.attemptSave(n),s.changeCount(!0),m.trigger("todo:loadingStateChange",null)},canExecute:function(t,e){return!(!e||m.conditionalFeatures.featureEnabled("offlineDataOnly"))&&t.get("listId")!=e.target_id}}),m.commandManager.registerCommandModel(m.commands.TodoMove,!1),m.commands.TodoMoveTodayBatch=m.models.Command.extend({defaults:{id:"todo.move.today.batch"},execute:function(t){var e=t.project.getListOfType("today");e.save("count",e.getCount()+t.getCount()),t.itemCollection.activeToday().map((function(t){t.attemptSave({today:!0},null,!0)})),t.itemCollection.syncToServer&&t.itemCollection.syncToServer(),t.save("count",0),m.trigger("todo:loadingStateChange",{message:" ",actionMessage:"Tasks sent to Today >",action:"todo.switch.today",duration:5e3});var o=t.formattedTodoListName();m.Analytics.capture("send tasks to today",{feature:"todo",provider:"momentum",is_paid_event:!("done"===o||"inbox"===o),list:o})},canExecute:function(t){return t&&!t.isTodayList()&&t.project.provider.isMomentum()&&!m.conditionalFeatures.featureEnabled("offlineDataOnly")&&t.itemCollection.activeToday().length>0}}),m.commandManager.registerCommandModel(m.commands.TodoMoveTodayBatch,!1),m.commands.TodoMoveBackBatch=m.models.Command.extend({defaults:{id:"todo.move.back.batch"},execute:function(t){t.itemCollection.activeToday().map((function(e){e.attemptSave({today:!1},null,!0),t.collection.get(e.get("homeListId")).changeCount(!0)})),t.itemCollection.syncToServer&&t.itemCollection.syncToServer(),t.save("count",0),m.trigger("todo:loadingStateChange",{message:"Tasks sent to Inbox/other lists.",duration:5e3}),m.Analytics.capture("clear the day",{feature:"todo",provider:"momentum"})},canExecute:function(t){return t&&t.isTodayList()&&!m.conditionalFeatures.featureEnabled("offlineDataOnly")&&t.itemCollection.activeToday().length>0}}),m.commandManager.registerCommandModel(m.commands.TodoMoveBackBatch,!1),m.commands.TodoDoneAndArchive=m.models.Command.extend({defaults:{id:"todo.done.archive"},execute:function(t){var e=t.collection.parentList.collection.findWhere({id:"1-done"});t.setDoneState(!0,!0),e.changeCount(!0),m.Analytics.capture("todo move to",{feature:"todo",is_paid_event:t.collection.parentList.isCustom(),provider:"momentum",from_list:t.collection.parentList.formattedTodoListName(),to_list:"done"}),m.utils.delay(500).then((function(){e.doFetchIfNeeded(!0)}))},canExecute:function(t,e,o){return!o.selectedList().isDoneList()&&!m.conditionalFeatures.featureEnabled("offlineDataOnly")}}),m.commandManager.registerCommandModel(m.commands.TodoDoneAndArchive,!1),m.commands.TodoToggleToday=m.models.Command.extend({defaults:{id:"todo.toggle.today"},execute:function(t,e,o){var i=!t.get("today");t.setTodayState(i);var s=o.selectedList();if(m.Analytics.capture("todo move to",{feature:"todo",provider:"momentum",is_paid_event:s.isCustom(),from_list:s.formattedTodoListName(),to_list:i?"today":"inbox"}),!t.get("done")){var n=s.collection;s.isTodayList()?n.offlineOnly||n.findWhere({id:t.get("homeListId")}).changeCount(!i):n.findWhere({type:"today"}).changeCount(i),m.trigger("todo:renderLists")}},canExecute:function(t,e,o){return o.selectedList().isTodayList()&&t.get("today")||!t.get("today")&&!o.selectedList().isDoneList()},getProperties:function(t,e,o){var i=o.selectedList().collection.findWhere({id:t.get("homeListId")});return i?{captionText:"Move to "+(t.get("today")?i.get("title"):"Today")}:{captionText:null}}}),m.commandManager.registerCommandModel(m.commands.TodoToggleToday,!1),m.commands.TodoUnDone=m.models.Command.extend({defaults:{id:"todo.undone"},execute:function(t){var e=t.collection.parentList.collection.findWhere({id:t.get("homeListId")});t.setDoneState(!1),e.changeCount(!0),m.trigger("todo:loadingStateChange",null),m.Analytics.capture("todo move to",{feature:"todo",is_paid_event:!1,provider:"momentum",from_list:"done",to_list:e.formattedTodoListName()})},canExecute:function(t,e,o){return o.selectedList().isDoneList()&&!m.conditionalFeatures.featureEnabled("offlineDataOnly")},getProperties:function(t){var e=t.collection.parentList.collection.findWhere({id:t.get("homeListId")});return e?{captionText:"Move to "+(t.get("today")?"Today":e.get("title"))}:{captionText:null}}}),m.commandManager.registerCommandModel(m.commands.TodoUnDone,!1),m.commands.TodoArchive=m.models.Command.extend({defaults:{id:"todo.archive"},execute:function(t){t.setArchiveState(!0),m.trigger("todolist:updateHeight");var e=t.collection.parentList;m.Analytics.capture("todo archive",{feature:"todo",provider:e.formattedTodoListProvider(),is_paid_event:e.isCustom(),list:e.formattedTodoListName()})},canExecute:function(t,e,o){return!o.selectedList().isDoneList()&&t.get("done")}}),m.commandManager.registerCommandModel(m.commands.TodoArchive,!1),m.commands.TodoArchiveAlways=m.models.Command.extend({defaults:{id:"todo.archive.always"},execute:function(t){t.setArchiveState(!0),m.trigger("todolist:updateHeight")},canExecute:function(){return!0}}),m.commandManager.registerCommandModel(m.commands.TodoArchiveAlways,!1),m.commands.TodoDelete=m.models.Command.extend({defaults:{id:"todo.delete"},execute:function(t){t.collection.models.map((function(e){t.get("id")&&e.get("parentId")==t.get("id")&&e.deleteItem()})),t.deleteItem(),m.trigger("todo:loadingStateChange");var e=t.collection.parentList;m.Analytics.capture("todo delete",{feature:"todo",provider:e.formattedTodoListProvider(),is_paid_event:e.isCustom(),list:e.formattedTodoListName()})},canExecute:function(){return!0}}),m.commandManager.registerCommandModel(m.commands.TodoDelete,!1),m.commands.TodoMoveTo=m.models.Command.extend({defaults:{id:"todo.moveTo"},execute:function(t,e,o){return this.parentContext=o,!0},canExecute:function(t){return t.collection.parentList.get("allow_move")&&!m.conditionalFeatures.featureEnabled("offlineDataOnly")},getSubmenu:function(){var t=[],e=this;return this.parentContext.selectedProject().listCollection.map((function(o){if(e.parentContext.selectedList().id!=o.id){var i={};i.listId=o.id,i.captionText=o.get("title"),i.color=o.getColor(),i.count=o.get("count"),i.css_class="no-icon",t.push(i),o.isDoneList()&&(i.commandId="todo.done.archive"),i.commandId||(i.commandId="todo.move.id"),i.options={target_id:o.id}}})),{title:null,items:new Backbone.Collection(t)}}}),m.commandManager.registerCommandModel(m.commands.TodoMoveTo,!1),m.commands.TodoSwitchFeed=m.models.Command.extend({defaults:{id:"todo.switch.feed"},execute:function(t,e,o){return this.parentContext=o,o||m.cmd("modal.open","UPSELL_TODO_INTEGRATIONS",{eventSource:"dash"}),!0},canExecute:function(){return!m.conditionalFeatures.featureEnabled("offlineDataOnly")},getSubmenu:function(){if(!this.parentContext)return null;var t=this.parentContext.selectedList().topMenuItems();return t.fetchIfRequired(this.parentContext.id),{title:null,items:t}}}),m.commandManager.registerCommandModel(m.commands.TodoSwitchFeed,!1),m.commands.TodoShowIntegrationUpsell=m.models.Command.extend({defaults:{id:"todo.show.integrationUpsell"},execute:function(){return m.cmd("modal.open","UPSELL_TODO_INTEGRATIONS",{eventSource:"dash"}),!0}}),m.commandManager.registerCommandModel(m.commands.TodoShowIntegrationUpsell,!1),m.commands.TodoVisitExternal=m.models.Command.extend({defaults:{id:"todo.visit.external"},execute:function(t,e){var o=e.providerUrl;return e.urlField&&(o=t.get(e.urlField)||o),m.utils.getBrowser().tabs.create({url:o}),m.Analytics.capture("list view in integration",{feature:"todo",provider:t.collection.project.provider.get("provider_title").toLowerCase().split("(")[0].trim(),is_paid_event:!0}),!0}}),m.commandManager.registerCommandModel(m.commands.TodoVisitExternal,!1),m.commands.TodoToggleAssignee=m.models.Command.extend({defaults:{id:"todo.toggle.assignee"},execute:function(t,e,o){var i="assigned-"+o.selectedList().id;m.models.customization.set(i,!m.models.customization.get(i)),m.trigger("toggleAssignee",i)}}),m.commandManager.registerCommandModel(m.commands.TodoToggleAssignee,!1),m.commands.TodoShowSettings=m.models.Command.extend({defaults:{id:"todo.show.settings"},execute:function(){m.commandManager.executeAsync("settings.display",null,{section:"todo"})}}),m.commandManager.registerCommandModel(m.commands.TodoShowSettings,!1),m.commands.MenuIgnore=m.models.Command.extend({defaults:{id:"menu.ignore"},execute:function(){return!0},canExecute:function(){return!0}}),m.commandManager.registerCommandModel(m.commands.MenuIgnore,!1),m.commands.TodoDeleteWarn=m.models.Command.extend({defaults:{id:"todo.delete.warn"},execute:function(){return!0},canExecute:function(){return!0},getSubmenu:function(){return{title:"Delete?",items:new Backbone.Collection([{captionText:"Yes",commandId:"todo.delete"},{captionText:"No",commandId:"menu.ignore",css_class:"dropdown-detail-back"}])}}}),m.commandManager.registerCommandModel(m.commands.TodoDeleteWarn,!1),m.commands.TodoFocusPin=m.models.Command.extend({defaults:{id:"todo.focus.pin"},execute:function(t){m.trigger("focus:pin",t);var e=t.collection.parentList;m.Analytics.capture("todo set to focus",{feature:"todo",provider:e.formattedTodoListProvider(),is_paid_event:!0,list:e.formattedTodoListName()})},canExecute:function(t){return!t.get("done")}}),m.commandManager.registerCommandModel(m.commands.TodoFocusPin,!1),m.commands.TodoFocusModePin=m.models.Command.extend({defaults:{id:"todo.focusMode.pin"},execute:function(t){m.trigger("focus:pin",t);var e=t.collection.parentList;m.Analytics.capture("start focus mode from todo",{feature:"todo",provider:e.formattedTodoListProvider(),is_paid_event:!0,list:e.formattedTodoListName()}),m.trigger("focusMode:start","todo options")},canExecute:function(t){return!t.get("done")}}),m.commandManager.registerCommandModel(m.commands.TodoFocusModePin,!1),m.commands.TodoRetryConnection=m.models.Command.extend({defaults:{id:"todo.connection.retry"},execute:function(){t.models.todoListManager&&(t.models.todoListManager.doFetchIfNeeded(!0),t.models.todoListManager.activeProvider.refreshTodoItems())}}),m.commandManager.registerCommandModel(m.commands.TodoRetryConnection,!1),m.commands.EditTodo=m.models.Command.extend({defaults:{id:"todo.edit"},execute:function(t){t.trigger("todo:edit")}}),m.commandManager.registerCommandModel(m.commands.EditTodo,!1),m.commands.CloseTodo=m.models.Command.extend({defaults:{id:"todo.close"},execute:function(t){t.trigger("todo:close")},canExecute:function(t){return!t.get("done")}}),m.commandManager.registerCommandModel(m.commands.CloseTodo,!1),m.commands.OpenTodo=m.models.Command.extend({defaults:{id:"todo.open"},execute:function(t){t.trigger("todo:open")},canExecute:function(t){return!!t.get("done")}}),m.commandManager.registerCommandModel(m.commands.OpenTodo,!1)},"./commands/todolist.js":t=>{m.commands.TodoListDefaultCommand=m.models.Command.extend({defaults:{id:"todo.list.defaultcommand"},execute:function(t,e){return e&&e.get("done")?{captionText:"Archive to Done",commandId:"todo.move.done"}:{captionText:"Move to Today",commandId:"todo.toggle.today",options:{}}}}),m.commandManager.registerCommandModel(m.commands.TodoListDefaultCommand,!1),m.commands.TodoListArchiveAllDone=m.models.Command.extend({defaults:{id:"todo.list.archive"},execute:function(t){if(t&&!t.isDoneList()){var e=t.itemCollection.models;_.each(e,(function(t){t.get("done")&&!t.get("archive")&&t.archive()})),m.trigger("globalEvent:closeDropdowns"),m.trigger("todolist:updateHeight"),m.Analytics.capture("clear completed tasks",{provider:"momentum",feature:"todo"})}},canExecute:function(t){if(m.conditionalFeatures.featureEnabled("offlineDataOnly")||t&&t.isDoneList())return!1;if(t)var e=t.itemCollection;return!!(e&&e.completedCount()>0)}}),m.commandManager.registerCommandModel(m.commands.TodoListArchiveAllDone,!1),m.commands.TodoProviderChange=m.models.Command.extend({defaults:{id:"settings.todo.provider.change"},execute:function(e,o){if(o&&o.provider_id){t.models.todoListManager.changeProviderAsync(o.provider_id,o.newProvider);var i=t.models.todoListManager.todoProviderDetails(o.provider_id);if(!i)return;var s=i.get("provider_title").toLowerCase().split("(")[0].trim();m.Analytics.capture("provider set active",{feature:"todo",location:"dash",is_paid_event:!0,provider:i.isMomentum()?"momentum":s})}},canExecute:function(e,o){return o.provider_id!=t.models.todoListManager.activeProvider.id}}),m.commandManager.registerCommandModel(m.commands.TodoProviderChange,!1),m.commands.TodoSwitchParentProject=m.models.Command.extend({defaults:{id:"todo.switch.parent.project"},execute:function(e,o){t.models.todoListManager.switchProject(o.projectId)},canExecute:function(){return!0}}),m.commandManager.registerCommandModel(m.commands.TodoSwitchParentProject,!1),m.commands.TodoSwitchToday=m.models.Command.extend({defaults:{id:"todo.switch.today"},execute:function(){t.models.todoListManager.activeProvider.selectList("1-today")},canExecute:function(){return!0}}),m.commandManager.registerCommandModel(m.commands.TodoSwitchToday,!1),m.commands.TodoListCheckStateAutofocus=m.models.Command.extend({defaults:{id:"todo.list.check.state.autofocus"},execute:function(){return m.models.customization.get("autoFocus")}}),m.commandManager.registerCommandModel(m.commands.TodoListCheckStateAutofocus,!1),m.commands.TodoListCheckStateAssigned=m.models.Command.extend({defaults:{id:"todo.list.check.state.assigned"},execute:function(t){if(t){var e=t.get("id");return!!m.models.customization.get("assigned-"+e)}}}),m.commandManager.registerCommandModel(m.commands.TodoListCheckStateAssigned,!1),m.commands.TodoListCheckToggleAssigned=m.models.Command.extend({defaults:{id:"todo.list.toggle.assigned"},execute:function(t){var e=t.get("id"),o=m.models.customization.get("assigned-"+e);return m.models.customization.save("assigned-"+e,!o),!1}}),m.commandManager.registerCommandModel(m.commands.TodoListCheckToggleAssigned,!1),m.commands.TodoListCheckStateSubtasks=m.models.Command.extend({defaults:{id:"todo.list.check.state.subtasks"},execute:function(t){if(t){var e=t.get("id");return 1==m.models.customization.get("subtask-"+e)}}}),m.commandManager.registerCommandModel(m.commands.TodoListCheckStateSubtasks,!1),m.commands.TodoListToggleSubtasks=m.models.Command.extend({defaults:{id:"todo.list.toggle.subtasks"},execute:function(t){var e=t.get("id"),o=m.models.customization.get("subtask-"+e);return m.models.customization.save("subtask-"+e,!o),!1}}),m.commandManager.registerCommandModel(m.commands.TodoListToggleSubtasks,!1),m.commands.TodoListShowOldTasks=m.models.Command.extend({defaults:{id:"todo.list.show.old.todos"},execute:function(t){var e=t.get("id"),o=m.models.customization.get("showOld-"+e);return m.models.customization.save("showOld-"+e,!o),!1}}),m.commandManager.registerCommandModel(m.commands.TodoListShowOldTasks,!1),m.commands.TodoListCheckStateOldTodos=m.models.Command.extend({defaults:{id:"todo.list.check.state.old.todos"},execute:function(t){if(t){var e=t.get("id");return 1==m.models.customization.get("showOld-"+e)}}}),m.commandManager.registerCommandModel(m.commands.TodoListCheckStateOldTodos,!1),m.commands.TodoShowArchivedProjects=m.models.Command.extend({defaults:{id:"todo.show.archived.projects"},execute:function(t,e,o){var i="archived-"+o.id,s=m.models.customization.get(i);(m.models.customization.save(i,!s),o.get("supportProjects"))?(o.allProjectsCollectionSynced=!1,o.refreshAllProjects(!0)):o.selectedProject().doFetchIfNeeded(!0);return!1}}),m.commandManager.registerCommandModel(m.commands.TodoShowArchivedProjects,!1),m.commands.TodoCheckStateArchivedProjects=m.models.Command.extend({defaults:{id:"todo.check.state.archived.projects"},execute:function(t,e,o){return 1==m.models.customization.get("archived-"+o.id)}}),m.commandManager.registerCommandModel(m.commands.TodoCheckStateArchivedProjects,!1)},"./commands/trello.js":()=>{m.commands.TodoTrelloAuxData=m.models.Command.extend({defaults:{id:"todo.trello.aux"},execute:function(t){var e={};return t.collection&&t.collection.parentList&&(e.showAssignedOnly=m.models.customization.get("assigned-"+t.collection.parentList.id)),e}}),m.commandManager.registerCommandModel(m.commands.TodoTrelloAuxData,!1),m.commands.TodoTrelloOpenConfig=m.models.Command.extend({defaults:{id:"todo.trello.config"},execute:function(){m.commandManager.execute("settings.display",null,{section:"trello"})}}),m.commandManager.registerCommandModel(m.commands.TodoTrelloOpenConfig,!1)},"./models/dropdownmenuitem.js":t=>{t.models.DropdownMenuItem=Backbone.Model.extend({})},"./models/todo.js":t=>{t.models.TodoBase=Backbone.Model.extend({idAttribute:"csid",isTrue:function(t){var e=this.get(t);return void 0!==e&&1==e},getOrder:function(){return this.get("serversideOrder")||0===this.get("serversideOrder")?this.get("serversideOrder"):this.get("order")},attemptSave:function(){},retrySave:function(){this.get("isProxy")?this.collection.parentList&&this.collection.parentList.createNewModel&&this.collection.parentList.createNewModel(this):this.attemptedSaveValues&&this.attemptSave(this.model)},getValue:function(t){var e=null;return this.attemptedSaveValues&&Object.prototype.hasOwnProperty.call(this.attemptedSaveValues,t)&&(e=this.attemptedSaveValues[t]),e||(e=this.get(t)),e},isSibling:function(t){return t.get("parentId")==this.get("parentId")}}),t.models.Todo=t.models.TodoBase.extend({defaults:function(){return{title:"empty task...",done:!1,archive:!1,order:0,createdDate:m.date(),archivedDate:null,completedDate:null,deleted:!1,deletedDate:null,listId:"inbox",serverSetId:!1}},initialize:function(t,e){e=e||{},this.serverIdAttribute=this.collection.serverIdAttribute||"id",this.idAttribute=this.collection.idAttribute||"csid",this.parentList=e&&e.parentList||this.collection.parentList,this.id=this.get(this.idAttribute),this.get("csListId")||this.set({csListId:this.parentList.id},{silent:!0}),this.listenTo(m,"todo:set:done",this.setDone),this.listenTo(m,"todo:set:title",this.setTitle)},parse:function(t){return t&&t.done&&t.archive&&(t.listId="1-done"),t},setDone:function(t,e){t!==this.id&&t!==this.get("id")||this.setDoneState(e)},setTitle:function(t,e){if(t===this.id||t===this.get("id")){var o={title:e};this.attemptSave(o),m.trigger("todo:loadingStateChange",status)}},archive:function(){this.setArchiveState(!0)},setArchiveState:function(t){var e={};e.archive=void 0===t?!this.get("archive"):t,e.archive?(e.archivedDate=m.date(),this.get("done")||(e.done=!0,e.completedDate=m.date())):e.archivedDate=null,this.attemptSave(e)},setDoneState:function(t,e){var o=this.getDoneStateChanges(t,e);this.attemptSave(o),m.trigger("todo:loadingStateChange",status),t&&m.trigger("todo:complete",this)},getDoneStateChanges:function(t,e){var o={};if(o.done=void 0===t?!this.get("done"):t,o.done){var i=this.collection.parentList;if(i.has("done_disabled")){var s=i.get("done_disabled");return void(s.message&&m.trigger("todo:status",s))}o.completedDate=m.date(),e&&(o.archive=!0,o.archivedDate=m.date())}else o.archive=!1,o.archivedDate=null,o.completedDate=null;return o},getTodayStateChanges:function(t){var e={};return e.today=t,t&&this.get("archive")&&(e.archive=!1,e.archivedDate=null),e},setTodayState:function(t){var e=this.getTodayStateChanges(t);this.attemptSave(e)},deleteItem:function(){this.attemptSave({deleted:!0,deletedDate:m.date().toISOString()})},displayConnectingText:function(){},successfulConnection:function(){},failedConnection:function(){},getSupplementaryData:function(){var t=this.collection.parentList.project,e={};return e.projectId=this.get("projectId")||t.id,e.providerId=t.provider.id,e},attemptSave:function(t,e,o){var i=this;i.displayConnectingText('<i class="loading-icon"></i>Saving...');var s={patch:this.collection.onlineOnly,wait:!0};s.postponeSync=o;var n=this.collection.parentList.project;t&&(t.projectId=this.get("projectId")||n.id,t.providerId=n.provider.id);var d=!0;s.success=function(){d=!1;var t={};$.extend(t,i.attemptedSaveValues),i.attemptedSaveValues=null,$.extend(t,{saveFailed:!1,isLoading:!1}),m.trigger("todo:changed",i.get("id")||i.id,t),setTimeout((function(){i.set(t),i.successfulConnection(),e&&e(!0)}),50)},s.error=function(t,o){if(d=!1,200==o.status){var s={};$.extend(s,i.attemptedSaveValues),i.attemptedSaveValues=null,$.extend(s,{saveFailed:!1,isLoading:!1}),m.trigger("todo:changed",i.get("id")||i.id,s),setTimeout((function(){i.set(s),i.successfulConnection(),e&&e(!0)}),50)}else{i.set({saveFailed:!0,isLoading:!1,deleted:!1,deletedDate:null}),m.trigger("todo:loadingStateChange"),i.failedConnection('Error saving… <span class="retry">Retry</span>'),e&&e(!1)}},s.ignoreRender=!0,t?(i.attemptedSaveValues?$.extend(i.attemptedSaveValues,t):i.attemptedSaveValues=t,i.save(t,s)):i.attemptedSaveValues?(t=i.attemptedSaveValues,i.save(i.attemptedSaveValues,s)):i.pendingReorderData&&(i.set({isLoading:!0}),$.ajax({type:"PATCH",contentType:"application/json",data:JSON.stringify(i.pendingReorderData),url:m.globals.urlRootApi+"todos"}).done((function(){d=!1,i.set({isLoading:!1,saveFailed:!1})})).fail((function(){d=!1,i.set({saveFailed:!0,isLoading:!1})}))),d&&$.extend(t,{saveFailed:!1,isLoading:!0}),i.set(t),m.trigger("todo:changing",i.get("id")||i.id,t)},comparator:"order",save:function(t,e){e||(e={}),t||(t=_.clone(this.attributes));try{if(this.collection&&this.collection.parentList&&this.collection.parentList.collection&&this.collection.parentList.collection.aux_data&&$.extend(t,{aux_data:this.collection.parentList.collection.aux_data}),this.collection&&this.collection.parentList&&this.collection.parentList.collection&&this.collection.parentList.collection.aux_data_cmd){var o=m.commandManager.execute(this.collection.parentList.collection.aux_data_cmd,this,this.collection.parentList.collection.aux_data);$.extend(t,{aux_data:this.collection.parentList.collection.aux_data,aux_data_result:o})}}catch(i){console.log(i)}return Backbone.Model.prototype.save.call(this,t,e)},fetch:function(t){var e=t||{};return e.data=$.param({projectId:this.get("projectId"),providerId:this.get("providerId"),listId:this.get("listId")}),Backbone.Model.prototype.fetch.call(this,e)}}),t.models.TodoProxy=t.models.TodoBase.extend({defaults:function(){return{done:!1,isProxy:!0,isLoading:!0,saveFailed:!1,proxyValid:!0}}})},"./models/todolist.js":t=>{t.models.TodoList=Backbone.Model.extend({itemFetchStarted:!1,showAssignedTodosOnly:!1,analytics:new m.Analytics({feature:"todo"}),defaults:{selected:!1,deleted:!1},initialize:function(e,o){o&&(o.project?this.project=o.project:this.collection&&this.collection.project&&(this.project=this.collection.project),e.isDummy&&Object.assign(this.attributes,this.project.attributes),this.isComputed=e.isComputed);var i=this;this.serverIdAttribute=this.collection&&this.collection.serverIdAttribute||"id",this.idAttribute=this.collection&&this.collection.idAttribute||"csid",this.id=this.get(this.idAttribute)||e[this.idAttribute],this.itemCollection=new t.collect.Todos(null,{parentList:this,parent:this}),this.listenTo(this.itemCollection,"add remove change reset refresh",this.triggerChangeEvent),this.listenTo(this.itemCollection,"sync",(function(){i.itemFetchStarted=!1})),this.listenTo(this.itemCollection,"remainingCountChanged",this.remainingCountChanged),this.proxyCollection=new t.collect.TodoProxy(null,{parentList:this}),this.listenTo(this.proxyCollection,"add change",this.triggerChangeEvent),this.supportsFeature("assigned")&&this.refreshShowAssignedTodosOnly()},saveHandler:function(){var t=this;this.itemCollection.models.map((function(e){e.save({unsyncable:!1,listId:t.get(t.serverIdAttribute)},{silent:!0}),t.itemCollection.syncToServer()}))},isCustom:function(){return!this.isDoneList()&&!this.isTodayList()&&!this.isInboxList()},getColor:function(){if(this.get("color"))return this.get("color")},supportsFeature:function(t){return this.get("isDummy")?this.project.get(t+"_support"):this.get(t+"_support")},todoItemMenuOptions:function(){if(this.itemCollection.menuOptions&&(this._todoItemMenuOptions=new Backbone.Collection(this.itemCollection.menuOptions)),!this._todoItemMenuOptions){var t=[{captionText:"Edit",commandId:"todo.edit",attributes:[{name:"data-test",value:"edit-todo-item"}],css_class:"no-icon"},{captionText:"Set to daily goal",commandId:"todo.focus.pin",attributes:[{name:"data-test",value:"todo-set-focus"}],css_class:"no-icon"},{captionText:"Start focus mode ",commandId:"todo.focusMode.pin",attributes:[{name:"data-test",value:"todo-set-focus-mode"}],css_class:"no-icon"},{css_class:"line"},{captionText:"Move to Today",commandId:"todo.toggle.today",attributes:[{name:"data-test",value:"toggle-home-list-today"}],options:{},css_class:"no-icon"},{captionText:"Move Back",commandId:"todo.undone",options:{},css_class:"no-icon"},{captionText:"Move to...",commandId:"todo.moveTo",css_class:"no-icon"},{captionText:"Archive",commandId:"todo.archive",css_class:"no-icon"},{css_class:"line"},{captionText:"Delete",commandId:"todo.delete",attributes:[{name:"data-test",value:"delete-todo-item"}],css_class:"no-icon"}];m.conditionalFeatures.featureEnabled("plus")||t.splice(1,2),this._todoItemMenuOptions=new Backbone.Collection(t)}return this._todoItemMenuOptions},getSortedItems:function(){return this.itemCollection.activeToday().sort((function(t,e){return t.getOrder()-e.getOrder()}))},toggleSubtasks:function(){m.models.customization.get("assigned-"+this.id)||(this.allSubtasksLoaded=!0),this.itemFetchStarted=!0,this.itemCollection.firstLoadCompleted=!1,this.itemCollection.fetch({reset:!0})},loadOldCompletedTodos:function(){this.itemFetchStarted=!0,this.itemCollection.firstLoadCompleted=!1,this.itemCollection.fetch({reset:!0})},showAssignedTodosOnlyChanged:function(){this.refreshShowAssignedTodosOnly(),this.itemCollection.checkRemainingItemCount(),this.showAssignedTodosOnly&&this.loadAssignedTodosOnly||!this.allSubtasksLoaded&&m.models.customization.get("subtask-"+this.id)||this.itemCollection.noAssigned&&!this.allFetched?(this.loadAssignedTodosOnly=this.showAssignedTodosOnly,this.itemFetchStarted=!0,this.loadAssignedTodosOnly&&(this.allFetched=!0),this.itemCollection.firstLoadCompleted=!1,this.itemCollection.fetch({reset:!0})):m.trigger("todo:showAssignedTodosOnlyChanged",this.id),!m.models.customization.get("assigned-"+this.id)&&m.models.customization.get("subtask-"+this.id)&&(this.allSubtasksLoaded=!0)},refreshShowAssignedTodosOnly:function(){this.showAssignedTodosOnly=m.models.customization.get("assigned-"+this.id)},topMenuItems:function(){return this._topMenuItems||(this._topMenuItems=new t.collect.TopDropdownMenuItems(null,{listId:this.id})),this._topMenuItems},refreshItems:function(){this.doFetchIfNeeded(!0)},doFetchIfNeeded:function(t,e){if(t||!this.itemFetchStarted)if(this.loadedOnce||(this.loadAssignedTodosOnly=!1,this.loadedOnce=!0),m.conditionalFeatures.featureEnabled("offlineDataOnly")||(this.isComputed=!1,this.collection.offlineOnly=!1),this.isComputed){if(this.isDoneList()){var o=[];this.collection.models.map((function(t){o=o.concat(t.getDoneTodos())})),this.itemCollection.models=o}this.itemCollection.trigger("reset")}else!t&&this.itemFetchStarted||(this.itemFetchStarted=!0,this.showAssignedTodosOnly&&(this.loadAssignedTodosOnly=!0)),this.itemCollection.doFetchIfNeeded(e)},triggerChangeEvent:function(t){this.trigger("change",this),m.trigger("todo:globalChange",t)},getDefaultCommands:function(){return this.collection&&!this.collection.project.provider.isMomentum()?[]:this.isDoneList()?[{commandId:"todo.undone",options:{}}]:[{commandId:"todo.toggle.today",options:{}}]},isDoneList:function(){return"done"===this.get("type")},isTodayList:function(){return"today"===this.get("type")},isInboxList:function(){return"inbox"===this.get("type")},listType:function(){return this.get("type")},displayConnectingText:function(){},successfulConnection:function(){},failedConnection:function(){},getCount:function(){return this.get("count")||this.itemCollection.activeToday().length},remainingTodoCount:function(){var t=this.get("count");return void 0!==t&&null!=t?t:""},remainingCountChanged:function(t){var e=this.get("count"),o=this.isComputed?"set":"save";e!=t&&this.url.length&&this[o]({count:t},{ignoreSave:!0,ignoreRender:!0})},addTodo:function(t){t.homeListId=this.get(this.serverIdAttribute),this.itemCollection.create(t,{parentList:this,wait:!0}),this.changeCount(!0)},changeCount:function(t){var e=this.isComputed?"set":"save";if(void 0===this.get("count")){var o=this;setTimeout((function(){o.refreshItems()}),500)}else this[e]("count",this.get("count")+(t?1:-1))},supportsReordering:function(){return!!this.get("reorder")},getDoneTodos:function(){return this.isDoneList()?[]:(this.itemCollection.fetch({silent:!0}),this.itemCollection.where({done:!0,deleted:!1}))},getTodayTodos:function(){return this.isTodayList()?[]:(this.itemCollection.fetch({silent:!0}),this.itemCollection.where({today:!0,deleted:!1}))},groupingInfo:function(){return this.isDoneList()?{type:"date",field:"completedDate"}:this.itemCollection.groupingInfo?this.itemCollection.groupingInfo:null},statusColor:function(t){if(this.itemCollection.statuses)return this.itemCollection.statuses.find((function(e){return e.status===t})).color},createNewModel:function(e,o,i){var s={};this.collection&&1!=this.collection.project.provider.id&&(i=!1),(i=i||"top"==this.get("defaultTaskPosition"))&&(s={at:0}),this.addedToTop=i;var n=this.collection.offlineOnly,d=this.collection?this.collection.project.getDefaultList():this,a=d?d.get("id"):null,r=0;if("bottomOfIncomplete"==this.get("defaultTaskPosition")){for(;r<this.itemCollection.models.length&&!this.itemCollection.models[r].get("done");)r++;s={at:r}}var l=null;e instanceof Backbone.Model?l=e:(e.csListId=this.id,e.listId=this.get(this.serverIdAttribute),n&&this.isComputed&&(e.listId=a,e.csListId=a),this.isDoneList()&&(e.done=!0),this.isTodayList()&&(e.today=!0),e.viewSection=this.get("defaultSection"),l=new t.models.TodoProxy(e),this.proxyCollection.add(l,s)),this.showAssignedTodosOnly&&l.set("assigned",!0),l.set("viewSection",this.get("defaultSection"));var c=this;o?c.displayConnectingText('<i class="loading-icon"></i>Retrying...'):c.displayConnectingText('<i class="loading-icon"></i>Saving...'),l.set({saveFailed:!1,isLoading:!0});var h=c.isDoneList()&&a?a:l.get("listId"),u=null;Object.assign(s,{wait:!0,success:function(){l.set("proxyValid",!1),m.trigger("todo:loadingStateChange"),c.analytics.capture("todo add",{provider:c.formattedTodoListProvider(),is_paid_event:c.isCustom(),list:c.formattedTodoListName()})},serverSuccess:function(t){c.successfulConnection(),i&&c.project.provider.isMomentum()&&u?(u.move_id=t.get("id"),u.move_id&&(c.waitForReorder=!0,c.itemCollection.reorderItem(u,(function(){l.set("proxyValid",!1),c.waitForReorder=!1,m.trigger("todo:loadingStateChange")})))):l.set("proxyValid",!1)},error:function(){c.failedConnection('Error saving… <span class="retry">Retry</span>'),l.set({saveFailed:!0,isLoading:!1}),l.targetList=c}});var p=c.getSortedItems();p&&p.length>0&&(u={move_target_id:p[0].get("id"),move_offset:"-1",list_id:h}),s.parentList=this;var g=c.isComputed?d:c;g.itemCollection.create({title:l.get("title"),csListId:g.get("csid"),listId:g.get("id"),today:l.get("today"),done:l.get("done"),assigned:l.get("assigned"),homeListId:h,viewSection:l.get("viewSection"),providerId:this.project.provider.id,projectId:this.project.id,completedDate:l.get("done")?m.date():null,unsyncable:!this.get(this.serverIdAttribute)},s)},formattedTodoListName:function(){return this.project.provider.isMomentum()?this.isCustom()?"custom":this.get("title").toLowerCase():"integration"},formattedTodoListProvider:function(){return this.project.provider.isMomentum()?"momentum":this.project.provider.get("provider_title").toLowerCase().split("(")[0].trim()}})},"./models/todolistmanager.js":t=>{t.models.TodoListManager=Backbone.Model.extend({defaults:{activeTodoList:null},initialize:function(e){e&&e.prefetchTodos&&(this.prefetchTodos=!0),this.todoProviders=new t.collect.TodoProviders(null,{offlineOnly:e&&e.offline}),this.listenTo(m,"todoListManager:fetch",this.forceFetch),this.listenTo(m,"globalEvent:refreshInbox",this.refreshInbox),this.listenTo(this.todoProviders,"reset",this.todoProvidersReset),this.listenTo(m,"todo:loadingStateChange",this.handleLoadingStateChange)},handleLoadingStateChange:function(){var t=this.activeProvider.selectedList();t&&t.itemCollection&&"Done"===t.itemCollection.listStatus&&setTimeout((function(){m.trigger("todo:activeListLoaded")}),1)},setup:function(){var t=this,e=m.conditionalFeatures.featureEnabled("enhancedtodo-degraded");return new Promise((function(o){if(localStorage.activeTodoProvider&&!e){var i=JSON.parse(localStorage.activeTodoProvider);i&&i.id?t.changeProviderAsync(i.id).then(o):i?t.changeProviderAsync(i).then(o):t.changeProviderAsync("1").then(o)}else o(t.changeProvider("1"))}))},refreshInbox:function(){this.activeProvider.selectedProject().getDefaultList()&&this.activeProvider.selectedProject().getDefaultList().refreshItems()},triggerChangeEvent:function(){this.trigger("change",this)},forceFetch:function(){this.doFetchIfNeeded(!0)},doFetchIfNeeded:function(t){this.externallyFetchedOnce=!0,this.activeProvider.doFetchIfNeeded(t)},changeProviderAsync:function(t,e){var o=this;return new Promise((function(i){var s=o.changeProvider(t,e);s?i(s):o.todoProviders.loadedOnce?e?o.todoProviders.fetch({ignoreRender:!0,reset:!0,skipLocalFetch:!0,success:function(){o.changeProviderAsync(t)}}):i(null):o.listenTo(o.todoProviders,"loaded-from-server",(function(){i(o.changeProvider(t,!1,!0))}))}))},changeProvider:function(t,e,o){if(t&&(t=t.toString()),"1"===t||m.conditionalFeatures.featureEnabled("plus")){var i=this.todoProviderDetails(t,e);return i&&!i.get("supportProjects")&&(i.set("supportProjects",!1),i.set("supportLists",!0)),i&&this.activeProvider!==i&&(m.trigger("todo:topmenu:reset"),localStorage.activeTodoProvider=JSON.stringify(i.id),this.activeProvider&&this.stopListening(this.activeProvider),this.activeProvider=i,this.listenTo(this.activeProvider,"change",this.triggerChangeEvent),this.triggerChangeEvent(),(this.externallyFetchedOnce||this.prefetchTodos)&&this.activeProvider.refreshTodoItems(),m.trigger("todo:providerChanged",t)),!i&&o?($.ajax({type:"DELETE",contentType:"application/json",url:m.globals.urlRootApi+"settings/todo/providers/"+t}).done((function(){m.trigger("globalEvent:esc")})),this.changeProvider(1)):i}m.cmd("modal.open","UPSELL_TODO_INTEGRATIONS",{eventSource:"dash"})},switchProject:function(t){this.activeProvider.selectProject(t,!0)},getMomoLists:function(){var t=this;return new Promise((function(e){t.todoProviderDetails("1").getProjectAsync("1").then((function(t){var o=t.listCollection;0===o.models.length&&o.fetch({reset:!0}),e(o)}))}))},todoProvidersReset:function(){this.pendingResetCallback&&(this.pendingResetCallback(),this.pendingResetCallback=null)},resetProvider:function(t){var e,o;t||(e=1),t.id?(e=t.id.toString(),o=t):e=e.toString(),e.indexOf(this.activeProvider.id)>-1&&this.todoProviders.remove(this.activeProvider),this.todoProviders.get(e)||this.todoProviders.create(o||{id:e}),this.fetchTodoProviders(),this.changeProvider(e)},todoProviderDetails:function(t,e){var o,i;if(t||(t=1),t=t.toString(),this.todoProviders){if(this.todoProviders.length>0&&(o=this.todoProviders.get(t)))return o;if("1"===t){var s={id:t,prefetchTodos:this.prefetchTodos,add_lists:!0,supportLists:!0,supportProjects:!1};this.todoProviders.create(s)}if(!(o=this.todoProviders.get(t))){var n=this.todoProviders.models,d=t+"-";for(i=0;i<n.length;i++)if(n[i].get("id").startsWith(d))return n[i];var a=this;this.todoProviders.fetch({ignoreRender:!0,reset:!0,skipLocalFetch:e,success:function(){e&&a.changeProviderAsync(t)}}),(o=this.todoProviders.get(t))||m.trigger("todo:loadingStateChange",{status:"loading"})}return o}},fetchTodoProviders:function(t){var e=this;this.fetchingTodoProviders||(this.fetchingTodoProviders=!0,this.pendingResetCallback=function(){t?t():e.triggerChangeEvent()},this.todoProviders.fetch({skipLocalFetch:!0,reset:!0}))},selectPreviousProvider:function(){var t=this,e=function(){var e=t.todoProviders.get(t.activeProvider.id);if(e){var o=t.todoProviders.indexOf(e);if(o>0){var i=t.todoProviders.at(o-1);i&&t.changeProvider(i.id)}}};this.todoProviders&&(this.todoProviders.loadedOnce?e():this.fetchTodoProviders(e))},selectNextProvider:function(){var t=this,e=function(){var e=t.todoProviders.get(t.activeProvider.id);if(e){var o=t.todoProviders.indexOf(e);if(o<t.todoProviders.length-1){var i=t.todoProviders.at(o+1);i&&t.changeProvider(i.id)}}};this.todoProviders&&(this.todoProviders.loadedOnce?e():this.fetchTodoProviders(e))}})},"./models/todoproject.js":t=>{t.models.TodoProject=Backbone.Model.extend({itemFetchStarted:!1,defaults:{selected:!1},initialize:function(e,o){o&&o.provider?(this.provider=o.provider,this.set({providerId:this.provider.id},{silent:!0})):this.get("providerId")&&t.models.todoListManager&&(this.provider=t.models.todoListManager.todoProviderDetails(this.get("providerId"),!0)),this.listCollection=new t.collect.ProjectTodoLists(null,{project:this,prefetchTodos:this.prefetchTodos,isDummy:!(void 0===this.get("supportLists")?this.provider.get("supportLists"):this.get("supportLists"))}),this.listenTo(this.listCollection,"add remove change reset selectionChanged",this.triggerChangeEvent)},todoItemMenuOptions:function(){return this.listCollection.menuOptions&&(this._todoItemMenuOptions=new Backbone.Collection(this.listCollection.menuOptions)),this._todoItemMenuOptions},topMenuItems:function(){return this._topMenuItems||(this._topMenuItems=new t.collect.TopDropdownMenuItems(null,{listId:this.id})),this._topMenuItems},resetSelection:function(){this.listCollection.selectedListId=null},refreshItems:function(){this.doFetchIfNeeded(!0)},triggerChangeEvent:function(t){this.trigger("change",this),m.trigger("todo:globalChange",t)},doFetchIfNeeded:function(t){!t&&this.fetchStarted||(this.fetchStarted=!0,this.listCollection.doFetchIfNeeded(t))},refreshTodoItems:function(){var t=this.selectedList();t?t.refreshItems():this.listCollection.doFetchIfNeeded(!0)},getDefaultList:function(){return this.getListOfType("inbox")},getDoneList:function(){return this.getListOfType("done")},getListOfType:function(t){return this.listCollection.getListOfType(t)},getListById:function(t){return this.listCollection.getListById(t)},getDoneTodos:function(){var t=[];return this.listCollection.each((function(e){t=t.concat(e.getDoneTodos())})),t},getTodayTodos:function(){var t=[];return this.listCollection.each((function(e){e.getTodayTodos().map((function(e){t.indexOf(e)<0&&t.push(e)}))})),t},selectedList:function(){return this.listCollection?this.listCollection.selectedList():null},projectStatus:function(){if(this.listCollection.listStatus)return this.listCollection.listStatus;var t=this.selectedList();return t?t.listCollection.listStatus:null},addNewList:function(t,e){var o=this.listCollection.create({title:t,allow_move:!0,reorder:!0},{project:this,additionalData:{projectId:this.id,providerId:this.providerId||this.provider.id}});this.selectList(o.id),e&&e()},selectList:function(t){this.listCollection.selectItem(t),m.Analytics.capture("list switch",{feature:"todo",provider:this.selectedList().formattedTodoListProvider(),is_paid_event:this.selectedList().isCustom(),new_value:this.selectedList().formattedTodoListName()})},getNeighboringList:function(t){if(this.listCollection){var e=this.listCollection.selectedList();if(e){var o=this.listCollection.indexOf(e);if(t>0&&o<this.listCollection.length-1||t<0&&o>0)return this.listCollection.at(o+t)}}return null},selectPreviousList:function(){var t=this.getNeighboringList(-1);t&&this.selectList(t.id)},selectNextList:function(){var t=this.getNeighboringList(1);t&&this.selectList(t.id)}})},"./models/todoprovider.js":t=>{t.models.TodoProvider=Backbone.Model.extend({fetchStarted:!1,initialize:function(e){this.prefetchTodos=this.get("prefetchTodos"),void 0===e.supportLists&&(this.attributes.supportLists=!0,this.attributes.supportProjects=!1),this.projectCollection=new t.collect.ProviderTodoProjects(null,{provider:this,prefetchTodos:this.prefetchTodos,isDummy:!this.get("supportProjects")}),this.get("supportProjects")&&(this.allProjectsCollection=new t.collect.ProviderTodoProjectsAll(null,{provider:this})),this.listenTo(this.projectCollection,"reset",this.projectsAvailable),this.get("supportProjects")&&this.listenTo(this.allProjectsCollection,"sync",this.projectsAvailableSynced),this.listenTo(m,"globalEvent:altUp",this.altReleased),this.listenTo(this.projectCollection,"reset selectionChanged",this.triggerChangeEvent)},refreshItems:function(){this.projectCollection.fetch({reset:!0})},doFetchIfNeeded:function(t){!t&&this.fetchStarted||(this.fetchStarted=!0,this.projectCollection.doFetchIfNeeded(t))},getAllProjects:function(){if(this.allProjectsCollection&&this.allProjectsCollection.length>0)return this.allProjectsCollection;var t=localStorage.getItem("cachedTodoProjects-"+this.id);return!t||this.loadingFromCache||this.allProjectsCollection.loading?(this.refreshAllProjects(),this.allProjectsCollection):(this.loadingFromCache=!0,this.allProjectsCollection.reset(JSON.parse(t)),this.loadingFromCache=!1,this.allProjectsCollection)},projectsAvailableSynced:function(){var t=this;this.projectCollection.models.map((function(e,o){var i=t.allProjectsCollection.findWhere({id:e.get("id")});i?e.set("title",i.get("title")):(t.projectCollection.models.splice(o,1),t.projectCollection.length--)})),this.cacheAllProjects(),m.trigger("todo:allProjectsLoaded")},refreshAllProjects:function(t){this.allProjectsCollectionSynced||(this.allProjectsCollectionSynced=!0,this.allProjectsCollection&&this.allProjectsCollection.doFetchIfNeeded(t)&&m.trigger("todo:allProjectsLoaded"))},isMomentum:function(){return 1===this.id||"1"===this.id},cacheAllProjects:function(){var t=m.date();localStorage.setItem("tsCachedTodoProjects-"+this.id,JSON.stringify(t.getTime()));var e=this.allProjectsCollection.toJSON();localStorage.setItem("cachedTodoProjects-"+this.id,JSON.stringify(e))},projectsAvailable:function(){this.selectedProject()&&this.selectedProject().doFetchIfNeeded()},refreshTodoItems:function(){var t=this.selectedProject();t?t.refreshTodoItems():this.doFetchIfNeeded(!0)},getDefaultList:function(){return this.getListOfType("inbox")},getDoneList:function(){return this.getListOfType("done")},getListOfType:function(t){return this.selectedProject().getListOfType(t)},getListById:function(t){return this.selectedProject().getListById(t)},triggerChangeEvent:function(){this.trigger("change",this)},selectedList:function(){var t=this.selectedProject();return t?t.selectedList():null},selectedProject:function(){return this.projectCollection?this.projectCollection.selectedProject():null},providerStatus:function(){if(this.projectCollection.projectStatus)return this.projectCollection.projectStatus;var t=this.selectedProject();if(t&&t.listCollection.projectStatus)return t.listCollection.projectStatus;var e=this.selectedList();return e?e.itemCollection.listStatus:null},selectList:function(t){this.selectedProject().selectList(t)},getProject:function(t){return this.projectCollection.get(t)},getProjectAsync:function(t){var e=this;return new Promise((function(o){e.projectCollection.loadedOnce?o(e.projectCollection.get(t)):(e.projectCollection.loading||e.projectCollection.doFetchIfNeeded(),setTimeout((function(){e.getProjectAsync(t).then(o)}),50))}))},selectProject:function(t,e){var o=this.projectCollection.get(t);o?(this.projectCollection.selectItem(t),e&&o.set({last_active:m.date().toISOString()})):this.allProjectsCollection&&(o=this.allProjectsCollection.get(t))&&(this.projectCollection.add(o),this.projectCollection.selectItem(t),e&&o.set({last_active:m.date().toISOString()})),e&&m.trigger("todo:resetProjectList")},getNeighboringProject:function(t){var e=this.projectCollection;if(e=e.sortBy("last_active").reverse()){var o=this.selectedProject();if(o){var i=e.indexOf(o);if(t>0&&i<e.length-1||t<0&&i>0)return e[i+t]}}return null},selectPreviousProject:function(){this.altReleased=!1;var t=this.getNeighboringProject(-1);t&&(this.watchingAlt=!0,this.selectProject(t.id,!1))},selectNextProject:function(){this.altReleased=!1;var t=this.getNeighboringProject(1);t&&(this.watchingAlt=!0,this.selectProject(t.id,!1))},altReleased:function(){(this.altReleased=!0,this.watchingAlt)&&(this.selectedProject().set({last_active:m.date().toISOString()}),m.trigger("todo:resetProjectList"))}})},"./views/addtodolist.js":t=>{t.views.AddTodoList=Backbone.View.extend({tagName:"ul",attributes:{class:"todo-list-add-row"},template:t.templates.addtodolist,events:{keyup:"handleKeyup",keydown:"handleKeydown",click:"ignoreClick","click #list-new":"handleClick","blur #list-new":"handleBlur"},initialize:function(t){this.parent=t.parent,this.listenTo(m,"todo:loadingStateChange",this.render),this.adding=!1},render:function(){this.adding=!1;var t=!!m.conditionalFeatures.featureEnabled("plus");this.$el.html(this.template({isPlus:t})),this.$inputNewList=this.$("#list-new"),this.$addListIcon=this.$("#add-icon"),this.$loading=this.$(".todo-list-add-loading");var e=this.model.activeProvider.selectedList();return e&&e.get("add_hidden")?(this.$el.prop("disabled",!0),void this.$el.prop("placeholder","")):(this.$el.is(":disabled")&&(this.$el.prop("disabled",!1),this.$el.prop("placeholder","New List")),this.$loading.hide(),this.$addListIcon.css("display","block"),this)},ignoreClick:function(t){t.stopPropagation(),t.preventDefault()},handleClick:function(t){if(t.stopImmediatePropagation(),t.preventDefault(),!m.conditionalFeatures.featureEnabled("plus"))return this.$inputNewList.trigger("blur"),m.cmd("modal.open","UPSELL_MULTI_TODO",{eventSource:"dash"}),void m.trigger("globalEvent:closeDropdowns");this.adding=!0,this.$addListIcon.hide(),this.$el.addClass("input-mode"),this.$inputNewList.attr("placeholder",""),this.focusInputField()},handleBlur:function(){this.$inputNewList.val()||(this.$inputNewList.attr("placeholder","    New List").val(""),this.$addListIcon.css("display","block"),this.$el.removeClass("input-mode"))},cancelEdit:function(){this.adding=!1,this.$inputNewList.trigger("blur"),this.$inputNewList.attr("placeholder","    New List").val(""),this.$addListIcon.css("display","block")},createOnEnter:function(){var t=m.utils.capitalizeFirstLetter(this.$inputNewList.val());t&&0!=t.length&&0!=t.trim().length&&this.model.activeProvider&&(this.$inputNewList.val(""),this.model.activeProvider.selectedProject().addNewList(t,(function(){m.trigger("todo:listAdded")})),m.Analytics.capture("custom list add",{feature:"todo",is_paid_event:!0,location:"dash",provider:"momentum"}),this.adding=!1,this.$inputNewList.val(""),this.$inputNewList.trigger("blur"),this.$loading.css("display","inline"))},focusInputField:function(){this.$inputNewList.trigger("focus")},handleKeyup:function(t){13==t.keyCode?this.createOnEnter():27==t.keyCode&&(t.stopPropagation(),this.cancelEdit(),this.$el.trigger("blur"))},handleKeydown:function(t){}})},"./views/dropdownmenu.js":t=>{t.views.TodoDropdownMenu=Backbone.View.extend({template:t.templates.dropdownmenu,expanded:!1,renderedOnce:!1,menuOptionsFetched:!1,events:{"click .more-toggle":"toggleDropdown","dblclick .more-toggle":"eatDblClick","click li":"clickMenuItem","click .show-dropdown-detail":"showDropdownDetail","click .dropdown-detail-back":"hideDropdownDetail","mouseover .project-chooser-dropdown":"removeActiveItemClass","mouseleave .project-chooser-dropdown":"addActiveItemClass","click .failed-loading":"retryLoadingItems","click .dropdown-list":"eatDblClick","dblclick .dropdown-list":"eatDblClick"},initialize:function(t){this.submenu=null,this.menuItems=t.menuItems,this.loadAllOnExpand=t.loadAllOnExpand,this.parentContext=t.parentContext,this.comparisonNode=t.comparisonNode,this.iClassName=t.iClassName,this.dropdownClassName=t.dropdownClassName,this.providerLogo=t.providerLogo,this.keepOpen=t.keepOpen,this.listenTo(this.menuItems,"add remove reset",this.renderMenuOptions),this.listenTo(m,"globalEvent:closeDropdowns",this.closeDropdown),this.listenTo(m,"globalEvent:esc globalEvent:click",this.closeDropdown),this.listenTo(m,"todo:submenuUpdate",this.showDropdownDetail),this.listenTo(this.menuItems,"failedLoadingItems",this.failedLoading),this.listenTo(m,"todo:providerChanged",this.resetMenuItems),this.subViews=[]},render:function(){var t={};t.providerLogo=this.providerLogo,this.iClassName&&(t.iClassName=this.iClassName),"icon-cog"==this.iClassName&&(t.iClassName=""),this.dropdownClassName&&(t.dropdownClassName=this.dropdownClassName);var e=this.template(t);this.$el.html(e),this.$dropdown=this.$el.find(".dropdown").first(),this.$dropdownList=this.$el.find(".dropdown-list").first(),this.$todoProjectDropdown=this.$el.find(".project-chooser-dropdown .dropdown-list"),this.isOpen&&this.keepOpen&&(this.renderMenuOptions(),this.setExpandedState(!0));var o=this;this.dropdownClassName.includes("project-chooser-dropdown")&&this.$todoProjectDropdown.on("scroll",(function(){o.refreshItems()}))},updateModel:function(t){this.model=t},resetMenuItems:function(){this.menuOptionsFetched=!1,this.isLoading=!1,this.itemsRefreshed=!1;var t=this.expanded;delete this.expanded,t&&this.setExpandedState(t)},setExpandedState:function(t,e){if(this.expanded!=t){this.expanded=null!=t?t:!this.expanded,this.$el.toggleClass("active",this.expanded),this.$dropdown.closest(".dropdown-parent").toggleClass("dropdown-parent-active",this.expanded);var o=this;this.expanded?(this.$dropdown.css("display","block"),e?(o.$dropdown.css({opacity:1,display:"block"}),this.renderMenuOptions(),o.ensureVisible(o.$dropdown.height()),this.$dropdown.hasClass("project-chooser-dropdown")&&o.forceScrollableHeight(o.$dropdown)):(o.renderMenuOptions(),o.$dropdown.css({opacity:1,display:"block"}),o.ensureVisible(o.$dropdown.height()),o.$dropdown.hasClass("project-chooser-dropdown")&&o.forceScrollableHeight(o.$dropdown)),this.isOpen=!0):(this.$dropdown.css("opacity",0),this.hideDropdownDetail(null),this.isOpen=!1,setTimeout((function(){o.$dropdown.css("opacity")<.7&&o.$dropdown.hide()}),300)),this.$el.closest("li.todo-item").toggleClass("active",this.isOpen)}},forceScrollableHeight:function(t){if(t.find(".dropdown-list").children().length<=7){var e=t.height();t.addClass("short-list"),t.find(".dropdown-list").css("max-height",e)}else t.removeClass("short-list")},eatDblClick:function(t){t&&(t.preventDefault(),t.stopPropagation())},closeDropdown:function(t){this!=t&&!0===this.expanded&&this.setExpandedState(!1)},attachMenuItems:function(t,e){this.isLoading=!1,this.menuItems&&this.menuItems!=e&&this.stopListening(this.menuItems),this.$el[0]!=t[0]&&(this.setElement(t),this.renderedOnce=!1),this.menuItems!=e&&(this.menuItems=e,this.listenTo(this.menuItems,"add remove reset",this.renderMenuOptions),this.menuOptionsFetched=!1),this.render()},renderMenuOptions:function(){var t=this;if(this.items=this.getActiveMenuOptions(),this.items&&this.items.length>0){this.$dropdownList.html("");var e=this.items.filter((function(e){return m.commandManager.canExecute(e.get("commandId"),t.model,e.get("options"),t.parentContext)})),o=e.length;if(o>0){var i=0,s=null;_.each(e,(function(e){var n,d=e.get("css_class");(!d||"line"!=d||"line"!=s&&"header"!=s)&&("line"!=d||0!=i&&i!=o-1?(n=t.buildMenuItem(e),t.$dropdownList.append(n)):i+=1,i+=1,s=d)}))}}else 0==this.items&&t.$dropdownList.html('<li class="loading"><i class="loading-icon"></i> Loading...</li>');t.$dropdownList.height()>10&&(m.trigger("todolist:updateHeight",t.$dropdownList.height()+5),this.ensureVisible(this.$dropdown.height())),this.menuOptionsFetched=!0},buildMenuItem:function(t){var e,o=m.commandManager.getProperties(t.get("commandId"),this.model,t.get("options"),this.parentContext);o&&o.captionText&&(e=o.captionText);var i=t.get("css_class"),s=t.get("attributes"),n=$("<li/>");n.addClass("dropdown-list-item"),t.id?n.attr("data-itemid",t.id):n.attr("data-itemid",t.cid),t.get("toolTip")&&n.attr("title",t.get("toolTip"));var d=$("<span/>");if(d.addClass("dropdown-list-label"),d.text(e||t.get("captionText")),n.append(d),t.get("dataTest")&&n.attr("data-test",t.get("dataTest")),t.get("plusFeature")&&!m.conditionalFeatures.featureEnabled("plus")&&n.append('<span class="badge badge-plus">PLUS</span>'),t.get("imageUrl")){var a=$('<div class="dropdown-list-icon-wrapper"></div>');n.prepend(a);var r=$("<img />");r.addClass("dropdown-list-icon icon icon-"+t.get("captionText")),r.attr("src",t.get("imageUrl")),a.prepend(r)}var l=t.get("color")||t.getColor&&t.getColor();if(l){var c=$("<span />");c.html("&nbsp;"),c.addClass("list-color menu-item-color"),c.css("background-color",l),n.prepend(c)}if(t.get("todoIcon")){var h=t.get("todoIcon");n.prepend(h)}if(t.get("checkStateCmd")){var u=m.commandManager.execute(t.get("checkStateCmd"),this.model,t.get("options"),this.parentContext);t.get("todoIcon")?u?n.children().first().addClass("active"):n.children().first().removeClass("active"):u&&n.prepend('<i class="icon icon-check dropdown-list-icon"></i>'),t.get("captionTextOff")&&t.get("captionTextOn")&&d.text(u?t.get("captionTextOff"):t.get("captionTextOn"))}return s&&s.forEach((function(t){n.attr(t.name,t.value)})),i&&n.addClass(i),n},getActiveMenuOptions:function(){return!(this.menuItems&&this.menuItems.fetchIfRequired&&this.menuItems.fetchIfRequired(this.model.collection.provider.id))&&this.menuItems},toggleDropdown:function(t){t&&(t.stopPropagation(),t.preventDefault()),this.expanded||m.trigger("globalEvent:closeDropdowns",this),this.loadAllOnExpand&&!this.expanded&&this.showAllAvailableItems(),this.setExpandedState(!this.expanded)},clickMenuItem:function(t){t.preventDefault(),t.stopPropagation();var e=$(t.delegatedTarget).data("itemid");if(e&&this.items){var o=this.items.get(e);null==o&&(o=this.submenu.items.get(e));var i=o.get("commandId");if(void 0===i)return;var s=this;m.commandManager.getCommandAsync(i).then((function(t){var e=s.isOpen;s.isOpen=!1;var i=t.execute(s.model,o.get("options"),s.parentContext);s.isOpen=e,t.getSubmenu&&(s.submenu=t.getSubmenu()),o.get("checkStateCmd")&&s.renderMenuOptions(),i||s.closeDropdown(),t.getSubmenu&&s.submenu&&(s.listenTo(s.submenu.items,"sync",s.showDropdownDetail),s.submenu.items.fetchIfRequired&&s.submenu.items.fetchIfRequired(s.parentContext.id),s.showDropdownDetail())}))}},ensureVisible:function(t){var e=$(this.comparisonNode);if(this.comparisonNode&&this.$dropdown&&this.expanded){var o,i=this.$dropdown.closest(".todo-item"),s=t;s>e.height()&&(o=Math.min(s+5,document.body.getBoundingClientRect().height-150),m.trigger("todolist:updateHeight",o));var n=e.offset().top+e.height()-(i.offset().top+i.height()+s);n<4?this.$dropdown.css({top:Math.max(e.offset().top-i.offset().top,n+18)+"px",right:"40px"}):this.$dropdown.css({top:"28px"}),this.$dropdown.css({bottom:"auto",display:"block"})}else this.$dropdown&&!this.expanded&&m.trigger("todolist:updateHeight",0)},showDropdownDetail:function(){if(this.submenu){var t=this,e=$(this.$el.find(".dropdown-detail")[0]);if(e.html(""),this.submenu.items&&this.submenu.items.length>0){e.removeClass("todo-provider-loading"),this.$dropdown.hasClass("todo-actions-dropdown")&&this.$el.find(".dropdown").addClass("list-integrations");var o=this.submenu.items.length,i=this.submenu.title;if(i?e.append($('<li class="dropdown-list-item dropdown-detail-back dropdown-title">'+i+"</li>")):e.append($('<li class="dropdown-list-item dropdown-detail-back dropdown-list-label"><i class="icon icon-left dropdown-detail-title-back"></i></li>')),o>0){var s=null,n=this.submenu.items.models.filter((function(e){return m.commandManager.canExecute(e.get("commandId"),t.model,e.get("options"),t.parentContext)}));_.each(n,(function(o){var i=o.get("css_class");if(!i||"line"!=i||"line"!=s&&"header"!=s){var n=t.buildMenuItem(o);e.append(n),s=i}}))}var d=this.$el.find(".dropdown-detail").height();m.trigger("todolist:updateHeight",d),this.$el.find(".dropdown").addClass("show-detail").height(d),setTimeout((function(){t.ensureVisible(d+20)}),0)}else e.addClass("todo-provider-loading"),e.append($('<li class="loading dropdown-detail-back dropdown-title u--no-hover">Loading...</li>')),this.$el.find(".dropdown").addClass("show-detail")}},hideDropdownDetail:function(){var t=this.$el.find(".dropdown-list").height();m.trigger("todolist:updateHeight",t+20),this.$el.find(".dropdown").removeClass("show-detail").removeClass("list-integrations").height("auto");this.ensureVisible(t+20)},removeActiveItemClass:function(){this.$el.find(".active-item").removeClass("highlighted")},addActiveItemClass:function(){this.$el.find(".active-item").addClass("highlighted")},showAllAvailableItems:function(){this.isLoading||(this.isLoading=!0,this.trigger("showAllItems"))},failedLoading:function(){this.menuItems.pop(),this.menuItems.add({captionText:"Trouble connecting... Retry",css_class:"message failed-loading no-icon"})},retryLoadingItems:function(){this.menuItems.pop(),this.menuItems.add({captionText:"Loading...",css_class:"loading-dropdown u--no-hover"}),this.showAllAvailableItems()},refreshItems:function(){this.itemsRefreshed||(this.trigger("refreshItems"),this.itemsRefreshed=!0)}})},"./views/newtodoinput.js":t=>{t.views.NewTodoInput=Backbone.View.extend({events:{keyup:"handleKeyup",keydown:"handleKeydown",focus:"mobileOnlyUpdateTodoListHeight",blur:"onMobileBlur"},initialize:function(t){this.parent=t.parent,this.todoList=t.todoList,this.listenTo(m,"todo:loadingStateChange",this.render),m.utils.isTouchDevice()||this.listenTo(m,"todo:listAdded",this.focusInputField)},render:function(){var t=this.model.activeProvider.selectedList(),e=this.model.activeProvider.selectedProject();if(t){if(t.get("add_hidden"))return this.$el.prop("disabled",!0),void this.$el.prop("placeholder","");if(t.get("todo_type")||e&&e.get("todo_type")){var o="New "+(e.get("todo_type")?e.get("todo_type"):t.get("todo_type")).replace("Todo","Task").replace("todo","task");this.$el.prop("disabled",null),this.$el.prop("placeholder",o)}else this.$el.prop("disabled",null),this.$el.prop("placeholder","New Task"),this.$el.prop("title","Use "+m.utils.getMetaKeyName()+"-Enter to create a todo at top of the list")}this.$el.is(":disabled")&&(this.$el.prop("disabled",null),this.$el.prop("placeholder","New Task"))},onMobileBlur:function(){m.utils.isTouchDevice()&&(this.createOnEnter(),this.mobileOnlyUpdateTodoListHeight())},mobileOnlyUpdateTodoListHeight:function(){if(m.utils.isTouchDevice()){var t=function(){clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout((function(){m.trigger("todolist:updateHeight"),window.visualViewport.removeEventListener("resize",t)}),100)}.bind(this);window.visualViewport.addEventListener("resize",t)}},createOnEnter:function(t){if(!this.todoList.isLoading()){var e=this.model.activeProvider.selectedList();if(!e.isCustom()||m.conditionalFeatures.featureEnabled("plus")){var o=this.$el.val();if(o&&0!==o.length&&0!==o.trim().length&&e){e.changeCount(!0),this.$el[0].value="";var i=t&&(t.ctrlKey||t.metaKey);e.createNewModel({title:o},!1,i)}}else m.cmd("modal.open","UPSELL_MULTI_TODO",{eventSource:"dash"})}},focusInputField:function(){this.$el.trigger("focus")},handleKeyup:function(t){t.stopPropagation(),27===t.keyCode&&this.$el.trigger("blur")},handleKeydown:function(t){var e=null;if(13===t.keyCode?this.createOnEnter(t):32===t.keyCode?e="globalEvent:spacebar":37===t.keyCode?e="globalEvent:arrowLeft":39===t.keyCode&&(e="globalEvent:arrowRight"),e){var o=this.$el.val();o&&0!==o.length&&0!==o.trim().length||(t.preventDefault(),t.stopPropagation(),m.trigger(e,t))}}})},"./views/todoitem.js":t=>{t.views.TodoItem=Backbone.View.extend({attributes:{class:"todo-item","data-test":"todo-item"},tagName:"li",template:t.templates.todoitem,analytics:new m.Analytics({feature:"todo"}),events:{"click .todo-item-checkbox":"toggleDone",dblclick:"edit","keypress .editing":"handleInput","keypress .todo-item-title":"handleInput","blur .todo-item-title":"saveEdit","click .error-icon":"retrySave",dragstart:"dragstart",dragenter:"dragenter",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave"},editing:!1,renderedOnce:!1,initialize:function(t){this.parent=t.parent,this.provider=t.provider,this.listId=t.list_id,this.menu_options=t.menu_options,this.selectedList=this.provider.selectedList(),this.isDoneList=this.selectedList.isDoneList();var e=this;this.isTodayList=this.selectedList.isTodayList(),this.listenTo(this.model,"change",(function(){e.render()})),this.listenTo(this.model,"todo:edit",this.edit),this.listenTo(this.model,"todo:close",this.toggleDone),this.listenTo(this.model,"todo:open",this.toggleDone),this.listenTo(m,"todo:refresh",this.refreshTodo)},refreshTodo:function(t){t&&t==this.model.id&&this.model.fetch()},render:function(e){if(this.selectedList=this.provider.selectedList(),this.isDoneList=this.selectedList.isDoneList(),this.isTodayList=this.selectedList.isTodayList(),this.model.get("deleted"))return this.hideTodoItem(e),this;if(!this.isDoneList&&(this.model.get("csListId")!=this.selectedList.id&&(!this.isTodayList||!this.model.get("today"))||this.model.get("archive")))return this.hideTodoItem(e),this;if(this.isDoneList&&!this.model.get("done"))return this.hideTodoItem(e),this;if(!this.isTodayList&&!this.isDoneList&&this.model.get("today"))return this.hideTodoItem(e),this;if(this.isTodayList&&!this.model.get("today"))return this.hideTodoItem(e),this;var o=this.model.getValue("title");if(this.renderedOnce)this.$title.text(o);else{var i={title:o};this.$el.html(this.template(i)),this.$title=this.$el.find(".todo-item-title").first(),this.$checkbox=this.$el.find(".todo-item-checkbox").first(),this.renderedOnce=!0}if(this.$checkbox.prop("checked",this.model.isTrue("done")),this.$el.toggleClass("done",this.model.isTrue("done")),this.$el.toggleClass("loading",this.model.isTrue("isLoading")),this.$el.toggleClass("failed",this.model.isTrue("saveFailed")),this.$el.attr("data-todo-id",this.model.id),this.model.isTrue("isProxy")?(this.$el.addClass("isproxy"),this.$el.data("cid",this.model.cid)):!this.selectedList.supportsReordering()&&!this.selectedList.get("boardId")||this.model.get("noMove")||this.$el.prop("draggable","true"),this.menu_options&&"subsection"!=this.model.get("viewType")){var s=$(this.$el.find(".more")[0]);this.topMenuDropdownView||(this.topMenuDropdownView=new t.views.TodoDropdownMenu({el:s,iClassName:"icon-ellipsis",dropdownClassName:"todo-item-dropdown",menuItems:this.menu_options,model:this.model,parentContext:this.provider,comparisonNode:this.parent.$el})),this.topMenuDropdownView.render()}return"subsection"==this.model.get("viewType")&&this.$el.addClass("todo-subsection"),this.model.get("viewSectionId")&&this.$el.attr("data-view-section-id",this.model.get("viewSectionId")),this},hideTodoItem:function(t){this.$el.html(""),this.$el.hide(),this.stopListening(m,"globalEvent:spacebar"),this.parent&&!t&&this.parent.checkForEmptyState()},isHidden:function(){return!this.$el.is(":visible")},scrollIntoView:function(){this.parent.isScrolling&&this.$el[0].scrollIntoView(!1)},destroy:function(){this.stopListening(),this.remove(),this.unbind()},abortEdit:function(){this.editing&&(this.parent.toggleScroll(!0),this.$el.removeClass("editing"),this.$title.text(this.originalText),this.editing=!1)},setEditable:function(t,e){t.attr("contentEditable",e),t.closest(".todo-item").attr("draggable",!e)},saveEdit:function(){if(this.editing){this.$el.removeClass("editing"),this.parent.toggleScroll(!0);var t=this.$title.text();t?0===(t=t.trim()).length?this.abortEdit():this.model.attemptSave({title:t}):this.abortEdit(),this.editing=!1,this.setEditable(this.$title,!1),this.parent.updateHeight(),this.analytics.capture("todo edit",{provider:this.selectedList.formattedTodoListProvider(),is_paid_event:this.selectedList.isCustom(),list:this.selectedList.formattedTodoListName()})}},retrySave:function(){this.model.isTrue("isProxy")?this.model.targetList&&this.model.targetList.createNewModel(this.model,!0):(this.model.attemptedSaveValues||this.model.pendingReorderData)&&this.model.attemptSave()},edit:function(t){this.editing||(!this.selectedList.isCustom()||m.conditionalFeatures.featureEnabled("plus")?(this.originalText=this.$title.text(),t&&t.stopPropagation(),this.$el.hasClass("isproxy")||this.$el.hasClass("loading")||this.$el.hasClass("failed")||(this.editing=!0,this.parent.toggleScroll(!1),this.$el.addClass("editing"),this.setEditable(this.$title,!0),this.$title.trigger("focus"),m.utils.setEndOfContentEditable(this.$title.get(0)))):m.cmd("modal.open","UPSELL_MULTI_TODO",{eventSource:"dash"}))},dragstart:function(t){if(t.stopPropagation(),this.editing||this.topMenuDropdownView&&this.topMenuDropdownView.expanded)return!1;if(t.originalEvent.dataTransfer.effectAllowed="move",t.originalEvent.dataTransfer.setData("todo_id",this.model.id),!1===this.model.get("leafNode")){var e=this.$el.cloneNode(!0);e.className="ghost",e.style.position="absolute",e.style.zIndex="-1",e.querySelector(".todo-item-checkbox").style.marginTop="3px",t.delegatedTarget.appendChild(e),t.originalEvent.dataTransfer.setDragImage(e,t.originalEvent.offsetX-15,t.originalEvent.offsetY+2)}this.parent.dragmode="todo",m.trigger("todo:dragging",this),this.parent.dragging=this,this.parent.original_index=this.parent.li_index(this.$el,!0),0!==this.parent.original_index?(this.parent.$preceeding_item=this.previousSiblingTodo(),this.parent.preceedingTodoId=this.previousSiblingTodoId()):(this.parent.$preceeding_item=null,this.parent.preceedingTodoId=null),this.parent.$placeholder.height(this.parent.dragging.$el.height()),this.analytics.capture("todo reorder",{provider:this.selectedList.formattedTodoListProvider(),is_paid_event:this.selectedList.isCustom(),list:this.selectedList.formattedTodoListName()})},dragenter:function(t){if(t.stopPropagation(),!this.parent.selectedList.get("reorder"))return!1;var e=this.model.collection,o=e.offlineOnly?e.idAttribute:e.serverIdAttribute;if("todo"===this.parent.dragmode){if(!this.isSibling(this.parent.dragging.model))return!0;this.parent.dragging.$el.hide(),this.parent.li_index(this.parent.$placeholder)<this.parent.li_index(this.$el)?(this.$el.after(this.parent.$placeholder),this.parent.move_target_id=this.model.get(o),this.parent.move_offset=1):(this.$el.before(this.parent.$placeholder),this.parent.move_target_id=this.model.get(o),this.parent.move_offset=-1);var i=this.parent.$placeholder;return i.css("display","list-item"),i.after(this.parent.dragging.$el),!1}},isSibling:function(t){return this.model.isSibling(t)},previousSiblingTodo:function(){return this.$el.prevAll("li").not(".placeholder").first()},previousSiblingTodoId:function(){return this.$el.prevAll("li").not(".placeholder").first().data("todo-id")},onMouseEnter:function(){this.listenTo(m,"globalEvent:spacebar",this.invokeDefaultCommand)},onMouseLeave:function(){this.stopListening(m,"globalEvent:spacebar",this.invokeDefaultCommand)},invokeDefaultCommand:function(){var t=this,e=this.selectedList.getDefaultCommands();if(e&&e.length>0){var o=_.find(e,(function(e){return!!m.commandManager.canExecute(e.commandId,t.model,e.options,t.provider)}));o&&(m.commandManager.execute(o.commandId,t.model,o.options,t.provider),this.parent.updateHeight())}},toggleDone:function(t){if(t&&t.stopPropagation(),this.selectedList.has("done_disabled")){t&&t.preventDefault();var e=this.selectedList.get("done_disabled");e.message&&m.trigger("todo:status",e)}else{var o=!this.model.get("done");this.model.attemptSave({done:o,completedDate:o?m.date():null}),m.trigger("todo:complete",this.model),this.analytics.capture(o?"todo complete":"todo uncomplete",{provider:this.selectedList.formattedTodoListProvider(),is_paid_event:this.selectedList.isCustom(),list:this.selectedList.formattedTodoListName()}),this.selectedList.recurseOnDone=!0,(this.selectedList.get("recurse_on_done")&&o||this.selectedList.get("recurse_on_done")&&this.selectedList.get("recurse_on_reopen"))&&this.recurseToggleDone(this.model.id,o),this.topMenuDropdownView.resetMenuItems(),m.trigger("todo:loadingStateChange",null);var i=this.provider.getDoneList();i&&!this.selectedList.isDoneList()&&i.changeCount(o)}},recurseToggleDone:function(t,e){var o=this;this.selectedList.itemCollection.where({parentId:t}).forEach((function(t){t.save({done:e,completedDate:m.date()}),o.recurseToggleDone(t.id,e)}))},handleInput:function(t){this.editing&&(this.parent.updateHeight(),13===t.keyCode&&(this.saveEdit(),t.preventDefault(),t.stopPropagation()),27===t.keyCode&&(t.preventDefault(),t.stopPropagation(),this.abortEdit()))}})},"./views/todolist.js":t=>{t.views.TodoList=Backbone.View.extend({events:{dragover:"dragover",dragend:"dragend",drop:"drop","click .empty-link":"clickEmptyStateLink","click .empty-title":"clickEmptyTitleLink","click .todo-load-more-button":"loadMore","click .todo-section-collapsible":"toggleSection","click .new-todo-button":"showAndFocusTodoInput"},reordered:!1,monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],weekdayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],itemsRendered:!0,initialize:function(){this.scrollingAllowed=!0,this.emptyListGreeting="No tasks yet",this.emptyListSubmessage="Add a task to get started",this.subViews=[],this.isScrolling=!1;var t=this;this.$loading=$('<span class="message-fill centered"><i class="loading-icon"></i> Loading...</span>'),this.$inPlaceLoading=$('<span class="message-overlay centered"><i class="loading-icon"></i> <span class="loading-title">Loading...</span></span>'),this.listenTo(m,"globalEvent:key:enter",this.handleGlobalEnter),this.listenTo(this.model,"change",this.providerChanged),this.listenTo(this.model.project,"change",this.providerChanged),this.listenTo(m,"todo:loadingStateChange",this.handleTodoLoadingStateChange),this.listenTo(m,"todo:providerChanged",this.providerChanged),this.listenTo(m,"todo:listChanged",this.providerChanged),this.listenTo(m,"todo:showAssignedTodosOnlyChanged",this.showAssignedTodosOnlyChanged),this.listenTo(m,"todolist:updateHeight",this.updateHeight),this.listenTo(m,"todo:loadingStateChange",this.renderLoading),this.listenTo(m,"todo:show-new-todo-button",this.showNewTodoButton),this.listenTo(m,"todo:dragging",this.todoDragging),this.listenTo(m,"todolist:visible",this.render),this.listenTo(m,"appsReady",(function(){t.renderOnReady&&t.render()}))},render:function(){if(this.$el[0].removeAttribute("data-test-list-loaded"),this.blockListLoadedDebounce=!0,this.rendering=!0,this.$el.is(":visible")){this.renderedOnce||(this.$placeholder=$("<li></li>").addClass("placeholder"),this.$placeholder.appendTo(this.el),this.$placeholder.hide(),m.conditionalFeatures.featureEnabled("offlineDataOnly")||this.renderLoading({status:"loading"}),this.renderedOnce=!0),this.$el.addClass("todo-list"),this.updateListClass();var t=this;this.addAll((function(e){t.renderItems(e),t.rendering=!1,t.setDebouncedListLoading()})),this.selectedList&&!this.selectedList.itemCollection.everLoaded()&&this.renderLoading({status:"loading"})}else this.renderOnReady=!0},renderItems:function(e){var o=this.model.activeProvider.selectedList(),i=_.every(this.subViews,(function(t){return t.isHidden()}));i=i&&!this.$(".todo-section").filter(":visible").length,!e||i?this.renderEmptyState():(this.$el.removeClass("is-empty"),m.trigger("todo:show-input"),o&&o.isDoneList()&&!o.isComputed&&0==this.$el.find(".todo-load-more").length&&(this.lastCount&&this.lastCount==o.itemCollection.length?this.$el.append('<li class="todo-load-more"><span class="todo-load-more-done" style="text">That\'s all!</span></li>'):this.$el.append('<li class="todo-load-more"><span class="button todo-load-more-button">Load More</span></li>')));var s=this;this.$el.css("opacity",1),s.updateHeight(0),o&&!o.itemCollection.loadingFromServer&&o.itemCollection.everLoaded()&&this.removeLoading(),s.loadTriggered||(m.trigger(t.info.id+":loadedComplete"),s.loadTriggered=!0)},showAndFocusTodoInput:function(){this.$el.find(".new-todo-button").css({opacity:0}),m.trigger("todo:show-and-focus-input")},showNewTodoButton:function(){this.$el.find(".new-todo-button").css({opacity:1})},showAssignedTodosOnly:function(){this.model.activeProvider.selectedList().showAssignedTodosOnlyChanged()},toggleSubtasks:function(){this.model.activeProvider.selectedList().toggleSubtasks()},toggleShowOld:function(){this.model.activeProvider.selectedList().loadOldCompletedTodos()},loadMore:function(){this.$el.find(".todo-load-more-button").remove(),this.$el.find(".todo-load-more").prepend(this.$inPlaceLoading);var t=this.model.activeProvider.selectedList();this.lastCount=t.itemCollection.length,t.itemCollection.loadMore(this.endDate)},dismissEmptyState:function(){this.emptyStateActive&&(this.$el.find(".empty").hide(),m.trigger("todo:show-input"),this.emptyStateActive=!1)},checkForEmptyState:function(){if(this.subViews&&_.every(this.subViews,(function(t){return t.isHidden()}))){var t=this;this.rendering?setTimeout((function(){t.render()}),100):this.render()}},renderEmptyState:function(){var e;this.$el.addClass("is-empty"),this.emptyListGreeting="No tasks yet",this.emptyListSubmessage="Add a task to get started",this.overrideListType=null;var o=this.model.activeProvider.selectedList(),i=this.model.activeProvider.selectedProject();if(o){this.updateListClass();var s=o.get("todo_type");o.get("todo_type")&&(this.emptyListGreeting="No "+s+"s yet",this.emptyListSubmessage="Add a new "+s+" to get started",this.overrideListType=s.charAt(0).toUpperCase()+s.slice(1))}var n=i&&i.get("todo_type");if(n&&(this.emptyListGreeting="No "+n+"s yet",this.emptyListSubmessage="Add a new "+n+" to get started",this.overrideListType=n.charAt(0).toUpperCase()+n.slice(1)),o&&o.itemCollection&&o.itemCollection.firstLoadCompleted){var d={};if(o.has("empty_message"))d.message=o.get("empty_message"),d.submessage=o.get("empty_submessage"),d.use_command=!!o.get("empty_command");else if("today"==o.listType()){d.message=this.emptyListGreeting;var a=this.model.activeProvider.selectedProject().getListOfType("inbox");if(a){d.targetListId=a.id;var r=a.get("count");1==r?d.submessage="1 task in Inbox":r>1?d.submessage=r+" tasks in Inbox":(d.submessage="Switch to Inbox",d.message="Add a task to get started")}}else if("inbox"==o.listType())d.message=this.emptyListGreeting,(e=this.model.activeProvider.selectedProject().getListOfType("today"))&&(d.targetListId=e.id,d.submessage="Switch to Today",d.message="Add a task to get started");else if("done"==o.listType())d.message="No completed tasks yet",(e=this.model.activeProvider.selectedProject().getListOfType("today"))&&(d.targetListId=e.id,d.submessage="Get started in Today");else if(o.showAssignedTodosOnly&&o.itemCollection.models.length>0){var l="No tasks assigned to me";o.get("todo_type")&&(l="No "+o.get("todo_type")+"s assigned to me"),o.get("project")&&o.get("project").get("todo_type")&&(l="No "+o.get("project").get("todo_type")+"s assigned to me"),d.message=l}else d.message=this.emptyListGreeting,d.submessage=this.emptyListSubmessage;d.subMessageClickable=d.targetListId||d.use_command,d.listType=this.overrideListType||"Task",m.trigger("todo:hide-input"),this.$el.find("new-todo-button").css({opacity:1}),this.emptyStateActive=!0,this.$el.html(t.templates["todo-list-empty-state"](d)),this.itemsRendered=!0,this.updateHeight(0)}},setDebouncedListLoading:function(){var t=this;clearTimeout(this.listLoadedDebounce),this.blockListLoadedDebounce=!1,this.listLoadedDebounce=setTimeout((function(){t.blockListLoadedDebounce||t.$el.data("test-list-loaded","")}),200)},addedToProxyCollection:function(t,e,o){this.isScrolling||this.$el.addClass("hide-scroll"),this.dismissEmptyState(),this.addOne(t,o?o.at:null)},addOne:function(e,o,i,s){var n=this,d=null,a=this.model.activeProvider.selectedList();a&&(d=a.todoItemMenuOptions());var r=new t.views.TodoItem({model:e,parent:this,menu_options:d,provider:this.model.activeProvider,list_id:a.id});this.subViews.push(r);var l=r.render(s).el,c=e.get("parentId");if(c){var h=this.getTodoSubelementContainer(c);h?h.append(l):this.$el.append(l)}else if(e.get("depth")>1){var m=this.$el.find("li").last().attr("data-todo-id"),u=a.itemCollection.where({id:m});if(u.length>0&&(e.get("depth")==u[0].get("depth")&&u[0].get("parentId")&&(m=u[0].get("parentId")),e.get("depth")<=u[0].get("depth")-1&&u[0].get("parentId"))){m=u[0].get("parentId");var p=a.itemCollection.where({id:m});if(p[0].get("parentId")&&(m=p[0].get("parentId")),e.get("depth")==u[0].get("depth")-2&&u[0].get("parentId")){m=p[0].get("parentId");var g=a.itemCollection.where({id:m});g[0].get("parentId")&&(m=g[0].get("parentId"))}}e.set("parentId",m);var f=this.getTodoSubelementContainer(m);f&&f.append(l)}else if(e.get("isProxy")&&a.isDoneList())$(this.$el.find("li.todo-section")[0]).after(l);else if(o||0===o){for(var v=-1,C=this.$el.children(),y=0;v<o;){var T=$(C[y++]);T.hasClass("todo-section")||v++}v>=0?T.before(l):this.$el.prepend(l)}else this.$el.append(l);e.get("isProxy")&&e.get("proxyValid")?(this.isScrolling&&r.scrollIntoView(),this.newTodoAdded=!0,function(){var t=!1;n.addedToTop&&(n.$el.addClass("drop-top-margin"),t=!0);$(l).addClass("transition"),setTimeout((function(){t&&n.$el.removeClass("drop-top-margin"),$(l).addClass("visible"),setTimeout((function(){$(l).removeClass("transition")}),200)}),1)}()):$(l).addClass("visible")},getTodoSubelementContainer:function(t){var e=this.$el.find('[data-todo-id="'+t+'"]');if(e&&e.length>0){var o=$(e[0]).find("ol").first();if(!o||0==o.length){var i=$("<ol>");return $(e[0]).append(i),i}return $(o)}return null},handleGlobalEnter:function(){this.$el.hasClass("is-empty")&&this.showAndFocusTodoInput()},addAll:function(t){var e=this,o=function(){var o=e.addAllNow();null!=o&&t(o)},i=this.model.activeProvider.selectedList();this.lastLisId!==i&&i?(this.lastLisId=i,setTimeout(o,200),this.$el.css("opacity",0)):i&&o()},addAllNow:function(){_.each(this.subViews,(function(t){t&&t.destroy()})),this.subViews=[];var t=!1;this.reordered=!1;var e=this;this.$el.html("");var o=this.model.activeProvider.selectedList();if(o){if(!o.get("loadedOnce")&&!o.itemCollection.onlineOnly)return null;var i=o.getSortedItems(),s=o.proxyCollection.where({proxyValid:!0});i.length>0&&(t=!0),s&&s.length>0&&(t=!0);var n,d=!1,a=o.groupingInfo();if(a){var r=[];if("date"===a.type){if(!_.isEmpty(i)){var l=_.map(i,(function(t){var e=t.get(a.field),o=new Date(e);return{sortDate:o.getTime(),year:o.getFullYear(),month:o.getMonth(),day:o.getDate(),item:t}}));n=_(l).chain().sortBy("sortDate").reverse().value();var c=null,h=null,m=null;_.each(n,(function(t){if(t.year!=c||t.month!=h||t.day!=m){c=t.year,h=t.month,m=t.day;var o=e.formatDate(t),i=o.calendarDate;r.push(i),e.$el.append('<li draggable="false" data-view-section-parent-id="'+i+'" class="todo-section" title="'+o.calendarDate+'">'+o.friendlyDate+"</li>"),t.item.set("viewSectionId",o.calendarDate)}e.addOne(t.item,null,null,!0),e.endDate=t.item.get("completedDate")}))}d=!0}else if("viewSection"==a.type){var u="";n=_.sortBy(i,(function(t){return a.order[t.get("viewSection")]})),_.each(n,(function(t){if(t.get("viewSection")!=u){u=t.get("viewSection");r.push(u),e.$el.append('<li style="color: '+o.statusColor(t.get("viewSection"))+'" data-view-section-parent-id="'+u+'"class="todo-section todo-section-collapsible">'+u.replace("_"," ")+'<svg class="icon icon-tick" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 292.362 292.362"><path d="M286.935 69.377c-3.614-3.617-7.898-5.424-12.848-5.424H18.274c-4.952 0-9.233 1.807-12.85 5.424C1.807 72.998 0 77.279 0 82.228c0 4.948 1.807 9.229 5.424 12.847l127.907 127.907c3.621 3.617 7.902 5.428 12.85 5.428s9.233-1.811 12.847-5.428L286.935 95.074c3.613-3.617 5.427-7.898 5.427-12.847 0-4.948-1.814-9.229-5.427-12.85z"/></svg></li>')}t.set("viewSectionId",u),e.addOne(t,null,null,!0)})),d=!0}r.forEach((function(t){e.updateSectionExpansion(t)}))}d||(_.each(i,(function(t,o){e.addOne(t,!1,o==i.length-1,!0),e.endDate=t.get("completedDate")}),this),_.each(s,(function(t){e.addOne(t,null,null,!0)}),this))}if(t&&(this.itemsRendered=!0),(o=this.model.activeProvider.selectedList())&&(this.addedToTop=o.addedToTop),this.newTodoAdded){var p=this.addedToTop?this.$el.children().first():this.$el.children().last();p&&p.length>0&&this.isScrolling&&p[0].scrollIntoView(!1),this.newTodoAdded=!1,this.addedToTop=!1}return t},updateSectionExpansion:function(t){var e="collapsed-"+this.model.activeProvider.selectedList().id+":"+t,o=m.models.customization.get(e);null==o&&(o=!1),this.$el.find('[data-view-section-id="'+t+'"]').toggleClass("hidden",o),this.$el.find('[data-view-section-parent-id="'+t+'"]').toggleClass("todo-section-collapsed",o),m.trigger("todo:sectionExpansion")},toggleSection:function(t){var e=this.model.activeProvider.selectedList(),o=t.delegatedTarget.dataset.viewSectionParentId,i="collapsed-"+e.id+":"+o;m.models.customization.set(i,!m.models.customization.get(i)),this.updateSectionExpansion(o),this.updateHeight()},formatDate:function(t){var e=m.date(),o=this.monthNames[t.month]+" "+t.day+(e.getFullYear()==t.year?"":", "+t.year);if(t.year==e.getFullYear()&&t.month==e.getMonth()&&t.day==e.getDate())return{friendlyDate:"Today",calendarDate:o};var i=new Date(e.getTime()-864e5);if(t.year==i.getFullYear()&&t.month==i.getMonth()&&t.day==i.getDate())return{friendlyDate:"Yesterday",calendarDate:o};var s=new Date(t.sortDate);return s>new Date(e.getTime()-5184e5)?{friendlyDate:this.weekdayNames[s.getDay()],calendarDate:o}:{friendlyDate:o,calendarDate:""}},clickEmptyStateLink:function(t){if(t&&t.delegatedTarget){if(t.preventDefault(),t.stopPropagation(),$(t.delegatedTarget).data("use-command")){var e=this.model.activeProvider.selectedList(),o=e.get("empty_command"),i=e.get("empty_command_options");return void m.commandManager.execute(o,null,i)}var s=$(t.delegatedTarget).data("target-list-id");s&&(m.Analytics.capture("go to "+(s.includes("today")?"today":"inbox"),{feature:"todo",provider:"momentum"}),this.model.activeProvider.selectList(s))}},clickEmptyTitleLink:function(t){if(t&&t.delegatedTarget&&(t.preventDefault(),t.stopPropagation(),$(t.delegatedTarget).text()==this.emptyListGreeting)){var e=this.$el.parent().find(".todo-new")[0];e&&e.trigger("focus")}},dragover:function(t){return t.preventDefault(),t.stopPropagation(),t.originalEvent.dataTransfer.dropEffect="move",!1},dragend:function(t,e){t.preventDefault(),this.$el.removeClass("dragging"),this.$el.closest("#todo").removeClass("has-drop-left has-drop-right");var o=this.$el[0].getBoundingClientRect(),i=t.originalEvent.pageX,s=t.originalEvent.pageY,n=this.dragging.model.collection,d=n.offlineOnly?n.idAttribute:n.serverIdAttribute,a=this.dragging.model.get(d);if(this.move_target_id!==a&&!0!==e){if(i-10<o.right&&i+30>o.left&&s-20<o.top&&o.top-s<40)return void this.drop(t);if(i-10<o.right&&i+30>o.left&&s+20>o.bottom&&s-o.bottom<40)return void this.drop(t)}if("todo"===this.dragmode){var r=this.dragging.$el;this.$placeholder.hide(),r.css("display","inline-block"),r.find(".ghost").remove()}return!1},drop:function(t){if(!this.selectedList.get("reorder"))return this.dragend(t,!0),!1;if("todo"===this.dragmode){var e=this.dragging.$el,o=this.dragging.model.collection,i=o.offlineOnly?o.idAttribute:o.serverIdAttribute,s=this.dragging.model.get(i),n=this.move_target_id;if(n===s)return void this.dragend(t);t.preventDefault(),this.$el.closest("#todo").removeClass("has-drop-left has-drop-right");var d=this.move_offset;if(0===this.li_index(this.dragging.$el,!0)&&0===this.original_index)return this.dragend(t,!0),!1;if(this.preceedingTodoId==this.dragging.previousSiblingTodoId())return this.$placeholder.hide(),e.css("display","inline-block"),!1;var a=this.model.activeProvider.selectedList(),r={};r[i]=s;var l=a.itemCollection.findWhere(r);r[i]=n;var c=a.itemCollection.findWhere(r);if(!l||!c||!l.isSibling(c))return!1;var h=this;this.$placeholder.hide(),e.css("display","inline-block"),a.itemCollection.reorderItem({move_id:s,move_target_id:n,move_offset:d,list_id:a.get("id")},(function(){h.removeLoading()})),this.reordered=!0}},getTopActiveTodoId:function(){return this.$("li").not(".done, .placeholder, .todo-section, .todo-subsection, .hidden").first().data("todo-id")},li_index:function(t,e){return e?this.$("li").not(".placeholder").index(t):this.$("li").index(t)},handleManagerChange:function(){this.render()},handleTodoLoadingStateChange:function(t){this.selectedList&&this.selectedList.waitForReorder||t&&"loading"==t.status||this.render()},showAssignedTodosOnlyChanged:function(t){var e=this.model.activeProvider.selectedList();e&&e.id==t&&this.render()},providerChanged:function(){var t=this.model.activeProvider.selectedList();this.selectedList!=t&&t&&(this.itemsRendered=!1,this.selectedList&&this.stopListening(this.selectedList.proxyCollection),this.selectedList=t,this.listenTo(t.proxyCollection,"add",this.addedToProxyCollection),this.listenTo(m.models.customization,"change:subtask-"+t.id,this.toggleSubtasks),this.listenTo(m.models.customization,"change:showOld-"+t.id,this.toggleShowOld),t.supportsFeature("assigned")&&this.listenTo(m.models.customization,"change:assigned-"+t.id,this.showAssignedTodosOnly))},todoDragging:function(){this.$el.addClass("dragging"),this.isScrolling||this.$el.addClass("hide-scroll")},toggleScroll:function(t){this.scrollingAllowed=t,this.$el.toggleClass("hide-scroll",!t)},updateHeight:function(e){if(!e)try{t.views.todoPane.todoHeader.projectDropdownView.expanded&&(e=Math.max(t.views.todoPane.todoHeader.projectDropdownView.$dropdown.height(),e)),t.views.todoPane.todoHeader.topMenuDropdownView.expanded&&(e=Math.max(t.views.todoPane.todoHeader.topMenuDropdownView.$dropdown.height(),e))}catch(i){console.log(i)}const o=this.$el;o.addClass("hide-scroll"),o.on("transitionend webkitTransitionEnd",(()=>{o.removeClass("hide-scroll")})),o.css({"min-height":e+"px",transition:`min-height ${e?"0.15s":"0.35s"} linear`})},renderLoading:function(t){var e=this,o=m.reactive.appsReady&&m.now()-m.appsReadyAt>1e3?100:700;m.conditionalFeatures.featureEnabled("offlineDataOnly")||t&&("loading"===t.status?(this.loadingRemoved=!1,setTimeout((function(){e.loadingRemoved||(e.subViews.length>0||e.$el.find(".empty").is(":visible")?(e.$loading.removeClass("message-fill"),e.$loading.addClass("message-overlay"),t.listChanged||e.$el.parent().append(e.$loading)):(e.$loading.removeClass("message-overlay"),e.$loading.addClass("message-fill"),e.$el.parent().append(e.$loading)))}),o)):"error"===t.status&&setTimeout((function(){e.removeLoading()}),20))},removeLoading:function(){this.loadingRemoved=!0,this.$loading.remove(),this.$inPlaceLoading.remove(),this.updateHeight()},isLoading:function(){return this.$loading.parent().length>0},updateListClass:function(){var t=this.model.activeProvider.selectedList(),e=t&&t.get("list_class");this.lastListClass&&this.$el.removeClass(this.lastListClass),e&&this.$el.addClass(e),this.lastListClass=e}})},"./views/todolistheader.js":t=>{t.views.TodoListHeader=Backbone.View.extend({events:{"mouseenter .active-list-container":"handleHeaderHover","mouseleave .active-list-container":"handleHeaderLeave","click .todo-list-choice":"chooseList","click .todo-list-choice-active":"stopChoosing","click .todo-folder":"toggleFolder","click .active-list-container":"handleHeaderClick","click .project-chooser":"toggleProjectDropdown","click #status-action":"statusActionClick","click .mobile-close":"hideTodo"},choosing:!1,initialize:function(t){this.listeningTo=null,this.parent=t.parent,this.listenTo(m,"globalEvent:closeDropdowns",this.stopChoosing),this.listenTo(this.model,"change",this.handleManagerChange),this.listenTo(m,"todo:loadingStateChange",this.handleTodoLoadingStateChange),this.listenTo(m,"todo:providerChanged",this.providerChanged),this.listenTo(m,"todo:changed",this.todoChanged),this.listenTo(m.models.customization,"change:autoFocus",this.autoFocusChanged),this.listenTo(m.models.customization,"change:assigned-"+this.id,this.showAssignedTodosOnlyChanged),this.listenTo(m,"globalEvent:click",this.globalClick),this.listenTo(m,"todo:status",this.renderActiveItem),this.listenTo(m,"todo:renderLists",this.renderActiveItem),this.listenTo(m,"todo:topmenu:reset",this.topMenuReset),this.listenTo(m,"todo:resetProjectList",this.resetProjectList),this.listenTo(m,"todo:allProjectsLoaded",this.prepareProjectList),this.listenTo(m,"todo:listChanged",this.renderActiveItem),this.defaultColor="rgba(0,0,0,0)",this.model.activeProvider&&this.model.activeProvider.selectedProject()&&(this.activeList=this.model.activeProvider.selectedProject().listCollection)},render:function(t){var e=this.activeList;e&&this.listeningTo!==e&&(this.listenTo(e,"change",this.handleCollectionChange),this.listeningTo&&this.stopListening(this.listeningTo,"change"),this.listeningTo=e),this.model.activeProvider.get("supportProjects")&&this.prepareProjectList(),this.$activeContainer=this.$el.closest(".header"),this.$chooserContainer=this.$(".list-chooser"),this.renderActiveItem(t);var o=this.model.todoProviderDetails(this.model.activeProvider.id);if(o){if(this.$el.closest(".todo").removeClass(this.providerClass),o.get("provider_title")){var i=o.get("provider_title").indexOf("-");this.providerClass="todo-"+o.get("provider_title").substring(0,i>0?i:o.get("provider_title").length)}this.$el.closest(".todo").addClass(this.providerClass)}},handleHeaderHover:function(){this.$(".project-chooser").addClass("hover")},handleHeaderLeave:function(){this.$(".project-chooser").removeClass("hover")},handleHeaderClick:function(t){$(t.delegatedTarget.parentElement).hasClass("show-external")?this.visitExternal():this.toggleChooser(t,!this.model.activeProvider.get("supportLists"))},visitExternal:function(){var t=this.model.activeProvider.selectedList().get("url");t||(t=this.providerUrl),m.utils.getBrowser().tabs.create({url:t})},toggleChooser:function(t,e){t&&(t.preventDefault(),t.stopPropagation()),(this.model.activeProvider.selectedProject().listCollection.length>1||this.model.activeProvider.isMomentum())&&(m.trigger("globalEvent:closeDropdowns",this),this.setChoosingState(!this.choosing)),e&&this.toggleProjectDropdown()},toggleProjectDropdown:function(t){t&&(t.preventDefault(),t.stopPropagation()),this.model.activeProvider.get("supportProjects")&&this.projectDropdownView.toggleDropdown()},globalClick:function(t){t!=this&&this.setChoosingState(!1)},todoChanged:function(t,e){e&&(Object.prototype.hasOwnProperty.call(e,"done")||Object.prototype.hasOwnProperty.call(e,"listId"))&&this.renderActiveItem()},topMenuReset:function(){this.topMenuDropdownView&&this.topMenuDropdownView.resetMenuItems()},autoFocusChanged:function(){this.renderActiveItem()},showAssignedTodosOnlyChanged:function(){this.renderActiveItem()},setChoosingState:function(t){if(this.choosing!=t)if(this.choosing=t,this.$(".active-list-container").toggleClass("active",this.choosing),this.choosing){var e=this;setTimeout((function(){e.$chooserContainer.css("display","block"),m.trigger("todolist:updateHeight",e.$chooserContainer.height())}),30)}else m.trigger("todolist:updateHeight",0),this.$chooserContainer.hide()},stopChoosing:function(e){e!=this&&e!=t.views.todoPane&&this.setChoosingState(!1)},chooseList:function(t){t&&t.stopPropagation(),this.stopChoosing();var e=$(t.delegatedTarget).data("list-id");this.model.activeProvider.selectList(e)},statusActionClick:function(t){if(t){t.preventDefault(),t.stopPropagation();var e=$(t.delegatedTarget).data("action");e&&m.commandManager.execute(e,this.lastStatus)}},handleCollectionChange:function(t){if(t){var e=t.get("count"),o=this.$el.find("[data-list-id='"+t.get(t.idAttribute)+"']");$(o.find(".todo-count")[0]).text(e);var i=this.model.activeProvider.selectedList();i&&i.get(i.idAttribute)==t.get(t.idAttribute)&&$(this.$el.find(".active-todo-count")[0]).text(e)}},renderActiveItem:function(e){var o=this;if(this.$activeContainer){if(this.model.activeProvider.selectedProject()&&this.model.activeProvider.selectedProject().listCollection){var i={},s={};e||(e=this.model.activeProvider.providerStatus()),e&&(this.lastStatus=e,"loading"!=e.status&&e.message&&(i.statusMessage=e.message,e.actionMessage&&(i.actionMessage=e.actionMessage),e.action&&(i.action=e.action),e.duration&&setTimeout((function(){o.$el.find(".todo-message").mFadeOut(),o.$el.closest(".app-container").removeClass("has-message")}),e.duration))),i.supportProjects=this.model.activeProvider.get("supportProjects"),i.supportsFolders=this.model.activeProvider.get("supports_folders"),i.no_caps=this.model.activeProvider.get("no_caps");var n=this.model.activeProvider.selectedProject();i.supportLists=void 0===n.get("supportLists")?this.model.activeProvider.get("supportLists"):n.get("supportLists");var d,a,r,l,c,h,u=n.selectedList();if(this.topMenuDropdownView&&this.topMenuDropdownView.updateModel(u),u){var p=u.getColor();i.color=p?p.indexOf("rgb")<0&&"#"!=p.charAt(0)?"#"+p:p:this.defaultColor,i.listTitle=u.get("title"),i.providerLogo=u.get("small_icon_url"),i.remaining=u.remainingTodoCount()}if(n&&(p=n.get("color"),s.color=p?p.indexOf("rgb")<0&&"#"!=p.charAt(0)?"#"+p:p:this.defaultColor,s.listTitle=n.get("title"),s.providerLogo=n.get("small_icon_url")),!i.providerLogo&&this.model.activeProvider&&1!=this.model.activeProvider.id&&(d=this.model.todoProviderDetails(this.model.activeProvider.id))&&(i.providerLogo=s.providerLogo=d.get("small_icon_url"),i.providerTitle=s.providerTitle=d.get("provider_title"),this.providerUrl=d.get("provider_url")),!this.compareObjects(i,this.lastContext)||!this.compareObjects(s,this.lastParentContext)){this.lastContext=i,this.lastParentContext=s,d=this.model.todoProviderDetails(this.model.activeProvider.id);var g=t.templates.todolistactive(i);i.statusMessage&&this.$el.closest(".app-container").addClass("has-message"),u&&(a=u.supportsFeature("assigned"),r=u.supportsFeature("subtask"),l=u.supportsFeature("showComplete"),c=u.supportsFeature("showArchivedProject"),h=u.supportsFeature("archiveCompleted")),this.$activeContainer.html(g),this.$chooserContainer=this.$activeContainer.find(".list-chooser");var f=[];if(d&&d.attributes.provider_url&&f.push({commandId:"todo.visit.external",captionText:"View in "+d.get("provider_title"),options:{urlField:u&&u.get("url")?"url":null,providerUrl:this.providerUrl},todoIcon:'<span class="dropdown-list-icon-wrapper"><svg class="dropdown-list-icon icon icon-external" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 438.536 438.536"><path d="M414.41 24.123C398.333 8.042 378.963 0 356.315 0H82.228C59.58 0 40.21 8.042 24.126 24.123 8.045 40.207.003 59.576.003 82.225v274.084c0 22.647 8.042 42.018 24.123 58.102 16.084 16.084 35.454 24.126 58.102 24.126h274.084c22.648 0 42.018-8.042 58.095-24.126 16.084-16.084 24.126-35.454 24.126-58.102V82.225c-.001-22.649-8.043-42.021-24.123-58.102zm-48.961 204.279c0 7.994-3.717 13.606-11.136 16.844-2.471.951-4.859 1.427-7.139 1.427-5.134 0-9.418-1.811-12.847-5.424l-41.11-41.112-152.453 152.462c-3.621 3.614-7.9 5.425-12.85 5.425-4.952 0-9.235-1.811-12.851-5.425l-29.121-29.126c-3.617-3.61-5.426-7.901-5.426-12.847 0-4.944 1.809-9.229 5.426-12.843l152.462-152.464-41.113-41.112c-5.902-5.52-7.233-12.178-3.999-19.985 3.234-7.421 8.852-11.136 16.846-11.136h137.037c4.948 0 9.232 1.81 12.854 5.428 3.613 3.614 5.421 7.898 5.421 12.847v137.041z"/></svg></span>',toolTip:"Open in "+d.get("provider_title")}),d&&this.model.activeProvider.get("supportSubtasks")&&f.push({checkStateCmd:"todo.list.check.state.subtasks",commandId:"todo.list.toggle.subtasks",captionText:"Show subtasks"}),f.push({checkStateCmd:"todo.list.check.state.autofocus",commandId:"todo.toggle.autofocus",options:{sourceApp:"Todo",eventSource:"todo"},captionTextOn:"Turn on Top task in center",captionTextOff:"Turn off Top task in center",todoIcon:'<span class="dropdown-list-icon-wrapper"><svg class="dropdown-list-icon icon icon-autofocus" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 124.512 124.512" class="icon icon-autofocus"><path d="M113.956 57.006l-97.4-56.2c-4-2.3-9 .6-9 5.2v112.5c0 4.6 5 7.5 9 5.2l97.4-56.2c4-2.401 4-8.2 0-10.5z"/></svg></span>',toolTip:"Automatically set top task as focus",plusFeature:!0,dataTest:"dropdown-autofocus"}),a&&f.push({checkStateCmd:"todo.list.check.state.assigned",commandId:"todo.toggle.assignee",captionText:"Assigned to me",todoIcon:'<span class="dropdown-list-icon-wrapper"><svg class="dropdown-list-icon icon icon-assigned" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 60"><path d="M9.56 48.67v2.91c0 4.18 13.21 5.35 20.46 5.4s20.46-1.21 20.46-5.4v-2.91a8.11 8.11 0 0 0-4.23-7.12l-7.81-4.26-.21-.12A2.38 2.38 0 0 1 37 35.08v-3l.26-.36a18.89 18.89 0 0 0 2.89-6.15 3.58 3.58 0 0 0 1.35-2.8V19.2a3.59 3.59 0 0 0-.9-2.36v-4.78a8.06 8.06 0 0 0-1.88-5.87C36.93 4.16 33.85 3.1 30 3c-3.83.08-6.91 1.14-8.69 3.17a8.07 8.07 0 0 0-1.88 5.87v4.78a3.59 3.59 0 0 0-.9 2.36v3.6a3.58 3.58 0 0 0 1.35 2.8 18.89 18.89 0 0 0 2.89 6.15l.26.36v3a2.38 2.38 0 0 1-1.24 2.09l-.21.12-7.81 4.26a8.11 8.11 0 0 0-4.21 7.11z"/></svg></span>',toolTip:"Show assigned to me only"}),(r||l||c||h)&&f.push({css_class:"line"}),r&&f.push({checkStateCmd:"todo.list.check.state.subtasks",commandId:"todo.list.toggle.subtasks",captionText:"Show subtasks",todoIcon:'<span class="dropdown-list-icon-wrapper"><svg class="dropdown-list-icon icon icon-subtasks" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 500 500"><path d="M36 387c-19 0-36 16-36 35s17 36 36 36 35-17 35-36-16-35-35-35zM36 215c-19 0-36 16-36 35s17 35 36 35 35-16 35-35-16-35-35-35zM164 110h303c18 0 33-14 33-32s-15-33-33-33H164c-18 0-33 15-33 33s15 32 33 32zM36 42C17 42 0 59 0 78s17 35 36 35 35-16 35-35-16-36-35-36zM467 217H164c-18 0-33 15-33 33s15 33 33 33h303c18 0 33-15 33-33s-15-33-33-33zM467 389H164c-18 0-33 15-33 33s15 33 33 33h303c18 0 33-15 33-33s-15-33-33-33z"/></svg></span>'}),l&&f.push({checkStateCmd:"todo.list.check.state.old.todos",commandId:"todo.list.show.old.todos",captionText:u.get("complete_support_override_text")||"Show all completed tasks",todoIcon:'<span class="dropdown-list-icon-wrapper"><svg class="dropdown-list-icon icon icon-check" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 497.5 497.5"><path d="M487.75 78.125c-13-13-33-13-46 0l-272 272-114-113c-13-13-33-13-46 0s-13 33 0 46l137 136c6 6 15 10 23 10s17-4 23-10l295-294c13-13 13-34 0-47z"/></svg></span>'}),c&&f.push({checkStateCmd:"todo.check.state.archived.projects",commandId:"todo.show.archived.projects",captionText:"Show archived projects",todoIcon:'<span class="dropdown-list-icon-wrapper"><svg class="dropdown-list-icon icon icon-archive" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 536.461 536.46"><path d="M144.752 263.52c19.603-9.038 38.354-13.559 56.243-13.559h237.548v-45.683c0-17.511-6.283-32.555-18.85-45.118-12.565-12.562-27.596-18.842-45.11-18.842H219.266v-9.136c0-17.511-6.28-32.548-18.842-45.107-12.563-12.562-27.6-18.846-45.111-18.846h-91.36c-17.511 0-32.548 6.283-45.111 18.846C6.279 98.635 0 113.672 0 131.183v274.084c0 .764.049 1.955.144 3.576.094 1.615.144 2.807.144 3.566l1.426-1.704L97.93 297.637c11.61-13.706 27.218-25.081 46.822-34.117z"/><path d="M528.898 290.214c-5.041-2.478-10.797-3.72-17.272-3.72H200.995c-12.562 0-26.219 3.381-40.968 10.14-14.75 6.766-26.219 14.986-34.401 24.701l-95.93 113.059c-5.902 6.662-8.853 12.945-8.853 18.849 0 5.708 2.523 9.802 7.566 12.272 5.043 2.478 10.8 3.716 17.273 3.716h310.64c12.56 0 26.21-3.381 40.963-10.136 14.75-6.756 26.214-14.989 34.399-24.701l95.931-113.059c5.899-6.663 8.846-12.939 8.846-18.849.004-5.707-2.515-9.797-7.563-12.272z"/></svg></span>'}),f.push({css_class:"line"}),f.push({commandId:"todo.move.today.batch",captionText:"Send tasks to Today",todoIcon:'<span class="dropdown-list-icon-wrapper"><svg class="dropdown-list-icon icon icon-move-to-today" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 25 25"><g fill="none" fill-rule="evenodd"><path id="icon-path-one" d="M8 10.773V7.5a.5.5 0 0 1 .5-.5H22a.5.5 0 0 1 .5.5c.006 4.712.006 7.739 0 9.08 0 .08-8.694-.078-8.694 0 .229.523.337 1.409.125 1.92H23.5a1 1 0 0 0 1-1V3a1 1 0 0 0-1-1H21a.25.25 0 0 1-.25-.25v-1a.75.75 0 0 0-1.5 0V4.5a.75.75 0 0 1-1.5 0v-2a.5.5 0 0 0-.5-.5H13a.25.25 0 0 1-.25-.25v-1a.75.75 0 0 0-1.5 0V4.5a.75.75 0 0 1-1.5 0v-2a.5.5 0 0 0-.5-.5H7a1 1 0 0 0-1 1v7.773c.665-.183 1.372-.152 2 0zm-1.5.727A6.5 6.5 0 1 0 13 18a6.508 6.508 0 0 0-6.5-6.5zm.161 9.3v-1.4c0-.193-.14-.35-.31-.35H2.931C2.418 19.05 2 18.58 2 18c0-.579.418-1.05.932-1.05H6.35c.172 0 .311-.156.311-.35v-1.399c-.001-.386.277-.7.62-.701.142 0 .28.055.39.154l3.108 2.8a.792.792 0 0 1 0 1.094l-3.107 2.799a.566.566 0 0 1-.66.083.712.712 0 0 1-.35-.63z" fill-rule="nonzero"/><path id="icon-path-two" d="M13 11l1.98 1.98M15 13l3.07-3.947" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></g></svg></span>',toolTip:"Move all tasks from this list to Today"}),f.push({commandId:"todo.move.back.batch",captionText:"Clear the day",todoIcon:'<span class="dropdown-list-icon-wrapper"><svg class="dropdown-list-icon icon icon-clear" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 39 39"><g transform="translate(-1)" fill="none" fill-rule="evenodd"><rect stroke-width="3" transform="rotate(45 17.5 23)" x="14.5" y="5.5" width="6" height="35" rx="2"/><path d="M7 34l14.5-14.5" stroke-width="3.8" stroke-linecap="square"/><path d="M31.5.7V6m2.386-1.188l-4.772-2.625m0 2.625l4.772-2.625M37.2 15.2v5.3m2.348-1.383l-4.773-2.625m0 2.625l4.773-2.625" stroke-linecap="round" stroke-linejoin="round"/><path d="M19.5 4.42V7.6m1.432-.713l-2.864-1.575m0 1.575l2.864-1.575" stroke-width=".8" stroke-linecap="round" stroke-linejoin="round"/></g></svg></span>',toolTip:"Send tasks to Inbox/original lists"}),h&&f.push({commandId:"todo.list.archive",captionText:"Clear completed tasks",todoIcon:'<span class="dropdown-list-icon-wrapper"><svg class="dropdown-list-icon icon icon-clear" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 39 39"><g transform="translate(-1)" fill="none" fill-rule="evenodd"><rect stroke-width="3" transform="rotate(45 17.5 23)" x="14.5" y="5.5" width="6" height="35" rx="2"/><path d="M7 34l14.5-14.5" stroke-width="3.8" stroke-linecap="square"/><path d="M31.5.7V6M33.886 4.812l-4.772-2.625M29.114 4.812l4.772-2.625M37.2 15.2v5.3M39.548 19.117l-4.773-2.625M34.775 19.117l4.773-2.625" stroke-linecap="round" stroke-linejoin="round"/><path d="M19.5 4.42V7.6M20.932 6.887l-2.864-1.575M18.068 6.887l2.864-1.575" stroke-width=".8" stroke-linecap="round" stroke-linejoin="round"/></g></svg></span>'}),f.push({css_class:"line"}),m.conditionalFeatures.featureEnabled("plus")&&f.push({commandId:"todo.switch.feed",captionText:"Switch to...",css_class:"no-icon"}),m.conditionalFeatures.featureEnabled("plus")||f.push({commandId:"todo.show.integrationUpsell",captionText:"Add integration",plusFeature:!0,toolTip:"Connect to a third party task list",dataTest:"dropdown-add-integration"}),f.push({commandId:"todo.show.settings",captionText:"Settings",css_class:"no-icon"}),f=new Backbone.Collection(f),u){var v=$(this.$el.find("#todo-top-menu")[0]);this.topMenuDropdownView&&this.lastProvider==this.model.activeProvider?this.topMenuDropdownView.attachMenuItems(v,f):(this.topMenuDropdownView&&(this.topMenuDropdownView.unbind(),this.topMenuDropdownView.remove()),this.topMenuDropdownView=new t.views.TodoDropdownMenu({el:v,iClassName:"icon-cog",dropdownClassName:"todo-actions-dropdown",menuItems:f,model:u,parentContext:this.model.activeProvider})),this.topMenuDropdownView.render();var C=this.$el.find(".project-chooser");this.projectDropdownView?(this.projectDropdownView.dropdownClassName="project-chooser-dropdown",this.projectDropdownView.providerLogo=d?d.get("small_icon_url"):null,this.projectDropdownView.attachMenuItems(C,this.projectMenuCollection)):(this.projectDropdownView=new t.views.TodoDropdownMenu({el:C,loadAllOnExpand:!0,menuItems:this.projectMenuCollection,dropdownClassName:"project-chooser-dropdown",model:u,parentContext:this.project,providerLogo:d?d.get("small_icon_url"):null,keepOpen:!0}),this.listenTo(this.projectDropdownView,"refreshItems",this.refreshProjects)),this.projectDropdownView.render(),this.lastProvider=this.model.activeProvider,a=u.supportsFeature("assigned"),this.$activeContainer.find(".control-assignee").toggleClass("disabled",!a),this.$activeContainer.find(".control-autofocus").removeClass("disabled"),this.$activeContainer.toggleClass("has-assignee",a),this.$activeContainer.find(".control-assignee").toggleClass("active",1==m.models.customization.get("assigned-"+u.get(u.idAttribute)))}}this.$activeContainer&&this.$activeContainer.find(".control-autofocus").toggleClass("active",m.models.customization.getComputedSetting("autoFocus"));var y=!u||this.model.activeProvider.selectedProject().listCollection.length<=1&&!this.model.activeProvider.isMomentum();this.$activeContainer.find(".list-chooser-toggle").mToggle("inline-flex",!y),this.$activeContainer.toggleClass("momentum-todo",this.model.activeProvider.isMomentum())}this.model.activeProvider.selectedProject()&&this.renderListChooser(this.model.activeProvider.selectedProject().listCollection,this.$chooserContainer,"todo-list-choice")}else setTimeout((function(){o.renderActiveItem(e)}),300)},compareObjects:function(t,e){return t==e||JSON.stringify(t)==JSON.stringify(e)},prepareProjectList:function(){if(!(this.preparing||this.lastPreparedProjects&&this.lastPreparedProjects==this.model.activeProvider.projectCollection&&this.lastPreparedProjects.models[0]==this.model.activeProvider.projectCollection)){var t=this;this.preparing=!0;var e=this.projectItems=[];this.projectMenuCollection||(this.projectMenuCollection=new Backbone.Collection(e));var o=this.lastPreparedProjects=this.model.activeProvider.projectCollection,i=this.model.activeProvider.getAllProjects();if(o&&i){var s=o.sortBy("last_active").reverse();s=_.chain(s).first(10).value().filter((function(t){return i.get(t.get("id"))}));var n=i.toArray().filter((function(t){return!o.get(t.get("id"))}));if(this.model.activeProvider.id.length>1){var d=this.model.activeProvider.get("variant_title")||this.model.activeProvider.get("provider_title");e.push({captionText:d,css_class:"provider-name no-icon"})}var a=this.model.activeProvider.selectedProject();if(a)var r=a.selectedList();e.push({captionText:"Recent",css_class:"section-title no-icon"}),_.map(s,(function(o){e.push({commandId:"todo.switch.parent.project",captionText:o.get("title"),color:o.get("color"),options:{projectId:o.get("id")},css_class:t.model.activeProvider.get("supportProjects")&&a&&a.id==o.get("id")||r&&o.get("id")==r.id?"active-item no-icon":"no-icon",projectId:o.get("id")})})),i.length>5&&e.push({captionText:"Other",css_class:"section-title empty-list no-icon"}),_.map(n,(function(t){var o;for(o in e)if(e[o].projectId==t.get("id"))return;e.push({commandId:"todo.switch.parent.project",captionText:t.get("title"),color:t.get("color"),options:{projectId:t.get("id")},css_class:"no-icon",projectId:t.get("id")})})),this.projectMenuCollection.set(e,{silent:!0}),this.projectMenuCollection.trigger("reset"),this.preparing=!1}else this.preparing=!1}},resetProjectList:function(){var t=this;setTimeout((function(){t.projectDropdownView.resetMenuItems()}),250)},renderListChooser:function(e,o,i){if(e){var s=e.where({deleted:!1});o.html("");var n=null;try{s=s.sort((function(t,e){return t.get("order")-e.get("order")}))}catch(r){console.error(r)}var d=this;_.map(s,(function(s){var a={};a.listId=s.get(s.idAttribute),a.title=s.get("title"),a.color=s.getColor(),a.count=s.get("count"),a.iconUrl=s.get("small_icon_url"),Number.isInteger(a.count)||(a.count=" "),a.class=i;var r=s.get("parentTitle");r&&(a.hasParent=!0,r!=n&&(a.parentTitle=r),a.folderName=r,n=r),s.id==e.selectedList().id&&(a.class="todo-list-choice-active");var l=d.model.activeProvider.get("supports_folders")?t.templates.todofolderlistchoice(a):t.templates.todolistchoice(a),c=$(l);o.append(c),c.data("list-id",s.get(s.idAttribute)),c.data("test",s.get("title")&&s.get("title").toLowerCase())}));var a=t.models.todoListManager.todoProviderDetails(this.model.activeProvider.get("id"));a&&a.get("add_lists")&&(this.addTodoListView||(this.addTodoListView=new t.views.AddTodoList({model:this.model}),this.listenTo(m,"todo:listAdded",this.stopChoosing)),o.append(this.addTodoListView.render().el),this.addTodoListView.delegateEvents())}},handleManagerChange:function(){if(this.topMenuDropdownView){var t=this.model.activeProvider.selectedList();this.topMenuDropdownView.updateModel(t)}this.render()},handleTodoLoadingStateChange:function(t){JSON.stringify(t)!==JSON.stringify(this.lastStatus)&&this.model.activeProvider&&this.render(t),this.lastStatus=t},providerChanged:function(){this.render()},refreshProjects:function(){this.model.activeProvider.refreshAllProjects()},hideTodo:function(){m.trigger("todo:hidden")},toggleFolder:function(t){t&&(t.preventDefault(),t.stopImmediatePropagation());var e=t.delegatedTarget.dataset.folderId;this.$el.find('[data-folder-id="'+e+'"]').toggleClass("active"),m.trigger("todolist:updateHeight",this.$chooserContainer.height()+5)}})},"./views/todopane.js":e=>{e.views.TodoPane=Backbone.View.extend({attributes:{id:"todo",class:"todo"},template:e.templates.todopane,renderedOnce:!1,todoListOpen:!1,events:{"dragover .drop-left-zone":"ignoreDragOver","dragover .drop-right-zone":"ignoreDragOver","dragenter .drop-left-zone":"hoverLeftBar","dragenter .drop-right-zone":"hoverRightBar","dragleave .drop-left-zone":"hoverLeftBar","dragleave .drop-right-zone":"hoverRightBar","dragend .drop-right-zone":"dragend","dragend .drop-left-zone":"dragend","drop .drop-right-zone":"drop","drop .drop-left-zone":"drop"},libraryLoadStarted:!1,initialize:function(){this.subViews=[],this.listenTo(m,"globalEvent:key:shiftN",this.focusOnNewTodo),this.listenTo(m,"globalEvent:arrowLeft",this.arrowLeft),this.listenTo(m,"globalEvent:arrowRight",this.arrowRight),this.listenTo(m,"globalEvent:altArrowUp",this.altUp),this.listenTo(m,"globalEvent:altArrowDown",this.altDown),this.listenTo(m,"todo:hide-input",this.hideInput),this.listenTo(m,"todo:show-input",this.showInput),this.listenTo(m,"todo:show-and-focus-input",this.showAndFocusInput),this.listenTo(m,"todo:dragging",this.todoDragging),this.listenTo(m,"todo:newProvider",this.openTodo),this.listenTo(m,"todo:providerChanged",this.providerChanged),this.render()},render:function(){this.renderedOnce||(this.$el.html(this.template()),this.$app=this.$el,this.$listcontainer=this.$el.find(".todo-list")[0],this.$headercontainer=this.$el.find(".todo-header")[0],this.$newTodoFooter=this.$el.find(".new-todo-footer"),this.$newtodoinput=this.$el.find("#todo-new"),this.renderedOnce=!0);var t=this;return setTimeout((function(){t.$el.find(".todo-item").first().find(".dropdown").css("display","block")}),1e3),e.models.todoListManager||this.doFirstFetch(),this},openTodo:function(){t().togglePopup(!0)},hideInput:function(){this.$newTodoFooter.css({visibility:"hidden"})},showInput:function(){this.$newTodoFooter.css({visibility:"visible"})},showAndFocusInput:function(){this.showInput(),this.$newtodoinput.trigger("focus")},doFirstFetch:function(){this.initializeManager(),e.models.todoListManager.externallyFetchedOnce=!0},todoDragging:function(t){if(this.draggingTodo=t,this.hoverCounter=0,!t.model.get("noMove")&&!t.model.get("no_list_move")){var o=e.models.todoListManager.activeProvider.selectedProject().getNeighboringList(-1);o&&o.get("boardId")&&o.get("boardId")==t.selectedList.get("boardId")&&(this.$app.addClass("has-drop-left"),this.$el.find(".left-bar .bar-name").html(o.get("title")));var i=e.models.todoListManager.activeProvider.selectedProject().getNeighboringList(1);i&&i.get("boardId")&&i.get("boardId")==t.selectedList.get("boardId")&&(this.$app.addClass("has-drop-right"),this.$el.find(".right-bar .bar-name").html(i.get("title")))}},getTopTodo:function(){var t=this.manager;if(t&&t.activeProvider&&t.activeProvider.selectedList){var e=t.activeProvider.selectedList();if(e&&e.itemCollection&&(e.itemCollection.length>0||!e.itemCollection.loadingFromServer)){var o=null;if(this.todoList&&this.todoList.reordered){var i=this.todoList.getTopActiveTodoId();if(i){var s={};s[e.itemCollection.idAttribute]=i,o=e.itemCollection.findWhere(s)}}else{var n=_(e.itemCollection.activeToday()).chain().filter((function(t){var e=!1;if(t.get("viewSection")){var o="collapsed-"+t.get("csListId")+":"+t.get("viewSection");e=m.models.customization.get(o)}return!t.get("done")&&"subsection"!=t.get("viewType")&&!e})).value();n&&n.length>0&&(o=(n=_.sortBy(n,(function(t){return t.getOrder()})))[0])}return o}e&&e.itemCollection&&e.itemCollection.doFetchIfNeeded()}},initializeManager:function(){if(!e.models.todoListManager){var t=this;this.manager=e.models.todoListManager=new e.models.TodoListManager({offline:this.options.offline,prefetchTodos:this.todoListOpen||m.models.customization.getComputedSetting("autoFocus")}),this.manager.setup().then((function(){m.trigger("todo:managerReady"),t.todoHeader=new e.views.TodoListHeader({el:t.$headercontainer,model:e.models.todoListManager,parent:t}),t.todoList=new e.views.TodoList({el:t.$listcontainer,model:e.models.todoListManager}),t.newTodoInput=new e.views.NewTodoInput({todoList:t.todoList,el:t.$newtodoinput[0],model:e.models.todoListManager}),t.manager.activeProvider?t.manager.activeProvider.doFetchIfNeeded():t.manager.changeProvider("1")}))}},arrowLeft:function(t){this.todoListOpen&&(m.trigger("globalEvent:closeDropdowns"),t.shiftKey?e.models.todoListManager.selectPreviousProvider():e.models.todoListManager.activeProvider&&e.models.todoListManager.activeProvider.selectedProject().selectPreviousList())},arrowRight:function(t){this.todoListOpen&&(m.trigger("globalEvent:closeDropdowns"),t.shiftKey?e.models.todoListManager.selectNextProvider():e.models.todoListManager.activeProvider&&e.models.todoListManager.activeProvider.selectedProject().selectNextList())},altUp:function(){this.todoListOpen&&(m.trigger("globalEvent:closeDropdowns"),e.models.todoListManager.activeProvider.selectPreviousProject())},altDown:function(){this.todoListOpen&&(m.trigger("globalEvent:closeDropdowns"),e.models.todoListManager.activeProvider.selectNextProject())},focusOnNewTodo:function(t){this.todoListOpen&&(t&&(t.preventDefault(),t.stopPropagation()),this.newTodoInput.focusInputField())},getHoverInfo:function(t){var e=this,o="dragenter"==t.type;o&&t.preventDefault(),this.hoverCounter+=o?1:-1;var i=this.hoverCounter>0;return i?this.$el.find(".todo-list .placeholder").hide():setTimeout((function(){e.dropListOffset=null}),400),i},hoverRightBar:function(t){t.preventDefault();var e=this.getHoverInfo(t);return this.$el.find(".drop-right-zone").toggleClass("hover",e),e&&(this.dropListOffset=1),!1},hoverLeftBar:function(t){t.preventDefault();var e=this.getHoverInfo(t);return this.$el.find(".drop-left-zone").toggleClass("hover",e),e&&(this.dropListOffset=-1),!1},dragend:function(t){this.hoverCounter=0,t.preventDefault(),this.$el.find(".todo-list").removeClass("dragging"),this.$el.find(".todo-list .placeholder").hide(),this.$el.find(".drop-left-zone").removeClass("hover"),this.$el.find(".drop-right-zone").removeClass("hover"),this.$app.removeClass("has-drop-left has-drop-right"),this.dropListOffset=null,this.draggingTodo=null},drop:function(t){if(this.$el.find(".todo-list .placeholder").hide(),this.dropListOffset){var o=e.models.todoListManager.activeProvider.selectedProject().getNeighboringList(this.dropListOffset);(new m.commands.TodoMove).execute(this.draggingTodo.model,{target_id:o.id}),this.dragend(t)}else this.dragend(t)},ignoreDragOver:function(t){return t.preventDefault(),t.stopPropagation(),t.originalEvent.dataTransfer.dropEffect="move",!1}})}}),c=Object.assign({"./templates/addtodolist.hbs":o,"./templates/dropdownmenu.hbs":i,"./templates/todo-list-empty-state.hbs":s,"./templates/todofolderlistchoice.hbs":n,"./templates/todoitem.hbs":d,"./templates/todolistactive.hbs":a,"./templates/todolistchoice.hbs":r,"./templates/todopane.hbs":{compiler:[8,">= 4.3.0"],main:function(t,e,o,i,s){return'\t\t<div class="drop-zone drop-left-zone">\n\t\t\t<span class="bar left-bar">\n\t\t\t\t<span class="bar-name"></span>\n\t\t\t</span>\n\t\t</div>\n\n\t\t<div class="drop-zone drop-right-zone">\n\t\t\t<span class="bar right-bar">\n\t\t\t\t<span class="bar-name"></span>\n\t\t\t</span>\n\t\t</div>\n\n\t\t<header class="header todo-header" data-test="todo-header">\n\t\t\t<div class="active-list">\n\t\t\t\t\x3c!-- Seems like this is all getting replaced with todolistactive.hbs? --\x3e\n\t\t\t\t\x3c!-- <li><span class="todo-list-name"></span><span class="todo-count active-todo-count"></span></li> --\x3e\n\t\t\t</div>\n\t\t</header>\n\n\t\t<div class="todo-list-wrapper">\n\t\t\t<ol class="todo-list animating"></ol>\n\t\t</div>\n\n\t\t<footer class="footer-input new-todo-footer">\n\t\t\t<input id="todo-new" class="todo-input todo-new" type="text" placeholder="New Task" data-test="todo-new-input" autocomplete="off">\n\t\t</footer>\n'},useData:!0}});let h=null;const u=async()=>{if(h)return await h;h=new Promise((t=>e({},l,c,(e=>{e.styles.style(),m.conditionalFeatures.checkFeatureAndMigrateData("servertodos",null,"momentum-todo",(function(){const o=new e.views.TodoPane;m.views.todoPane=o,e.views.todoPane=o,t()}),(function(){!function(){var t=localStorage.getItem("momentum-todo");if(!t)return;localStorage.setItem("todo-1-inbox",t);for(var e=Object.keys(localStorage),o=0;o<e.length;o++){var i=e[o];if(0===i.indexOf("momentum-todo")&&i.length>20){var s=JSON.parse(localStorage.getItem(i));s.csid||(s.csid=s.id,delete s.id),localStorage.setItem("todo-1-inbox-"+s.csid,JSON.stringify(s)),localStorage.removeItem(i)}}localStorage.removeItem("momentum-todo")}();const o=new e.views.TodoPane({offline:!0});m.views.todoPane=o,e.views.todoPane=o,t()}))})))),await h};export{u as loadTodoAddin};