const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/icon-alert--q0yLTMi.js","assets/js/localStorage-4iHdj-SC.js","assets/js/preload-helper-DmNsytk6.js","assets/js/string-GDe0WbEj.js"])))=>i.map(i=>d[i]);
import{o as t,n as e,a8 as s,aB as i,z as o,aC as a,e as r,p as n,j as c,a1 as l,c as m,K as p,A as d,av as u,V as h,aD as v,R as b,aE as f}from"./icon-alert--q0yLTMi.js";import{I as g}from"./index-CJJH83pl.js";import{A as w,g as k,I as j,a as C,s as _,D as y,S}from"./siteBlocker-CONYstGU.js";import"./localStorage-4iHdj-SC.js";import{_ as x}from"./preload-helper-DmNsytk6.js";import{u as I}from"./internalDataMetrics-DdXJLkC7.js";import{g as R}from"./string-GDe0WbEj.js";import{u as H,S as M}from"./streaks-D7oYwre-.js";import{c as B,a as P,S as T}from"./constants-BT5o8PmI.js";import{P as D}from"./Popup-ByBvHAFZ.js";import{F as L}from"./FlashMessage-DPJrdJ6u.js";import{a as F,D as z}from"./constants-CALDQiUE.js";import"./BaseIcon-B5UifJH3.js";import"./arrow-Be8MuPJi.js";import"./icon-weather-reset-C06kxk3l.js";import"./icon-settings-Bycjf8-G.js";import"./icon-back-arrow-CiRQJ6G-.js";import"./icon-back-D_TFrgyJ.js";import"./icon-trash-BQ1O-AfY.js";import"./icon-close-BUGl_M7j.js";import"./icon-cog-BFr_Pva7.js";import"./icon-skip-BOkC5L0N.js";import"./icon-down-BiHbKN-t.js";import"./icon-edit-CixeXNYx.js";import"./icon-ellipsis-D3jS4u3x.js";import"./icon-error-state-BKQhfBCj.js";import"./icon-heart-v5O7C6eS.js";import"./icon-hide-NFfBhfBx.js";import"./icon-key-BPNRipb3.js";import"./icon-next-B4hjdiAA.js";import"./icon-photo-BrwqV1T0.js";import"./icon-pin-BHeOuzvO.js";import"./icon-plus-D4YOesIc.js";import"./icon-profile-B_XWyuTb.js";import"./icon-x-qUCmf2CW.js";import"./icon-skip-intro-BUi8b3Ak.js";import"./icon-tooltip-CN09iXOB.js";import"./icon-visible-on-CM3kpcFN.js";import"./icon-x-caret-half-CZtcH_PM.js";import"./tasks-completed-Dg2z75km.js";import"./add-COIuonao.js";import"./google-DKPAcOmk.js";import"./arrow-up-1QPpu78M.js";import"./square-check-DwLT60gj.js";import"./clocks-DjzskNOU.js";import"./close-Bj_A2br_.js";import"./search-DCqlmJx6.js";import"./folder-CwWTWsnJ.js";import"./switch-EuBTQVVE.js";import"./focus-mode-09pIyYAW.js";import"./storage-YYEO5TB5.js";import"./icon-confetti-Dz2LojDe.js";import"./ocean-bubbles-GcKjBI5B.js";import"./sparks-CAw9b6ob.js";import"./secure-B8YP-AML.js";import"./icon-asana-Csd73e1k.js";import"./icon-percent-schedule-CA5EI9b7.js";import"./icon-trello-DhCq-Fsi.js";import"./icon-clean-rFsPxTtp.js";import"./icon-more-lists-Cl9oRGK2.js";import"./icon-more-fonts-CcfOY0t4.js";import"./icon-focus-stats-keERwXFt.js";import"./icon-top-of-mind-B6EhbCcK.js";import"./icon-flow-5QqmGIWX.js";import"./icon-integrations-D9o58ob4.js";import"./icon-weather-extra-ufLpT_SX.js";import"./icon-spiral-gh4hwZDD.js";import"./icon-happy-place-D1z6CJgM.js";import"./icon-time-sensitive-CP2L3maw.js";import"./icon-hourly-CdMmiQZT.js";import"./icon-infinity-D4yMRoAd.js";import"./icon-personalize-photos-D2M4lLlt.js";import"./icon-skip-2bGCAGKt.js";import"./icon-photo-match-C2EChNEK.js";import"./icon-random-375DbcwF.js";import"./icon-timezones-DGZoTtaT.js";import"./icon-simplify-BRUtLJYp.js";import"./icon-sync-DIH26Y9h.js";import"./BaseDropdownContent-BSCj37As.js";import"./index-D7SyL4qE.js";import"./globalKeyEventManager-Bi-yHy9P.js";const E=e(t({name:"SiteBlockerInterventionResistanceStreak",setup:()=>({internalDataMetrics:I()}),computed:{sitesResistedStreakMetric(){return this.internalDataMetrics.getMetric("streaksStats","getSitesResistedStreak")},sitesResistedStreak(){var t,e;return this.sitesResistedStreakMetric.value.storeLoaded?(null==(e=(t=this.sitesResistedStreakMetric.value).getterValue)?void 0:e.call(t))||0:"-"}}}),(function(){var t=this,e=t._self._c;return t._self._setupProxy,e("div",{staticClass:"site-blocker-intervention-resistance-streak metric-type app-dash"},[e("div",{staticClass:"metric-stat"},[e("span",{attrs:{"data-test":"resistance-streak"}},[t._v(t._s(t.sitesResistedStreak))])]),t._m(0)])}),[function(){var t=this,e=t._self._c;return t._self._setupProxy,e("div",{staticClass:"metric-label"},[e("span",{staticClass:"metric-label-name"},[t._v("Resistance streak")])])}],!1,null,"035e5669").exports;const V=e(t({name:"SiteBlockerInterventionAffirmation",setup:()=>({affirmation:R(w)})}),(function(){var t=this,e=t._self._c;return t._self._setupProxy,e("div",{staticClass:"site-blocker-intervention-affirmation"},[t._v(" "+t._s(t.affirmation)+" ")])}),[],!1,null,"91e3e7ce").exports;const A=e(t({name:"SiteBlockerInterventionBypassBreath",emits:["complete"],data:()=>({text:"inhale",shrinking:!0}),async mounted(){await s(700),this.shrinking=!1,await s(3750),this.text="",await s(800),this.text="exhale",await s(600),this.shrinking=!0,await s(3750),this.text="",await s(1500),this.$emit("complete")}}),(function(){var t=this,e=t._self._c;return t._self._setupProxy,e("div",{staticClass:"site-blocker-intervention-bypass-breath"},[e("div",{staticClass:"breath-title"},[t._v("Take a deep breath")]),e("div",{staticClass:"breath-content",class:{shrinking:t.shrinking}},[e("div",{staticClass:"circle"}),e("div",{staticClass:"circle"}),e("div",{staticClass:"circle"}),e("transition",{attrs:{name:"fade",mode:"out-in",duration:500}},[e("div",{key:t.text,staticClass:"text"},[t._v(t._s(t.text))])])],1)])}),[],!1,null,"d9b67639").exports,W=new d({feature:"site blocker"}),G=t({name:"SiteBlockerInterventionDashboard",components:{SiteBlockerInterventionResistanceStreak:E,SiteBlockerInterventionAffirmation:V,SiteBlockerInterventionBypassBreath:A,Popup:D,FlashMessage:L},setup(){const t=new URL(location.href).searchParams,e=i(!1);return{center:o(),topLeft:o(),searchParams:t,siteName:k(decodeURIComponent(t.get("sitename")||""),decodeURIComponent(t.get("metatitle")||""),decodeURIComponent(t.get("documenttitle")||""),decodeURIComponent(t.get("hostname")||"")),streaksStore:H(),lastFocus:localStorage.getItem(B),shouldShowFlashMessage:"true"===t.get("bypassDelayOver"),tabWasMuted:!1,tabId:null,isChromium:a(),metaKeyOrSymbol:"Cmd"===e?"⌘":e,DropdownPosition:F,DropdownAlignment:z}},data:()=>({topRowHeight:0,centerAboveHeight:0,bypassing:!1,dashboardVisible:!0,streakTipVisible:"true"!==localStorage.getItem(j)}),computed:{topRowHeightPx(){return this.topRowHeight+"px"},centerAboveHeightPx(){return this.centerAboveHeight+"px"}},async mounted(){var t;if(this.shouldShowFlashMessage){const t=(await x((async()=>{const{default:t}=await import("./icon-alert--q0yLTMi.js").then((t=>t.aQ));return{default:t}}),__vite__mapDeps([0,1,2,3]))).default;await this.$nextTick(),t.$emit("flashMessage",{message:"It's been 5 minutes. Focus on what matters.",persist:5e3})}if(r.$emit("globalEvent:window:resize"),!this.isChromium)return;const e=await n.tabs.getCurrent();(null==e?void 0:e.id)&&(this.tabId=e.id,(null==(t=null==e?void 0:e.mutedInfo)?void 0:t.muted)?this.tabWasMuted=!0:(await n.tabs.update(this.tabId,{muted:!0}),window.addEventListener("beforeunload",this.unmuteTabBeforeUnload)),this.unregisterTabCloseInServiceWorker(),window.addEventListener("beforeunload",this.registerTabCloseInServiceWorker)),window.addEventListener("storage",(t=>{(t.key===P&&!C()||t.key===T&&"false"===t.newValue)&&(this.dashboardVisible=!1)}))},methods:{calculateGridRowHeights(){var t,e,s;((null==(t=this.center)?void 0:t.offsetHeight)??0)<0||(this.topRowHeight=(null==(e=this.topLeft)?void 0:e.offsetHeight)??0,this.centerAboveHeight=window.innerHeight/2-(((null==(s=this.center)?void 0:s.offsetHeight)??0)/2+this.topRowHeight))},startBypassing(){this.bypassing=!0,W.capture("intervention start tab bypass")},async close(){if(W.capture("intervention close tab",{currently_bypassing:this.bypassing}),!this.isChromium)return;const t=await c().tabs.getCurrent();(null==t?void 0:t.id)&&await c().tabs.remove(t.id)},async dismiss(){this.isChromium&&await this.streaksStore.create({subset:M.SitesResisted,timestamp:Date.now(),valid:!1,data:this.searchParams.get("hostname")||""}),this.dashboardVisible=!1},async openMomentum(t){await this.increaseStreak(),window.removeEventListener("beforeunload",this.registerTabCloseInServiceWorker),W.capture("intervention open momentum",{from:t}),this.isChromium?c().tabs.update({url:"/index.html"}):window.parent.location.href=window.location.origin+"/index.html"},async increaseStreak(){this.isChromium&&await this.streaksStore.create({subset:M.SitesResisted,timestamp:Date.now(),valid:!0})},async afterLeave(){if(this.tabId&&(this.tabWasMuted||(await n.tabs.update(this.tabId,{muted:!1}),window.removeEventListener("beforeunload",this.unmuteTabBeforeUnload))),this.bypassing){W.capture("intervention tab bypassed");const t=C();t&&_(t)}window.removeEventListener("beforeunload",this.registerTabCloseInServiceWorker),window.parent.postMessage(y,"*"),location.reload()},dismissStreakTip(){this.streakTipVisible=!1,localStorage.setItem(j,"true")},unmuteTabBeforeUnload(){this.tabId&&n.tabs.update(this.tabId,{muted:!1})},registerTabCloseInServiceWorker(){if(!this.tabId)return;if(!this.isChromium)return;const t=new l("");m.sendMessage({handler:"increaseStreakWhenTabClosed",args:[this.tabId,this.searchParams.get("hostname")||"",t.getEnv()]})},unregisterTabCloseInServiceWorker(){this.tabId&&this.isChromium&&m.sendMessage({handler:"removeStreakTabClosedListener",args:[this.tabId]})}}}),U=()=>{p(((t,e)=>({"4f1df049":t.topRowHeightPx,dd1f087c:t.centerAboveHeightPx})))},N=G.setup;G.setup=N?(t,e)=>(U(),N(t,e)):U;const O=e(t({name:"SiteBlockerIntervention",components:{SiteBlockerInterventionDashboard:e(G,(function(){var t=this,e=t._self._c;return t._self._setupProxy,e("transition",{attrs:{name:"fade-fast"},on:{"after-leave":t.afterLeave}},[t.dashboardVisible?e("div",{directives:[{name:"resize-sensor",rawName:"v-resize-sensor",value:t.calculateGridRowHeights,expression:"calculateGridRowHeights"}],staticClass:"site-blocker-intervention-dashboard dashboard dark dark-full"},[e("div",{staticClass:"top-row"},[e("div",{directives:[{name:"resize-sensor",rawName:"v-resize-sensor",value:t.calculateGridRowHeights,expression:"calculateGridRowHeights"}],ref:"topLeft",staticClass:"top-left"},[e("div",{staticClass:"dash-button dash-button-neutral open-momentum",on:{click:function(e){return t.openMomentum("button")}}},[t._v("Open Momentum")])]),e("div",{directives:[{name:"resize-sensor",rawName:"v-resize-sensor",value:t.calculateGridRowHeights,expression:"calculateGridRowHeights"}],staticClass:"top-right"},[t.isChromium?e("site-blocker-intervention-resistance-streak"):t._e()],1)]),e("div",{staticClass:"center-above"}),e("div",{directives:[{name:"resize-sensor",rawName:"v-resize-sensor",value:t.calculateGridRowHeights,expression:"calculateGridRowHeights"}],ref:"center",staticClass:"center"},[e("transition",{attrs:{name:"fade",mode:"out-in"}},[t.bypassing?e("site-blocker-intervention-bypass-breath",{staticClass:"center-content",on:{complete:t.dismiss}}):e("div",{staticClass:"center-content"},[e("div",{staticClass:"site-blocked"},[t._v("Site blocked"),t.lastFocus?e("span",[t._v(" • Focusing on")]):t._e()]),e("div",{staticClass:"current-focus",attrs:{"data-test":"current-focus"},on:{click:function(e){return t.openMomentum(t.lastFocus?"focus":"emptyFocus")}}},[t._v(t._s(t.lastFocus||"Focusing"))])])],1)],1),e("div",{staticClass:"center-below"},[e("div",{staticClass:"buttons",class:{"shortcut-help":!t.isChromium}},[t.isChromium?e("div",{staticClass:"dash-button close-tab",on:{click:t.close}},[t._v("Close tab")]):e("div",{staticClass:"dash-button close-tab no-pointer-events",on:{click:t.close}},[t._v("Press "+t._s(t.metaKeyOrSymbol)+" W to close tab")]),e("transition",{attrs:{name:"fade",mode:"out-in"}},[t.bypassing?t.isChromium?e("div",{key:"2",staticClass:"dash-button open-site no-pointer-events"},[t._v("By continuing you will break your resistance streak")]):t._e():e("div",{key:"1",staticClass:"dash-button open-site",on:{click:t.startBypassing}},[t._v("Open "+t._s(t.siteName))])])],1)]),e("div",{staticClass:"bottom-row"},[e("div",{staticClass:"bottom-center"},[e("site-blocker-intervention-affirmation")],1)]),e("transition",{attrs:{name:"fade-blurred-tip-app",appear:""}},[t.streakTipVisible&&t.dashboardVisible&&t.isChromium?e("popup",{attrs:{id:"intervention-streak-tooltip","target-element-selector":".site-blocker-intervention-resistance-streak",position:t.DropdownPosition.Bottom,alignment:t.DropdownAlignment.Right,"body-text":"Your streak resets if you open this website.",width:225,"nipple-displacement":25,"target-distance":5},on:{dismiss:t.dismissStreakTip}}):t._e()],1),t.shouldShowFlashMessage?e("flash-message"):t._e()],1):t._e()])}),[],!1,null,"15bb7c4c").exports}}),(function(){var t=this._self._c;return this._self._setupProxy,t("div",{staticClass:"site-blocker-intervention"},[t("site-blocker-intervention-dashboard")],1)}),[],!1,null,null).exports;window.addEventListener("resize",(()=>{u((()=>{r.$emit("globalEvent:window:resize")}))})),h.use(g),h.use(v),h.directive("resize-sensor",b),new h({render:t=>t(O),pinia:f()}).$mount("#app"),window.parent.postMessage(S,"*");