import t from"./Dropdown-OXqSLuGU.js";import e from"./DropdownOption-Doji5Bwd.js";import{a as i}from"./allComponentsMounted-C3UsG_cA.js";import{T as a}from"./index-DQvfDEB6.js";import{_ as l}from"./icon-plus-D4YOesIc.js";import{_ as o}from"./icon-edit-CixeXNYx.js";import{_ as s}from"./icon-close-BUGl_M7j.js";import{n}from"./icon-alert--q0yLTMi.js";import"./icon-ellipsis-D3jS4u3x.js";import"./localStorage-4iHdj-SC.js";import"./preload-helper-DmNsytk6.js";import"./string-GDe0WbEj.js";import"./migrateLegacyUserMessageHandler-DMvEmYM4.js";import"./main-FH8FpKq2.js";const r=Backbone.Model.extend({defaults:{title:"",createdDate:m.date(),updatedDate:m.now(),label:"",active:!1,serverSetId:!1},initialize:function(){this.idAttribute=this.collection.idAttribute||"csid"}}),d=m.collect.SyncedCollection.extend({initialize:function(t,e){this.model=r,(e=e||{}).name="teamFocus",e.serverIdAttribute="focusUuid",e.model=this.model,e.transientProps=["createdDate"],e.apiUrl=m.globals.urlRootApi+"team/focus",m.collect.SyncedCollection.prototype.initialize.call(this,t,e)}});const c=n({name:"TeamFocus",components:{ThreeColLayout:a,Dropdown:t,DropdownOption:e},mixins:[i],bb:()=>({collection:new d}),data:()=>({dropdownActive:!1,goal:"",label:"",editing:!1,pulse:!1}),computed:{model(){return this.collection.length?this.collection.find((t=>t.active)):null}},watch:{model(){this.model&&(this.goal=this.model.title,this.label=this.model.label)}},created(){this.collection.fetch({reset:!0}),this.model&&(this.goal=this.model.title,this.label=this.model.label)},methods:{removePulse(){this.pulse=!1},toggleDropdown(t=!this.dropdownActive){this.dropdownActive=t},edit(){this.$admin&&(this.editing=!0,this.dropdownActive=!1,this.$nextTick((()=>{this.$refs.goal.focus()})))},onClickOutside(){this.validateGoal(!1)&&this.save(),this.editing=!1},saveAndFinishEditing(){this.validateGoal()&&(this.save(),this.editing=!1)},validateGoal(t=!0){return!!this.goal||(t&&(this.pulse=!0),void this.$refs.goal.focus())},save(t){t&&(t.preventDefault(),t.stopPropagation()),this.model?this.model.save({label:this.label,title:this.goal}):this.collection.create({label:this.label,title:this.goal,active:!0}),this.dropdownActive=!1},clear(){this.dropdownActive=!1,this.goal="",this.label="",this.model.active=!1},revert(){this.model?(this.goal=this.model.title,this.label=this.model.label,this.editing=!1):this.editing=!1}}},(function(){var t=this,e=t._self._c;return e("three-col-layout",{staticClass:"team-focus has-dash-icon team-focus-content",attrs:{"data-test":"team-focus"},scopedSlots:t._u([{key:"center",fn:function(){return[t.editing?e("span",{directives:[{name:"click-outside",rawName:"v-click-outside",value:t.onClickOutside,expression:"onClickOutside"}],staticClass:"edit"},[e("span",{staticClass:"input-wrapper goal-label-input-wrapper"},[e("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.label,expression:"label",modifiers:{trim:!0}}],ref:"label",staticClass:"input goal-label",attrs:{placeholder:"PERIOD","data-test":"label-edit"},domProps:{value:t.label},on:{keyup:[function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.saveAndFinishEditing.apply(null,arguments)},function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"tab",9,e.key,"Tab")||e.ctrlKey||e.shiftKey||e.altKey||e.metaKey?null:t.save.apply(null,arguments)},function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"esc",27,e.key,["Esc","Escape"])?null:t.revert.apply(null,arguments)}],input:function(e){e.target.composing||(t.label=e.target.value.trim())},blur:function(e){return t.$forceUpdate()}}}),e("span",{staticClass:"hidden goal-label"},[t._v(t._s(t.label.replace(/ /g," ")||" "))])]),e("span",{staticClass:"input-wrapper goal-value-input-wrapper"},[e("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.goal,expression:"goal",modifiers:{trim:!0}}],ref:"goal",staticClass:"input goal-value",class:{pulse:t.pulse},attrs:{placeholder:"TEAM GOAL","data-test":"goal-edit"},domProps:{value:t.goal},on:{keyup:[function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.saveAndFinishEditing.apply(null,arguments)},function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"esc",27,e.key,["Esc","Escape"])?null:t.revert.apply(null,arguments)}],keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"tab",9,e.key,"Tab")||e.ctrlKey||e.shiftKey||e.altKey||e.metaKey?null:t.saveAndFinishEditing.apply(null,arguments)},animationend:t.removePulse,input:function(e){e.target.composing||(t.goal=e.target.value.trim())},blur:function(e){return t.$forceUpdate()}}}),e("span",{staticClass:"hidden goal-value"},[t._v(t._s(t.goal.replace(/ /g," ")||" "))])])]):e("span",[e("transition",{attrs:{name:"fade",mode:"out-in"}},[t.model?e("div",{key:"1",staticClass:"view",on:{dblclick:t.edit}},[e("span",{staticClass:"goal-label",class:{empty:!t.label},attrs:{"data-test":"label"}},[t._v(t._s(t.label))]),e("span",{staticClass:"goal-value",attrs:{"data-test":"goal"}},[t._v(t._s(t.goal))])]):t.$admin?e("div",{key:"2"},[e("button",{staticClass:"button dash-button add-button",attrs:{"data-test":"add"},on:{click:t.edit}},[e("span",{staticClass:"icon"},[e("inline-svg",{staticClass:"icon-add",attrs:{src:l}})],1),t._v(" Team Goal ")])]):t._e()])],1)]},proxy:!0},{key:"right",fn:function(){return[t.model&&!t.editing&&t.$admin?e("dropdown",{staticClass:"team-focus-dropdown",attrs:{"on-dash":!0,active:t.dropdownActive,"data-test":"dropdown"},on:{toggle:t.toggleDropdown}},[e("dropdown-option",{staticClass:"team-focus-edit",attrs:{name:"Edit","data-test":"dropdown-edit"},nativeOn:{click:function(e){return t.edit.apply(null,arguments)}},scopedSlots:t._u([{key:"icon",fn:function(){return[e("inline-svg",{staticClass:"dropdown-list-icon icon icon-edit",attrs:{src:o}})]},proxy:!0}],null,!1,3245305969)}),e("dropdown-option",{staticClass:"team-focus-clear",attrs:{name:"Clear","data-test":"dropdown-clear"},nativeOn:{click:function(e){return t.clear.apply(null,arguments)}},scopedSlots:t._u([{key:"icon",fn:function(){return[e("inline-svg",{staticClass:"dropdown-list-icon icon icon-delete",attrs:{src:s}})]},proxy:!0}],null,!1,330617182)})],1):t._e()]},proxy:!0}])})}),[],!1,null,"2b7e791d").exports;export{c as default};