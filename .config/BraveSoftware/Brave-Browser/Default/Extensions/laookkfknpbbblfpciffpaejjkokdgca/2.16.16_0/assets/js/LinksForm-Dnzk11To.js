import{a as t}from"./AppHeader-DgK-F-wR.js";import{B as e}from"./BaseForm-DZdqvzm3.js";import{F as i}from"./FormInput-CED3cyHv.js";import{F as s,a as o}from"./FormToggle-CPdB9uoc.js";import{D as r}from"./BaseItemList-C404Gcql.js";import{j as a,k as n}from"./BaseIcon-B5UifJH3.js";import{n as p,u as l}from"./icon-alert--q0yLTMi.js";import{_ as c}from"./icon-close-BUGl_M7j.js";import{_ as u}from"./icon-plus-D4YOesIc.js";import{A as d}from"./AppView-DvfYjlXn.js";import{c as f,a as h,b as v,v as j,d as w}from"./links-hR2TwzXn.js";import{B as g}from"./BaseDropdownOption-umPWLVqy.js";import{c as y}from"./compareObjects-BF7sSNEf.js";import{L as b}from"./index-DQvfDEB6.js";import{A as k}from"./AppConfirmCancel-BJUvVb0h.js";import{g as S}from"./globalKeyEventManager-Bi-yHy9P.js";import{B as I}from"./BaseDropdown-DBvV1Fy2.js";import{A as C}from"./AppHeaderControl-FZTURLhY.js";import{F as _}from"./FavIcon-Ba-H42pn.js";import{_ as F}from"./icon-back-arrow-CiRQJ6G-.js";import{_ as L}from"./icon-trash-BQ1O-AfY.js";import"./icon-hide-NFfBhfBx.js";import"./FormMessage-D_iGngUy.js";import"./SmoothReflow-Du5fECCq.js";import"./allComponentsMounted-C3UsG_cA.js";import"./SoftFocus-BUhesXB-.js";import"./ToggleSwitch-DUGISQcW.js";import"./constants-BpVlFj04.js";import"./arrow-Be8MuPJi.js";import"./icon-weather-reset-C06kxk3l.js";import"./icon-settings-Bycjf8-G.js";import"./icon-back-D_TFrgyJ.js";import"./icon-cog-BFr_Pva7.js";import"./icon-skip-BOkC5L0N.js";import"./icon-down-BiHbKN-t.js";import"./icon-edit-CixeXNYx.js";import"./icon-ellipsis-D3jS4u3x.js";import"./icon-error-state-BKQhfBCj.js";import"./icon-heart-v5O7C6eS.js";import"./icon-key-BPNRipb3.js";import"./icon-next-B4hjdiAA.js";import"./icon-photo-BrwqV1T0.js";import"./icon-pin-BHeOuzvO.js";import"./icon-profile-B_XWyuTb.js";import"./icon-x-qUCmf2CW.js";import"./icon-skip-intro-BUi8b3Ak.js";import"./icon-tooltip-CN09iXOB.js";import"./icon-visible-on-CM3kpcFN.js";import"./icon-x-caret-half-CZtcH_PM.js";import"./tasks-completed-Dg2z75km.js";import"./add-COIuonao.js";import"./google-DKPAcOmk.js";import"./arrow-up-1QPpu78M.js";import"./square-check-DwLT60gj.js";import"./clocks-DjzskNOU.js";import"./close-Bj_A2br_.js";import"./search-DCqlmJx6.js";import"./folder-CwWTWsnJ.js";import"./switch-EuBTQVVE.js";import"./focus-mode-09pIyYAW.js";import"./storage-YYEO5TB5.js";import"./icon-confetti-Dz2LojDe.js";import"./ocean-bubbles-GcKjBI5B.js";import"./sparks-CAw9b6ob.js";import"./secure-B8YP-AML.js";import"./icon-asana-Csd73e1k.js";import"./icon-percent-schedule-CA5EI9b7.js";import"./icon-trello-DhCq-Fsi.js";import"./icon-clean-rFsPxTtp.js";import"./icon-more-lists-Cl9oRGK2.js";import"./icon-more-fonts-CcfOY0t4.js";import"./icon-focus-stats-keERwXFt.js";import"./icon-top-of-mind-B6EhbCcK.js";import"./icon-flow-5QqmGIWX.js";import"./icon-integrations-D9o58ob4.js";import"./icon-weather-extra-ufLpT_SX.js";import"./icon-spiral-gh4hwZDD.js";import"./icon-happy-place-D1z6CJgM.js";import"./icon-time-sensitive-CP2L3maw.js";import"./icon-hourly-CdMmiQZT.js";import"./icon-infinity-D4yMRoAd.js";import"./icon-personalize-photos-D2M4lLlt.js";import"./icon-skip-2bGCAGKt.js";import"./icon-photo-match-C2EChNEK.js";import"./icon-random-375DbcwF.js";import"./icon-timezones-DGZoTtaT.js";import"./icon-simplify-BRUtLJYp.js";import"./icon-sync-DIH26Y9h.js";import"./localStorage-4iHdj-SC.js";import"./preload-helper-DmNsytk6.js";import"./string-GDe0WbEj.js";import"./constants-CALDQiUE.js";import"./migrateLegacyUserMessageHandler-DMvEmYM4.js";import"./main-FH8FpKq2.js";import"./BaseDropdownContent-BSCj37As.js";import"./index-D7SyL4qE.js";import"./portal-vue.esm-SV1wohGy.js";const x=p({name:"LinksForm",components:{FavIcon:_,AppHeaderControl:C,BaseDropdown:I,BaseDropdownOption:g,FormToggle:o,AppView:d,FormRepeatableInput:p({name:"FormRepeatableInput",components:{DragDrop:r,DragDropHandle:p({name:"DragDropHandle"},(function(){var t=this._self._c;return t("div",{staticClass:"drag-drop-handle",attrs:{"data-test":"drag-drop-handle","data-drag-drop-handle":""}},[t("inline-svg",{staticClass:"icon icon-drag",attrs:{src:a}})],1)}),[],!1,null,"82becf8f").exports,FormFieldWrapper:s},inject:["formFields"],props:{value:{type:Array,required:!0,validator:t=>!t.length||t[0]instanceof Object},name:{type:String,default:"repeatable-input"},property:{type:String,required:!0},getNewEntry:{type:Function,required:!0},addButtonText:{type:String,default:"Add"},disableMultipleEntries:{type:Boolean,default:!1},placeholder:{type:String,default:""},...s.props},data:()=>({pulseInputIndex:null}),watch:{value:{handler(t){t.length||this.addEntry()},immediate:!0}},mounted(){var t;null==(t=this.formFields)||t.addField(this.name,this.focusInput,this.pulseAndFocusInput)},destroyed(){var t;null==(t=this.formFields)||t.removeField(this.name)},methods:{addEntry(){this.value.push(this.getNewEntry())},async addEntryIfLastEntryHasValue(){var t,e;(null==(t=this.value[this.value.length-1][this.property])?void 0:t.trim())?(this.addEntry(),await this.$nextTick(),await this.$nextTick(),null==(e=this.$refs.input[this.value.length-1])||e.focus()):this.pulseAndFocusInput(this.value.length-1)},onAddEntryClick(){this.disableMultipleEntries?this.$emit("addBlocked"):this.addEntryIfLastEntryHasValue()},onEnter(){var t;this.disableMultipleEntries?null==(t=this.formFields)||t.focusNextInputOrSubmitIfLast(this.name):this.addEntryIfLastEntryHasValue()},removeEntry(t){this.value.splice(t,1)},async focusInput(t=0){var e,i;await this.$nextTick(),null==(i=null==(e=this.$refs.input[t])?void 0:e.focus)||i.call(e)},async pulseAndFocusInput(t){await this.focusInput(t),this.pulseInputIndex=t,await m.utils.delay(1e3),this.pulseInputIndex=null}}},(function(){var t=this,e=t._self._c;return e("form-field-wrapper",t._b({staticClass:"form-repeatable-input"},"form-field-wrapper",t.$props,!1),[e("drag-drop",{staticClass:"repeatable-input-rows",attrs:{order:t.value,"use-handles":!0},on:{"update:order":function(e){return t.$emit("input",e)}}},t._l(t.value,(function(i,s){return e("div",{key:i.id,staticClass:"repeatable-input-row",attrs:{"data-test":"repeatable-input-row"}},[t.value.length>1?e("drag-drop-handle"):t._e(),t._t("repeatable-input-row-before-input",null,{value:i[t.property]}),e("div",{staticClass:"repeatable-input-row-content"},[e("input",{directives:[{name:"model",rawName:"v-model",value:i[t.property],expression:"entry[property]"}],ref:"input",refInFor:!0,class:{"empty-input":!i[t.property],pulse:t.pulseInputIndex===s},attrs:{placeholder:s?"":t.placeholder},domProps:{value:i[t.property]},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.onEnter.apply(null,arguments)},input:function(e){e.target.composing||t.$set(i,t.property,e.target.value)}}}),e("div",{staticClass:"repeatable-input-row-actions"},[t._t("repeatable-input-row-actions",null,{value:i[t.property]}),t.value.length>1?e("div",{staticClass:"icon-wrapper",attrs:{title:"Delete"},on:{click:function(e){return t.removeEntry(s)}}},[e("inline-svg",{staticClass:"icon icon-delete",attrs:{src:c}})],1):t._e()],2)])],2)})),0),e("div",{staticClass:"add",on:{click:t.onAddEntryClick}},[t._t("add",(function(){return[e("div",{staticClass:"button-clear"},[e("span",{staticClass:"button-label"},[e("inline-svg",{staticClass:"icon icon-plus",attrs:{src:u}}),e("span",[t._v(t._s(t.addButtonText))])],1)])]}))],2)],1)}),[],!1,null,"837995ab").exports,FormInput:i,BaseForm:e,AppHeader:t,AppConfirmCancel:k},inject:["itemStore","viewStateStore","capture","batchCapture"],computed:{activeItem(){return this.itemStore.activeItem},isTeamAdmin:()=>m.utils.getUserState().isTeamAdmin},mounted(){this.viewStateStore.beforeViewChange=()=>0===this.getFormMutations({cancelling:!0}).length?Promise.resolve(!0):this.viewStateStore.setConfirmation({title:"Are you sure you want to cancel?",dashboardOverlay:!0}),S.registerEventListener("backToList","keyup",27,this.returnToListView)},async destroyed(){this.viewStateStore.resetBeforeViewChange(),this.itemStore.clearActiveItem(),S.removeEventListener("backToList","keyup",27,this.returnToListView)},methods:{getFormMutations({cancelling:t=!1}={}){let e;if(this.itemStore.adding){if(t){const t=new h({id:this.activeItem.id});e=f(v(t))}}else{const t=this.itemStore.buildLinkGroup(this.itemStore.getItemById(this.itemStore.activeItemId));e=f(t)}const i=f(v(this.activeItem));return y(e,i)},async submit(){const t=this.getFormMutations();if(0===t.length)return void(await this.returnToListView());const e=v(this.activeItem);j(e),this.capture(`${e.hasManyLinks?"tab group":"link"} ${this.itemStore.adding?"add":"edit"}`,{is_paid_event:e.hasManyLinks}),await this.itemStore.processMutations(t),this.viewStateStore.resetBeforeViewChange(),await this.returnToListView()},async confirmAndDelete(){var t;null==(t=this.$refs.editingDropdown)||t.closeDropdown();await this.viewStateStore.setConfirmation({title:"Are you sure you want to delete this link?"})&&(this.capture((this.activeItem.hasManyLinks?"tab group":"link")+" delete",{is_paid_event:this.activeItem.hasManyLinks}),await this.itemStore.deleteLinkGroup(this.activeItem.id),this.viewStateStore.resetBeforeViewChange(),await this.returnToListView())},returnToListView(){return this.viewStateStore.setActiveView(b.List)},createNewUrl:()=>new w,showTabGroupsUpsell(){m.cmd("modal.open","UPSELL_TAB_GROUPS",{eventSource:"dash"})},closePopup(){return this.viewStateStore.togglePopup(!1)},async openLinkInNewTab(t){this.batchCapture("link click",{is_paid_event:!1}),await m.utils.getBrowser().tabs.create({url:l.ensureUrlScheme(t)})}}},(function(){var t=this,e=t._self._c;return e("app-view",{staticClass:"links-app-form",attrs:{"data-test":"links-form-view"},scopedSlots:t._u([{key:"header",fn:function(){return[e("app-header",{on:{close:t.closePopup},scopedSlots:t._u([{key:"left",fn:function(){return[e("app-header-control",{attrs:{"data-test":"return-list-view"},on:{click:t.returnToListView}},[e("inline-svg",{staticClass:"icon back-icon",attrs:{src:F}})],1)]},proxy:!0},{key:"center",fn:function(){return[t._v(" "+t._s(t.itemStore.adding?"Creating a":"Editing")+" link ")]},proxy:!0},{key:"right",fn:function(){return[t.itemStore.adding?t._e():e("base-dropdown",{ref:"editingDropdown",attrs:{"data-test":"edit-dropdown","container-class":"app"}},[e("base-dropdown-option",{attrs:{"data-test":"delete-link"},on:{click:t.confirmAndDelete}},[e("inline-svg",{staticClass:"icon icon-trash",attrs:{src:L}}),t._v(" Delete ")],1)],1)]},proxy:!0}])})]},proxy:!0},{key:"body",fn:function(){return[e("base-form",{attrs:{submit:t.submit,adding:t.itemStore.adding}},[e("form-input",{attrs:{"data-test":"title-input",autofocus:"",label:"Title",name:"title"},model:{value:t.activeItem.title,callback:function(e){t.$set(t.activeItem,"title",e)},expression:"activeItem.title"}}),e("form-repeatable-input",{attrs:{placeholder:"example.com",label:"Links",name:"links",property:"url","data-test":"links-input","get-new-entry":t.createNewUrl,"disable-multiple-entries":!t.$plus},on:{addBlocked:t.showTabGroupsUpsell},scopedSlots:t._u([{key:"repeatable-input-row-before-input",fn:function({value:t}){return[e("fav-icon",{staticClass:"repeatable-favicon",attrs:{url:t}})]}},{key:"repeatable-input-row-actions",fn:function({value:i}){return[i?e("div",{staticClass:"icon-wrapper",attrs:{"data-test":"repeatable-icon-link",title:"Open Link in New Tab"},on:{click:function(e){return t.openLinkInNewTab(i)}}},[e("inline-svg",{staticClass:"icon icon-external-link",attrs:{src:n}})],1):t._e()]}},{key:"add",fn:function(){return[e("div",{staticClass:"button-clear",attrs:{"data-test":"add-link"}},[e("span",{staticClass:"button-label"},[e("inline-svg",{staticClass:"icon icon-plus",attrs:{src:u}}),e("span",[t._v("Add another tab")])],1),t.$plus?t._e():e("div",{staticClass:"badge badge-plus"},[t._v("PLUS")])])]},proxy:!0}]),model:{value:t.activeItem.links,callback:function(e){t.$set(t.activeItem,"links",e)},expression:"activeItem.links"}}),e("form-toggle",{attrs:{"data-test":"pinned-input",label:"Pin to Dashboard"},model:{value:t.activeItem.pinned,callback:function(e){t.$set(t.activeItem,"pinned",e)},expression:"activeItem.pinned"}})],1)]},proxy:!0},{key:"confirm",fn:function(){return[t.viewStateStore.confirmationProps?e("app-confirm-cancel",t._b({attrs:{"data-test":"confirm-cancel"}},"app-confirm-cancel",t.viewStateStore.confirmationProps,!1)):t._e()]},proxy:!0}])})}),[],!1,null,"fa98e947").exports;export{x as default};