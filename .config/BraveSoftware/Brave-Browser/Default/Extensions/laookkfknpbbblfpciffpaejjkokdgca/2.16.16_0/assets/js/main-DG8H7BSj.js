import"./VueBase-W7f1OYgs.js";import{P as t}from"./Popup-ByBvHAFZ.js";import{n as e,k as o,ab as i,u as a,V as s}from"./icon-alert--q0yLTMi.js";import{d as r,a as n,S as p,b as l}from"./onboardingStepCollection-BKBgZU5n.js";import{u as d,s as c,o as S}from"./index-DQvfDEB6.js";import{v as h}from"./v-style-BjkA8kde.js";import"./SubscriptionSummary-eTeXKiGw.js";import"./index-CJJH83pl.js";import"./portal-vue.esm-SV1wohGy.js";import"./BaseIcon-B5UifJH3.js";import"./arrow-Be8MuPJi.js";import"./icon-weather-reset-C06kxk3l.js";import"./icon-settings-Bycjf8-G.js";import"./icon-back-arrow-CiRQJ6G-.js";import"./icon-back-D_TFrgyJ.js";import"./icon-trash-BQ1O-AfY.js";import"./icon-close-BUGl_M7j.js";import"./icon-cog-BFr_Pva7.js";import"./icon-skip-BOkC5L0N.js";import"./icon-down-BiHbKN-t.js";import"./icon-edit-CixeXNYx.js";import"./icon-ellipsis-D3jS4u3x.js";import"./icon-error-state-BKQhfBCj.js";import"./icon-heart-v5O7C6eS.js";import"./icon-hide-NFfBhfBx.js";import"./icon-key-BPNRipb3.js";import"./icon-next-B4hjdiAA.js";import"./icon-photo-BrwqV1T0.js";import"./icon-pin-BHeOuzvO.js";import"./icon-plus-D4YOesIc.js";import"./icon-profile-B_XWyuTb.js";import"./icon-x-qUCmf2CW.js";import"./icon-skip-intro-BUi8b3Ak.js";import"./icon-tooltip-CN09iXOB.js";import"./icon-visible-on-CM3kpcFN.js";import"./icon-x-caret-half-CZtcH_PM.js";import"./tasks-completed-Dg2z75km.js";import"./add-COIuonao.js";import"./google-DKPAcOmk.js";import"./arrow-up-1QPpu78M.js";import"./square-check-DwLT60gj.js";import"./clocks-DjzskNOU.js";import"./close-Bj_A2br_.js";import"./search-DCqlmJx6.js";import"./folder-CwWTWsnJ.js";import"./switch-EuBTQVVE.js";import"./focus-mode-09pIyYAW.js";import"./storage-YYEO5TB5.js";import"./icon-confetti-Dz2LojDe.js";import"./ocean-bubbles-GcKjBI5B.js";import"./sparks-CAw9b6ob.js";import"./secure-B8YP-AML.js";import"./icon-asana-Csd73e1k.js";import"./icon-percent-schedule-CA5EI9b7.js";import"./icon-trello-DhCq-Fsi.js";import"./icon-clean-rFsPxTtp.js";import"./icon-more-lists-Cl9oRGK2.js";import"./icon-more-fonts-CcfOY0t4.js";import"./icon-focus-stats-keERwXFt.js";import"./icon-top-of-mind-B6EhbCcK.js";import"./icon-flow-5QqmGIWX.js";import"./icon-integrations-D9o58ob4.js";import"./icon-weather-extra-ufLpT_SX.js";import"./icon-spiral-gh4hwZDD.js";import"./icon-happy-place-D1z6CJgM.js";import"./icon-time-sensitive-CP2L3maw.js";import"./icon-hourly-CdMmiQZT.js";import"./icon-infinity-D4yMRoAd.js";import"./icon-personalize-photos-D2M4lLlt.js";import"./icon-skip-2bGCAGKt.js";import"./icon-photo-match-C2EChNEK.js";import"./icon-random-375DbcwF.js";import"./icon-timezones-DGZoTtaT.js";import"./icon-simplify-BRUtLJYp.js";import"./icon-sync-DIH26Y9h.js";import"./BaseDropdownContent-BSCj37As.js";import"./constants-CALDQiUE.js";import"./preload-helper-DmNsytk6.js";import"./index-D7SyL4qE.js";import"./localStorage-4iHdj-SC.js";import"./string-GDe0WbEj.js";import"./itemModelMixin-B7XBtNZL.js";import"./reactiveCustomization-DqGARD3C.js";import"./namesMixin-DfNb5KMg.js";import"./itemDataServiceMixins-DPsPiv13.js";import"./focusModeHelpers-CiIJnkuY.js";import"./scenes-D8jpYIdj.js";import"./PomodoroTimers-BWkB-14p.js";import"./authService-CGVTYYkM.js";import"./loginHelpers-BZASe8UD.js";import"./siteBlockerGroups-E8GFJ9Dm.js";import"./constants-BT5o8PmI.js";import"./compareObjects-BF7sSNEf.js";import"./migrateLegacyUserMessageHandler-DMvEmYM4.js";import"./main-FH8FpKq2.js";const u=e({name:"ModalContainer",components:{Popup:t,vStyle:h},setup:()=>({modalStore:d()}),data:()=>({plans:{},plansError:!1,sales:{},transitionDisabled:!1,transitionDuration:0,transitionName:void 0}),computed:{activeSubStep(){return this.modalStore.activeStep&&this.modalStore.activeStep.subSteps&&this.modalStore.activeStep.subSteps[this.modalStore.activeSubStepIndex]||null}},watch:{async"modalStore.activeStep"(t,e){var o;t!==e&&(t.key&&t.key===e.key&&(this.transitionDisabled=!0),null==(o=t.onShow)||o.call(t)),(null==t?void 0:t.getPlanInfo)&&!Object.keys(this.plans).length&&this.getPlanInfo().then((({plans:t={},sales:e={}}={})=>{this.plans=t,this.sales=e||{}})).catch((t=>{this.plansError=!0,console.error(t)})),0===Object.keys(e).length&&this.setActiveStepTransition()},"modalStore.activeStep.hideOtherApps"(t,e){t?m.widgetManager.hideApps({layer:"modalContainer"}):e&&m.widgetManager.showApps({layer:"modalContainer"})}},created(){m.modals={stepsEnum:c,definitions:r,getAllocatedDefinitions:n},m.on("modal:show",this.showModal),m.on("modal:complete",this.handleStepCompletion),m.on("modal:subStepComplete",this.handleSubStepCompletion),m.on("modal:close",this.dismissModal),m.on("modal:showUpgrade",this.showUpgrade),m.trigger("modalContainer:created:checkForced"),m.trigger("modalContainer:created"),this.checkParamsAndShowModal()},destroyed(){m.off("modal:show",this.showModal),m.off("modal:complete",this.handleStepCompletion),m.off("modal:subStepComplete",this.handleSubStepCompletion),m.off("modal:close",this.dismissModal),m.off("modal:showUpgrade",this.showUpgrade),delete m.modals},methods:{updateStepActiveProperties(t,{deactivate:e,activeSubStepIndex:o}={}){e?(this.$delete(t,"activeSubStepIndex"),this.$delete(t,"active")):(t.active||this.$set(t,"active",!0),t.subSteps&&void 0!==o&&this.$set(t,"activeSubStepIndex",o))},async showModal(t,{subStepIndex:e,force:i}={}){var a,s,r,n;await o((()=>this.modalStore.hidden)).toBe(!1),this.modalStore.locked&&!i||(i&&this.modalStore.activeStep.keepOpenUntilComplete&&this.modalStore.addCurrentModalToStack(),this.modalStore.locked=!0,void 0===e&&(e="firstSubStep"in t?t.firstSubStep():0),"function"==typeof t.component&&await t.component(),await(null==(a=t.beforeShow)?void 0:a.call(t)),await(null==(n=null==(r=null==(s=t.subSteps)?void 0:s[e])?void 0:r.beforeShow)?void 0:n.call(r)),this.modalStore.activeStep=t,this.modalStore.activeSubStepIndex=e,this.updateStepActiveProperties(this.modalStore.activeStep,{activeSubStepIndex:this.modalStore.activeSubStepIndex}))},async handleSubStepCompletion(){var t,e,o,i,a,s;const r=this.activeSubStep,n=this.modalStore.activeSubStepIndex,l=this.modalStore.activeStep.subSteps&&this.modalStore.activeSubStepIndex<this.modalStore.activeStep.subSteps.length-1;l&&(this.modalStore.activeSubStepIndex++,await(null==(o=null==(e=null==(t=this.modalStore.activeStep.subSteps)?void 0:t[this.modalStore.activeSubStepIndex])?void 0:e.beforeShow)?void 0:o.call(e)),this.updateStepActiveProperties(this.modalStore.activeStep,{activeSubStepIndex:this.modalStore.activeSubStepIndex})),await(null==(i=null==r?void 0:r.onLeave)?void 0:i.call(r,p.Completed)),await(null==(s=(a=this.modalStore.activeStep).onSubStepComplete)?void 0:s.call(a,{activeSubStep:r,activeSubStepIndex:n,nextSubStepIndex:this.modalStore.activeSubStepIndex,nextSubStep:this.activeSubStep,hasSubStepsRemaining:l})),l||await this.handleStepCompletion()},async handleStepCompletion({state:t}={state:p.Completed}){var e,o,i;const a=this.modalStore.activeStep,s=this.activeSubStep;await(null==(e=a[l[t]])?void 0:e.call(a,{activeSubStep:this.activeSubStep,activeSubStepIndex:this.modalStore.activeSubStepIndex})),this.updateStepActiveProperties(a,{deactivate:!0}),this.modalStore.locked=!1,await(null==(o=null==s?void 0:s.onLeave)?void 0:o.call(s,t)),await(null==(i=a.onLeave)?void 0:i.call(a,t));const r=this.modalStore.getModalFromStack();r&&await this.showModal(r[0],{subStepIndex:r[1]}),a.id===this.modalStore.activeStep.id&&(this.modalStore.activeStep={})},showUpgrade(){var t,e;null==(e=(t=this.modalStore.activeStep).onUpgradeClick)||e.call(t),m.utils.useAppleAppPayment()&&m.isLoggedIn()?S():m.cmd("window.account.open.login","upgrade")},dismissModal(){this.handleStepCompletion({state:p.Dismissed})},handleModalError(){this.handleStepCompletion({state:p.Errored}),this.$set(this.modalStore.activeStep,"error",!0)},goToSubStep(t){this.modalStore.activeSubStepIndex=t,this.updateStepActiveProperties(this.modalStore.activeStep,{activeSubStepIndex:this.modalStore.activeSubStepIndex})},getPlanInfo(){return this.$xhr.get("account/plans",{timeout:8e3,params:{exp:!0}}).then((({data:t})=>{if(!t)throw new Error("no data for plans");return localStorage.getItem("sale:force")&&m.utils.isDev()&&(t.personal.sales={yearly:i}),t.personal}))},async afterModalEnter(){await this.$nextTick(),this.transitionDisabled=!1},afterModalLeave(){this.setActiveStepTransition(),this.resetActiveSubStepIndex(),Object.keys(this.modalStore.activeStep).length||(m.cmd("notification.safariUpdate.shouldShow")?m.cmd("notification.safariUpdate.show"):m.models.notificationManager.displayPendingMessages())},setActiveStepTransition(){this.transitionDuration=this.modalStore.activeStep.transitionDuration,this.transitionName=this.modalStore.activeStep.transitionName||(["top-right","top-left"].includes(this.modalStore.activeStep.position)?"fade-slide-up":"fade-slide-down")},checkParamsAndShowModal(){const t=a.getAndRemoveParamsFromUrl("modalStep","modalSubStepIndex");t.modalStep&&this.showModal(r[c[t.modalStep]],{subStepIndex:Number(t.modalSubStepIndex??"0")})},resetActiveSubStepIndex(){this.modalStore.stepActive||(this.modalStore.activeSubStepIndex=0)}}},(function(){var t=this,e=t._self._c;return e("div",{directives:[{name:"show",rawName:"v-show",value:!t.modalStore.hidden,expression:"!modalStore.hidden"}],staticClass:"modal-container",attrs:{"data-test":"modal-container"},on:{mousedown:function(t){t.stopPropagation()},mouseup:function(t){t.stopPropagation()}}},[e("transition",{attrs:{name:t.transitionName,duration:t.transitionDisabled?0:t.transitionDuration,mode:"out-in"},on:{"after-enter":t.afterModalEnter,"after-leave":t.afterModalLeave}},[t.modalStore.stepActive?e(t.modalStore.activeStep.component||"Popup",t._b({key:t.modalStore.activeStep.transitionOnSubStepChange?`${t.modalStore.activeStep.id}-${t.modalStore.activeSubStepIndex}`:t.modalStore.activeStep.id,tag:"component",staticClass:"modal-component",attrs:{plans:t.plans,"plans-error":t.plansError,sales:t.sales,"active-sub-step-index":t.modalStore.activeSubStepIndex,"active-sub-step":t.activeSubStep,hidden:t.modalStore.hidden},on:{error:t.handleModalError,dismiss:t.dismissModal,stepComplete:t.handleStepCompletion,subStepComplete:t.handleSubStepCompletion,goToSubStep:t.goToSubStep,upgrade:t.showUpgrade}},"component",t.modalStore.activeStep,!1)):t._e()],1),e("transition-group",{attrs:{duration:t.transitionDuration}},[t.modalStore.activeStep&&t.modalStore.activeStep.customCss&&!t.modalStore.hidden?e("v-style",{key:t.modalStore.activeStep.id},[t._v(t._s(t.modalStore.activeStep.customCss))]):t._e(),t.activeSubStep&&t.activeSubStep.customCss&&!t.modalStore.hidden?e("v-style",{key:t.modalStore.activeSubStepIndex},[t._v(t._s(t.activeSubStep.customCss))]):t._e()],1)],1)}),[],!1,null,"f07b1825").exports;if(!m.modals){const t=new s({render:t=>t(u)}).$mount();document.querySelector(".apps .full").appendChild(t.$el)}