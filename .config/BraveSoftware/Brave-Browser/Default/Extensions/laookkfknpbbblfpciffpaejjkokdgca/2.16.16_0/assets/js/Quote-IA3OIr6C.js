import{R as t,X as e,n as o,A as s}from"./icon-alert--q0yLTMi.js";import{c as i}from"./reactiveCustomization-DqGARD3C.js";import{a}from"./allComponentsMounted-C3UsG_cA.js";import{s as r}from"./showAnyway-d_ZUKj8O.js";import{B as n}from"./BaseDropdownOption-umPWLVqy.js";import{B as c}from"./BaseDropdownDivider-z6WJAu5K.js";import{B as d}from"./BaseDropdown-DBvV1Fy2.js";import{_ as u}from"./icon-heart-v5O7C6eS.js";import{_ as l}from"./icon-skip-intro-BUi8b3Ak.js";import{_ as p,a as h}from"./icon-x-qUCmf2CW.js";import{_ as v}from"./icon-cog-BFr_Pva7.js";import"./localStorage-4iHdj-SC.js";import"./preload-helper-DmNsytk6.js";import"./string-GDe0WbEj.js";import"./VueBase-W7f1OYgs.js";import"./index-DQvfDEB6.js";import"./migrateLegacyUserMessageHandler-DMvEmYM4.js";import"./main-FH8FpKq2.js";import"./index-CJJH83pl.js";import"./portal-vue.esm-SV1wohGy.js";import"./constants-CALDQiUE.js";import"./BaseDropdownContent-BSCj37As.js";import"./index-D7SyL4qE.js";import"./icon-ellipsis-D3jS4u3x.js";var g=[],w=function(){var t,e;for(e=0;e<g.length;e+=1)(t=g[e]).style.maxWidth="",b(t)&&f(t,t.clientHeight,0,t.clientWidth)},f=function(t,e,o,s){var i;o>=s?t.style.maxWidth=s+"px":(i=(o+s)/2,t.style.maxWidth=i+"px",t.clientHeight>e?f(t,e,i+1,s):f(t,e,o+1,i))},b=function(t){var e,o,s,i,a;return a=t.innerHTML,10,s=t.innerHTML.split(" "),(i=document.createElement("span")).id="element-first-word",i.innerHTML=s[0],s=s.slice(1),t.innerHTML="",t.appendChild(i),t.innerHTML+=" "+s.join(" "),e=(i=document.getElementById("element-first-word")).offsetHeight,o=t.offsetHeight,t.innerHTML=a,o-10>e};const y=Backbone.Model.extend({defaults:{_id:"",body:"",source:"",is_custom:!1,detail_url:"",twitter:""},idAttribute:"forDate"}),Q=m.models.FeedManager.extend({initialize:function(){m.models.FeedManager.prototype.initialize.call(this,m.models.Quote,"quote")}}),_=Backbone.Collection.extend({localStorage:new Backbone.LocalStorage("momentum-quote"),model:m.models.Quote,getActiveItem:function(){if(this.length>0){let t=m.utils.getDateString();return this.get(t)}}}),q=new s({feature:"quotes"});m.models.Quote=y,m.collect.Quotes=_,m.collect.quotes=new _,m.models.QuoteManager=Q,m.models.quoteManager=new Q;const D=o({name:"Quote",components:{BaseDropdown:d,BaseDropdownDivider:c,BaseDropdownOption:n},bb:()=>({collection:m.collect.quotes}),directives:{ResizeSensor:t},mixins:[a],setup:()=>({debounedHover:null}),data:()=>({wrappedBodyArray:"",activeQuoteId:"",skipping:!1,dropdownActive:!1,quoteOverride:""}),computed:{showAnyway:()=>r.includes("quote"),quoteVisible:()=>i.quoteVisible,activeQuote(){return this.quoteOverride||this.collection.get(this.activeQuoteId)},quoteUuid(){return this.activeQuote?this.activeQuote.get("_id"):""},isCustom(){return!!this.activeQuote&&this.activeQuote.get("is_custom")},body(){return this.activeQuote?`“${this.activeQuote.get("body")}”`:""},bodyArray(){return this.body.split(" ")},source(){return this.activeQuote?this.activeQuote.get("source"):""},detailUrl(){return this.activeQuote?this.activeQuote.get("detail_url"):""},twitter(){return this.activeQuote?this.activeQuote.get("twitter"):""},twitterIntentUrl(){if(!this.activeQuote)return"";const t=this.activeQuote.get("twitterIntentUrl");if(t)return t;const e=this.twitter?`"${this.body}" -@${this.twitter} #motivation`:`"${this.body}" -${this.source} #motivation`;return"https://x.com/intent/tweet?text="+encodeURIComponent(e)+"&via=momentumdash&related=momentumdash,levibucsis"},isFavorite(){return!!this.activeQuote&&this.activeQuote.get("is_favorite")}},created(){m.models.quoteManager.firstFetch(),this.setQuote(),m.on("newDay",this.setQuote),m.collect.quotes.on("reset add change sync refresh",this.setQuote),m.on("appsReady",this.wrapQuoteAndWatch),m.on("quote:override",this.overrideQuote),m.trigger("quote:created")},destroyed(){m.off("newDay",this.setQuote),m.collect.quotes.off("reset add change sync refresh",this.setQuote),m.off("appsReady",this.wrapQuoteAndWatch),m.off("quote:override",this.overrideQuote)},methods:{overrideQuote(t){this.quoteOverride=t?{body:t,forDate:m.utils.getDateString(),_id:m.utils.uuidv4(),get(t){return this[t]}}:null},handleClick(){var t;this.$touch&&(null==(t=this.$refs.settingsDropdown)||t.openDropdown()),this.detailUrl&&this.detailUrl.length>0&&e(this.detailUrl)},captureDebouncedHover(t){const e=t.target;this.cancelDebouncedHoverCapture(),this.debounedHover=setTimeout((()=>{e.matches(":hover")&&q.capture("quote hover",{custom:this.isCustom})}),1e3)},cancelDebouncedHoverCapture(){clearTimeout(this.debounedHover)},shareTwitter(){var t;null==(t=this.$refs.settingsDropdown)||t.closeDropdown(),e(this.twitterIntentUrl),q.capture("quote tweet click",{custom:this.isCustom})},toggleFavorite(){let t=this.activeQuote.is_favorite=!this.isFavorite;m.models.quoteManager.toggleFavorite(t).catch((()=>this.activeQuote.is_favorite=!t)),q.capture("quote "+(t?"fav":"unfav"),{custom:this.isCustom,location:"dash"})},skipQuote(){var t;if(!this.$plus)return null==(t=this.$refs.settingsDropdown)||t.closeDropdown(),void m.cmd("modal.open","UPSELL_QUOTES",{eventSource:"dash"});this.skipping||(this.skipping=!0,setTimeout((()=>{m.models.quoteManager.skipItem().finally((()=>{this.skipping=!1})),q.capture("quote skip",{is_paid_event:!0,custom:this.isCustom})}),450))},wrapQuoteAndWatch(){this.wrapQuote(),this.watcher||(this.watcher=this.$watch("body",this.wrapQuote))},wrapQuote(){this.$nextTick((()=>{var t;t=".quote .body .body-text",g=document.querySelectorAll(t),w(),this.$nextTick((()=>{m.trigger("quote:updated")}))}))},setQuote(){this.activeQuoteId=this.getActiveQuote()},getActiveQuote(){let t;return this.collection.length>0&&(t=this.collection.getActiveItem()),t?(m.trigger("quote:downloaded"),t.id):(m.trigger("sync:download","quote"),"")},openSettings(){var t;null==(t=this.$refs.settingsDropdown)||t.closeDropdown(),m.commandManager.executeAsync("settings.display",null,{section:"quote-settings"})},openDropdown(){var t;null==(t=this.$refs.settingsDropdown)||t.openDropdown()},onDropdownToggle(t){this.dropdownActive=t},access:m.utils.access}},(function(){var t=this,e=t._self._c;return e("div",{staticClass:"app-container quote",class:{"show-anyway":t.showAnyway},attrs:{"data-test":"quote","data-show-anyway":"quote"}},[e("transition",{attrs:{name:"fade",mode:"out-in"}},[t.activeQuote?e("div",{directives:[{name:"resize-sensor",rawName:"v-resize-sensor",value:t.wrapQuote,expression:"wrapQuote"}],key:t.quoteUuid,staticClass:"app-dash",class:{active:t.dropdownActive},attrs:{"data-test":"app-dash"},on:{mouseenter:t.captureDebouncedHover,mouseleave:t.cancelDebouncedHoverCapture,click:function(e){return e.preventDefault(),t.handleClick(e)},dblclick:t.openDropdown}},[e("p",{staticClass:"body"},[e("span",{staticClass:"body-text",attrs:{"data-test":"body-text"}},[t._v(t._s(t.body))])]),e("div",{staticClass:"below"},[e("div",{staticClass:"below-actions",attrs:{"data-test":"below"}},[t.source?e("span",{staticClass:"source u--mobile-hide",attrs:{"data-test":"source"}},[t._v(t._s(t.source))]):t._e(),e("base-dropdown",{ref:"settingsDropdown",attrs:{"container-class":"app","data-test":"settings-dropdown","mobile-toggle-hidden":!0},on:{toggle:t.onDropdownToggle},scopedSlots:t._u([{key:"toastHeader",fn:function(){return[e("div",{staticClass:"toast-title",attrs:{"data-test":"body-text"}},[t._v(t._s(t.body))]),t.source?e("div",{staticClass:"toast-source",attrs:{"data-test":"source"}},[t._v("– "+t._s(t.source))]):t._e()]},proxy:!0}],null,!1,3597242828)},[e("base-dropdown-option",{attrs:{"data-test":"favorite"},on:{click:t.toggleFavorite}},[e("span",{class:["favorite",{active:t.isFavorite}],attrs:{"data-test":"favorite-icon"}},[e("inline-svg",{staticClass:"icon icon-heart",attrs:{src:u}})],1),t._v(" "+t._s(t.isFavorite?"Unfavorite":"Favorite")+" ")]),e("base-dropdown-option",{attrs:{"data-test":"skip"},on:{click:t.skipQuote}},[e("inline-svg",{staticClass:"icon",attrs:{src:l}}),t._v(" Skip to new quote "),t.$plus?t._e():e("span",{staticClass:"badge badge-plus"},[t._v("PLUS")])],1),e("base-dropdown-option",{attrs:{"data-test":"share"},on:{click:t.shareTwitter}},[e("inline-svg",{staticClass:"icon icon-x",attrs:{src:p}}),t._v(" Share ")],1),e("base-dropdown-divider"),e("base-dropdown-option",{attrs:{"data-test":"manage"},on:{click:t.openSettings}},[e("inline-svg",{staticClass:"icon",attrs:{src:h}}),t._v(" Manage quotes ")],1),e("base-dropdown-divider"),e("base-dropdown-option",{attrs:{"data-test":"settings"},on:{click:t.openSettings}},[e("inline-svg",{staticClass:"icon",attrs:{src:v}}),t._v(" Settings ")],1)],1)],1)])]):t._e()])],1)}),[],!1,null,"9e0d2c8a").exports;export{D as default};