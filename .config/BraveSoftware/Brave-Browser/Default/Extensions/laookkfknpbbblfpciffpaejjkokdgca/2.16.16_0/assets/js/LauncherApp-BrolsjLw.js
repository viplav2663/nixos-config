import{V as t,n as e,X as s}from"./icon-alert--q0yLTMi.js";import{A as i}from"./AppPopup-CAECMUMV.js";import{_ as a}from"./icon-ellipsis-D3jS4u3x.js";import{_ as n}from"./icon-close-BUGl_M7j.js";import"./localStorage-4iHdj-SC.js";import"./preload-helper-DmNsytk6.js";import"./string-GDe0WbEj.js";import"./globalKeyEventManager-Bi-yHy9P.js";const r=new(t.extend({name:"AppDataManager",data:()=>({rawData:{},appData:[],loaded:!1}),localStorageKey:"app_data",created(){this.rawData=localStorage.getObject("apps"),this.rawData&&(this.$set(this,"appData",this.buildHierarchy(this.rawData)),this.loaded=!0),this.getData().then((t=>{this.rawData=t,localStorage.setObject("apps",this.rawData),this.$set(this,"appData",this.buildHierarchy(this.rawData)),this.loaded=!0}))},methods:{getData:()=>new Promise(((t,e)=>{$.ajax({url:m.globals.urlRootApi+"team/apps",success:e=>{t(e)},error:t=>{e(t)}})})),sort:(t,e)=>t.order-e.order,buildHierarchy(t){let e=[];return t&&t.categories&&t.categories.forEach((t=>{t.apps=[],e.push(t)})),t&&t.apps&&t.apps.forEach((t=>{e.filter((e=>e.id===t.categoryId)).forEach((e=>{e.apps.push(t)}))})),e.sort(this.sort).forEach((t=>t.apps.sort(this.sort))),e}}}));const o=e({name:"LauncherApp",components:{AppPopup:i},dimensions:{rowLength:4,maxRows:2,itemMargin:10,itemHeight:114,itemWidth:144,appPadding:21,tabSidePadding:11,loadingStateItemCount:8,loadingStateTabCount:2},loadingAnimationDuration:1500,loadingAnimationDelay:200,data:()=>({navTabs:[],moreTabs:[],tabsBounced:!1,showMore:!1,showMoreIcon:!1,activeTab:0,searchInput:"",underlineLeft:0,underlineWidth:0,blockUnderlineTransition:!0,blockListTransition:!0,shiftNipple:0,appListSvg:"",tabListSvg:"",searchFocused:!1}),computed:{isLoading:()=>!r.loaded,isEmpty(){return!(this.isLoading||this.appData&&this.appData.length)},appData:()=>r.appData,activeTabEmpty(){return!this.isLoading&&!this.isEmpty&&0===this.appData[this.activeTab].apps.length},navOverflow(){return this.moreTabs.length},activeTabIsInDropdown(){return this.moreTabs.length&&this.activeTab>=this.navTabs.length},launcherWidth(){let t=this.$options.dimensions;return(t.itemWidth+t.itemMargin)*t.rowLength-t.itemMargin+2*t.appPadding},bottomRowItemCount(){let t=this.filteredItems.length,e=this.$options.dimensions.rowLength,s=t%e;return 0===s&&0!==t&&(s=e),s},listTransitionDuration(){return this.blockListTransition?0:100},filteredItems(){return this.appData.length?this.searchInput?m.utils.fuzzyFilter(this.searchInput,r.rawData.apps,"title"):this.appData[this.activeTab].apps:[]}},watch:{searchInput(t,e){(t&&!e||e&&!t)&&this.setUnderlinePosition()}},mounted(){if(m.trigger("notification:hide"),this.updatePositioning(!0),this.addListeners(),this.isLoading){this.tabListSvg&&this.appListSvg||this.$nextTick((()=>this.getLoadingStateSVG()));let t=this.$watch("isLoading",(e=>{!1===e&&(this.blockUnderlineTransition=!0,this.$nextTick((()=>{this.bounceTabsToDropdown(),this.setUnderlinePosition(!0),t()})))}))}else this.$nextTick((()=>{this.bounceTabsToDropdown(),this.setUnderlinePosition(!0)}));this.$nextTick((()=>{this.$refs.search&&this.$refs.search.focus()})),setTimeout((()=>{this.blockListTransition=!1}),300)},destroyed(){this.removeListeners()},methods:{switchToTab(t,e){e?(this.activeTab=this.navTabs.length+t,this.focusFirstItem=!0,this.$nextTick(this.closeDropdown)):this.activeTab=t,this.$nextTick((()=>{this.setUnderlinePosition()}))},toggleApp(){this.$emit("close")},setUnderlinePosition(t){let e;this.searchInput?(e=this.$refs["search-wrapper"],this.underlineLeft=`${e.offsetLeft}px`,this.underlineWidth=`${e.clientWidth}px`):(e=this.activeTabIsInDropdown?this.$refs["more-wrapper"]:this.$refs.tab&&this.$refs.tab.length&&this.$refs.tab[this.activeTab],e&&0===this.activeTab?(this.underlineLeft=e.offsetLeft+this.$options.dimensions.appPadding-1+"px",this.underlineWidth=e.clientWidth-(this.$options.dimensions.tabSidePadding+this.$options.dimensions.appPadding)+2+"px"):e&&(this.underlineLeft=e.offsetLeft+this.$options.dimensions.tabSidePadding-1+"px",this.underlineWidth=e.clientWidth-2*this.$options.dimensions.tabSidePadding+(this.activeTabIsInDropdown?1:2)+"px")),t&&setTimeout((()=>{this.blockUnderlineTransition=!1}),50)},newTabForFileLink(t){m.utils.newTabForFileLink(t),this.onLinkClick()},closeDropdown(){this.showMore=!1},updatePositioning(){let t=this.$parent.$el.getBoundingClientRect(),e=Math.round(t.width),s=Math.round(t.left);this.shiftNipple=Math.round(s+e/2-window.innerWidth/2)},isInBottomRow(t){return this.filteredItems.length-(t+1)<this.bottomRowItemCount},bounceTabsToDropdown(){if(this.tabsBounced)return;const t=this.$refs["tab-nav"];if(!t)return;const e=t.clientWidth,s=this.$refs.tab,i=s[s.length-1];this.tabIsOverflowing(i,e)&&(this.showMoreIcon=!0,this.$nextTick((()=>{let t,i=[...this.appData];for(let a=s.length-1;a>=0&&this.tabIsOverflowing(s[a],e);a--)t=a;this.moreTabs=i.splice(t,s.length-t),this.navTabs=i,this.tabsBounced=!0})))},getTabOffsetRight:t=>t.offsetLeft+t.clientWidth,tabIsOverflowing(t,e){return this.getTabOffsetRight(t)>e},getLoadingStateSVG(){let t,e,s=this.$refs["apps-loading"],i=this.$refs["tabs-loading"],a="app-launcher-cached-loading-svg",n=localStorage.getObject(a),r=this.$options.dimensions,o=`${this.launcherWidth}-${r.itemWidth}-${r.itemHeight}-${r.itemMargin}`;n&&n.params===o?(this.appListSvg=n.appsSVG,this.tabListSvg=n.tabsSVG):(t=this.createSVG(s,"apps-clip-path","apps"),e=this.createSVG(i,"tabs-clip-path","tabs"),setTimeout((()=>{localStorage.setObject(a,{params:o,tabsSVG:e.outerHTML,appsSVG:t.outerHTML})}),1e3),this.appListSvg=t.outerHTML,this.tabListSvg=e.outerHTML)},createSVG(t,e,s){function i(t,e,s,i,a){let n=document.createElementNS(a,"rect");return n.setAttribute("width",e),n.setAttribute("height",t),n.setAttribute("rx",3),n.setAttribute("ry",3),n.setAttribute("x",s),n.setAttribute("y",i),n.setAttribute("fill","#000"),n}if(t){let a=t.clientHeight,n=t.clientWidth,r="http://www.w3.org/2000/svg",o=document.createElementNS(r,"svg"),h=document.createElementNS(r,"defs"),l=document.createElementNS(r,"clipPath");if(o.setAttribute("height",a),o.setAttribute("width",n),o.setAttribute("viewbox",`0 0 ${a} ${n}`),l.setAttribute("id",e),o.appendChild(h),h.appendChild(l),"apps"===s){let t=this.$options.dimensions,e=t.itemWidth,s=t.itemHeight,a=t.itemMargin,n=t.appPadding,o=t.rowLength;for(let h=0;h<t.loadingStateItemCount;h++){let t,p;if(h<o)t=n+h*(e+a),p=n;else{t=n+(h-o)*(e+a),p=n+s+a}l.appendChild(i(s,e,t,p,r))}}else if("tabs"===s)for(let e of t.children){let t=e.children[0],s=t.offsetLeft,a=t.offsetTop,n=t.clientHeight,o=t.clientWidth;l.appendChild(i(n,o,s,a,r))}return o}},onSearchEnter(){this.filteredItems.length&&this.filteredItems[0]&&this.filteredItems[0].url&&s(this.filteredItems[0].url)},onGlobalEsc(t){document.activeElement===this.$refs.search?(t.preventDefault(),t.stopPropagation(),this.$refs.search.blur(),this.clearSearch()):this.toggleApp()},onGlobalClick(t){this.$refs["app-launcher"]&&!this.$refs["app-launcher"].contains(t.target)?this.toggleApp():this.$refs["more-wrapper"]&&!this.$refs["more-wrapper"].contains(t.target)&&this.closeDropdown()},onKeyDown(t){37===t.keyCode?"INPUT"==t.target.tagName&&t.target.value||this.onArrowLeft(t):38===t.keyCode?this.onArrowUp(t):39===t.keyCode?"INPUT"==t.target.tagName&&t.target.value||this.onArrowRight(t):40===t.keyCode&&this.onArrowDown(t)},onLinkClick(){this.toggleApp()},afterTabSelectedTransition(){this.focusFirstItem&&(this.$refs.items[0]&&this.$refs.items[0].focus(),this.focusFirstItem=!1)},onArrowLeft(t){let e;if(this.targetIsTab(t.target)){if(t.preventDefault(),e=this.$refs.tab.indexOf(t.target),0===e)return;this.$refs.tab[e-1].focus(),this.switchToTab(e-1)}else if(this.targetIsSearch(t.target))if(this.navOverflow)this.showMore=!0,this.$refs["more-wrapper"]&&this.$refs["more-wrapper"].focus();else{t.preventDefault();let e=this.$refs.tab.length-1;this.$refs.tab[e].focus(),this.switchToTab(e)}else if(this.navOverflow&&this.targetIsMoreIcon(t.target)||this.targetIsInDropdown(t.target)){this.showMore=!1,t.preventDefault();let e=this.$refs.tab.length-1;this.$refs.tab[e].focus(),this.switchToTab(e)}else if(this.targetIsItem(t.target)){if(t.preventDefault(),e=this.$refs.items.indexOf(t.target),0===e||!(e%this.$options.dimensions.rowLength))return;this.$refs.items[e-1].focus()}},onArrowUp(t){if(this.targetIsItem(t.target)){t.preventDefault();let e=this.$refs.items.indexOf(t.target);if(e<this.$options.dimensions.rowLength)this.$refs.search.focus();else{let t=e-this.$options.dimensions.rowLength;this.scrollToElement(this.$refs.items[t]),this.$refs.items[t].focus({preventScroll:!0})}}else if(this.targetIsInDropdown(t.target)){const e=this.$refs["dropdown-tabs"].indexOf(t.target);if(e){const t=this.$refs["dropdown-tabs"][e-1];t&&t.focus()}else this.$refs["more-wrapper"].focus()}},onArrowRight(t){let e;if(this.targetIsTab(t.target))t.preventDefault(),e=this.$refs.tab.indexOf(t.target),e===this.$refs.tab.length-1?this.navOverflow?(this.showMore=!0,this.$refs["more-wrapper"]&&this.$refs["more-wrapper"].focus()):this.$refs.search.focus():(this.$refs.tab[e+1].focus(),this.switchToTab(e+1));else if(this.navOverflow&&this.targetIsMoreIcon(t.target)||this.targetIsInDropdown(t.target))this.showMore=!1,this.$refs.search.focus();else if(this.targetIsItem(t.target)){if(t.preventDefault(),e=this.$refs.items.indexOf(t.target),!((e+1)%this.$options.dimensions.rowLength))return;if(e===this.filteredItems.length-1)return;this.$refs.items[e+1].focus()}},onArrowDown(t){if((this.targetIsTab(t.target)||this.targetIsSearch(t.target))&&this.filteredItems.length)t.preventDefault(),this.scrollToElement(this.$refs.items[0]),this.$refs.items[0].focus({preventScroll:!0});else if(this.targetIsMoreIcon(t.target))this.$refs["dropdown-tabs"][0].focus();else if(this.targetIsInDropdown(t.target)){const e=this.$refs["dropdown-tabs"].indexOf(t.target)+1,s=this.$refs["dropdown-tabs"][e];s&&s.focus()}else if(this.targetIsItem(t.target)){t.preventDefault();const e=this.$refs.items.indexOf(t.target)+this.$options.dimensions.rowLength;if(e>this.$refs.items.length-1)return;this.scrollToElement(this.$refs.items[e]),this.$refs.items[e].focus({preventScroll:!0})}},scrollToElement(t){this.$refs.body.scrollTo({top:t.offsetTop-this.$options.dimensions.appPadding,behavior:"smooth"})},targetIsTab(t){return-1!==this.$refs.tab.indexOf(t)},targetIsSearch(t){return this.$refs.search===t},targetIsItem(t){const e=this.$refs.items;return e&&-1!==e.indexOf(t)},targetIsMoreIcon(t){return this.$refs["more-wrapper"]===t},targetIsInDropdown(t){const e=this.$refs["more-dropdown"];return e&&e.contains(t)},addListeners(){m.on("globalEvent:esc",this.onGlobalEsc),m.on("globalEvent:click",this.onGlobalClick),window.addEventListener("keydown",this.onKeyDown)},removeListeners(){m.off("globalEvent:esc",this.onGlobalEsc),m.off("globalEvent:click",this.onGlobalClick),window.removeEventListener("keydown",this.onKeyDown)},clearSearch(t){this.searchInput="",t&&this.$refs.search.focus()},isUrlLocalFileLink:t=>m.utils.isUrlLocalFileLink(t)}},(function(){var t=this,e=t._self._c;return e("app-popup",{staticClass:"launcher-app",class:{"launcher-loading":t.isLoading,"launcher-empty":t.isEmpty},style:{"--launcher-width":t.launcherWidth+"px","--launcher-item-height":t.$options.dimensions.itemHeight+"px","--launcher-item-width":t.$options.dimensions.itemWidth+"px","--launcher-item-margin":t.$options.dimensions.itemMargin+"px","--launcher-tab-side-padding":t.$options.dimensions.tabSidePadding+"px","--launcher-nipple-x-shift":t.shiftNipple+"px","--launcher-max-rows":2,"--loading-animation-delay":t.$options.loadingAnimationDelay+"ms","--loading-animation-duration":t.$options.loadingAnimationDuration+"ms"},attrs:{tabs:t.$options.tabs,position:"bottom-right",region:"top-left","data-test":"apps-container",width:t.launcherWidth}},[e("header",{staticClass:"header"},[t.isLoading||t.isEmpty?e("nav",{ref:"tabs-loading",staticClass:"tabs-loading"},t._l(t.$options.dimensions.loadingStateTabCount,(function(s){return e("span",{key:s,staticClass:"tab"},[e("span",{staticClass:"tab-text-placeholder"},[t._v("setsHeight"),e("span")]),e("div",{domProps:{innerHTML:t._s(t.tabListSvg)}})])})),0):e("nav",{ref:"tab-nav",class:{"no-shrink":t.tabsBounced},attrs:{"data-test":"categories"}},t._l(t.navTabs.length?t.navTabs:t.appData,(function(s,i){return e("span",{key:i,ref:"tab",refInFor:!0,staticClass:"tab",class:{active:i===t.activeTab},attrs:{tabindex:"0"},on:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.switchToTab(i)},click:function(e){return t.switchToTab(i)}}},[t._v(" "+t._s(s.title)+" ")])})),0),t.showMoreIcon?e("div",{ref:"more-wrapper",staticClass:"more-wrapper",class:{active:t.activeTabIsInDropdown},attrs:{tabindex:"0"},on:{keyup:function(e){if(!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter"))return null;t.showMore=!t.showMore}}},[e("div",{staticClass:"more",on:{click:function(e){t.showMore=!t.showMore}}},[e("inline-svg",{staticClass:"icon icon-ellipsis",attrs:{src:a}})],1),t.showMore?e("div",{staticClass:"dropdown more-dropdown nipple-top-right"},[e("ul",{ref:"more-dropdown",staticClass:"dropdown-list"},t._l(t.moreTabs,(function(s,i){return e("li",{key:i,ref:"dropdown-tabs",refInFor:!0,staticClass:"dropdown-tabs",class:{active:i===t.activeTab-t.navTabs.length},attrs:{tabindex:"0"},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:(e.stopPropagation(),t.switchToTab(i,!0))},click:function(e){return e.stopPropagation(),t.switchToTab(i,!0)}}},[e("span",[t._v(t._s(s.title))])])})),0)]):t._e()]):t._e(),e("span",{ref:"search-wrapper",staticClass:"search-wrapper",class:{active:t.searchFocused}},[e("span",{staticClass:"input-wrapper"},[e("i",{staticClass:"icon-search"}),t.searchInput?e("span",{staticClass:"icon-clear-wrapper",on:{click:function(e){return e.stopPropagation(),t.clearSearch(!0)}}},[e("inline-svg",{staticClass:"icon icon-clear clear",attrs:{src:n}})],1):t._e(),e("input",{directives:[{name:"model",rawName:"v-model",value:t.searchInput,expression:"searchInput"}],ref:"search",staticClass:"search-input apps-search",attrs:{placeholder:"Search","data-test":"search-input"},domProps:{value:t.searchInput},on:{focus:function(e){t.searchFocused=!0},blur:function(e){t.searchFocused=!1},keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:(e.preventDefault(),t.onSearchEnter.apply(null,arguments))},input:function(e){e.target.composing||(t.searchInput=e.target.value)}}})])]),e("span",{staticClass:"underline",class:{"u--no-transition":t.blockUnderlineTransition},style:{left:t.underlineLeft,width:t.underlineWidth}})]),e("section",{ref:"body",staticClass:"body"},[e("transition",{attrs:{name:"fade",mode:"out-in",duration:t.listTransitionDuration},on:{"after-enter":t.afterTabSelectedTransition}},[t.isLoading?e("ul",{key:"empty",ref:"apps-loading",staticClass:"app-list app-list-loading"},[e("div",{domProps:{innerHTML:t._s(t.appListSvg)}})]):e("ul",{key:t.activeTab,ref:"app-list",staticClass:"app-list",class:{"no-matches-found":0===t.filteredItems.length,"active-tab-empty":t.activeTabEmpty},attrs:{"data-test":"apps-list"}},t._l(t.filteredItems,(function(s,i){return e("li",{key:i,staticClass:"item",class:{"bottom-row":t.isInBottomRow(i)}},[e("a",{ref:"items",refInFor:!0,staticClass:"u--pointer",attrs:{title:s.url,tabindex:"0"},on:{click:function(e){return t.newTabForFileLink(s.url)}}},[e("div",{staticClass:"logo"},[e("img",{attrs:{src:s.iconUrl}})]),e("div",{staticClass:"name"},[t._v(t._s(s.title))])])])})),0)])],1),t.isEmpty?e("section",{staticClass:"empty-state"},[e("span",{staticClass:"empty-message"},[t._v("Your team hasn't connected any apps yet.")])]):t._e()])}),[],!1,null,"790a355d").exports;export{o as default};