import{R as t,N as i,u as e,r as s,K as n,n as a}from"./icon-alert--q0yLTMi.js";import{g as p}from"./globalKeyEventManager-Bi-yHy9P.js";const l={name:"AppPopup",doNotWaitForMount:!0,directives:{ResizeSensor:t},provide(){return{appDimensions:this.dimensions}},props:{nippleDisplacement:{type:Number,default:i.nippleDisplacementPx},offset:{type:Number,default:0},width:{type:Number,default:300},position:{type:String,required:!0},detailedPosition:{type:Object,default:null},region:{type:[String,Array],required:!0},fullscreenAnimDuration:{type:Number,default:200},fullscreen:{type:Boolean,default:!1},hideAppsExclusions:{type:String,default:""},focused:{type:Boolean,default:null},svgBackground:{type:Boolean,default:!1},nippleVisible:{type:Boolean,default:!0}},emits:["close"],setup:()=>({halfNippleWidth:i.nippleWidthPx/2,uuid:e.uuidv4()}),data(){return{flipHorizontalPosition:!1,shiftByPx:0,instantTransition:!1,inset:this.getDefaultInset(this.fullscreen),animating:!1,fullscreenClass:this.fullscreen,dimensions:{maxHeight:null,width:null,height:null}}},computed:{windowWidth:()=>s.windowDimensions.width,appStyle(){const t={...this.inset,position:this.positionFixed?"fixed !important":"absolute","transition-duration":this.instantTransition?"0s":this.fullscreenAnimDuration+"ms","--opacity-anim-duration":this.fullscreenAnimDuration/2+"ms"};return this.positionFixed&&Object.assign(t,{width:"auto !important",height:"auto !important","max-height":"100vh",overflow:"hidden"}),t},positionFixed(){return null!==this.inset.left},positionArray(){const t=this.position.split("-");return this.flipHorizontalPosition&&(t[1]=e.getOppositePosition(t[1])),t},nippleClass(){return["nipple"].concat(this.positionArray.map(e.getOppositePosition)).join("-")},positionCss(){const t=e.getOppositePosition(this.positionArray[0]),i=this.detailedPosition||{[t]:this.$mobile?"0":"100%",[e.getOppositePosition(this.positionArray[1])]:"50%"};return Object.entries(i).reduce(((t,[i,s],n)=>(this.detailedPosition?("number"!=typeof s&&console.warn("detailedPosition case with non-number value"),["left","right"].includes(i)&&(s=s-(this.flipHorizontalPosition?this.width-2*this.nippleDisplacement:0)-this.shiftByPx),["top","bottom"].includes(i)&&(s+=this.offset)):(1===n&&(s=`calc(${s} - ${this.nippleDisplacement-this.shiftByPx}px)`),0===n&&(s=`calc(${s} + ${this.offset}px)`,t["--app-"+i]="0px",t["--app-"+e.getOppositePosition(i)]="auto")),t["--"+i]="number"==typeof s?s+"px":s,t)),{"--origin-inset":`var(--${t})`})},shiftedNippleDisplacement(){return this.nippleDisplacement-this.halfNippleWidth-this.shiftByPx},pseudoElementContents(){return this.svgBackground?void 0:'""'},svgBackgroundVisible(){if(!this.svgBackground)return!1;if(!this.animating&&!this.fullscreen&&!this.fullscreenClass)return!0;if(this.animating){if(!this.fullscreenClass&&this.fullscreen)return!0;if(!this.fullscreen&&this.fullscreenClass&&null===this.inset.left)return!0;if(!this.fullscreen&&!this.fullscreenClass&&this.instantTransition)return!0}return!1},svgBackgroundStyles(){if(!this.svgBackgroundVisible)return{};const t=e.getOppositePosition(this.positionArray[0]),s=e.getOppositePosition(this.positionArray[1]);let n,a=0,p=0,l=0,o=0,r=this.dimensions.width,h=this.dimensions.height;switch(t){case"top":n="0deg",o=this.halfNippleWidth,h-=this.halfNippleWidth;break;case"right":n="90deg",a=this.dimensions.width,r-=this.halfNippleWidth;break;case"bottom":n="180deg",p=this.dimensions.height,h-=this.halfNippleWidth;break;case"left":n="270deg",l=this.halfNippleWidth,r-=this.halfNippleWidth}switch(s){case"top":p=this.shiftedNippleDisplacement,"left"===t&&(p+=i.nippleWidthPx);break;case"right":a=this.dimensions.width-this.shiftedNippleDisplacement,"top"===t&&(a-=i.nippleWidthPx);break;case"left":a=this.shiftedNippleDisplacement,"bottom"===t&&(a+=i.nippleWidthPx)}return{app:{[`--app-padding-${t}`]:"calc("+this.halfNippleWidth+"px + var(--app-padding))",clipPath:`url(#clip${this.uuid})`,"-webkit-clip-path":`url(#clip${this.uuid})`,[`padding-${t}`]:`var(--app-padding-${t})`,[t]:`calc(var(--app-${t}) - ${this.halfNippleWidth}px)`,boxShadow:"none"},appSvgStyle:{width:"100%",height:"100%",position:"absolute","pointer-events":"none",inset:"0"},appSvgNipple:{rotate:n,translate:`${a}px ${p}px`},appSvgBackgroundRectangle:{translate:`${l}px ${o}px`,width:r+"px",height:h+"px"},appShadowDiv:{width:r+"px",height:h+"px",position:"absolute",inset:"auto 0",[t]:0,borderRadius:"10px",boxShadow:"1px 1px 5px rgba(0 0 0 / var(--opacity-stop-3))"}}},wrapperHeightDashPadding(){return"top"===this.positionArray[0]?"var(--dash-padding-bottom)":"var(--dash-padding-top)"}},watch:{fullscreen(t){t?this.enterFullscreen():this.exitFullscreen()},async windowWidth(){this.shiftByPx=0,await this.$nextTick(),this.shiftByPx=this.getShiftPx()}},mounted(){var t;this.flipHorizontalPosition=this.shouldFlipHorizontalPosition(),this.$nextTick((()=>this.shiftByPx=this.getShiftPx())),this.hideOverlappingWidgets(),this.updateContentMaxHeight(),this.updateDimensions(),this.fullscreen&&(null==(t=m.widgetManager)||t.hideApps({exemptionSelectors:this.hideAppsExclusions,layer:"appPopup"}))},created(){p.registerEventListener("closeApp","keyup",27,this.close)},destroyed(){var t,i;p.removeEventListener("closeApp","keyup",27),null==(t=m.widgetManager)||t.refocusOverlap(this.region),this.fullscreen&&(null==(i=m.widgetManager)||i.showApps({layer:"appPopup"}))},methods:{updateDimensions({height:t,width:i}={}){if(void 0===t||void 0===i){const e=this.$refs.app;t=e.clientHeight,i=e.clientWidth}this.dimensions.height=t,this.dimensions.width=i},updateContentMaxHeight({height:t}={}){var i;void 0===t&&(t=null==(i=this.$refs["app-wrapper"])?void 0:i.clientHeight),this.dimensions.maxHeight=t},shouldFlipHorizontalPosition(){const t=this.$refs.app&&this.$refs.app.getBoundingClientRect();return!!t&&(t.left<0&&t.right-window.innerWidth>t.left)},getShiftPx(){const t=i.dashboardSidePaddingPx,e=this.$refs.app&&this.$refs.app.getBoundingClientRect();return e?"left"===this.positionArray[1]?e.left<t?e.left-t:Math.max(e.right-(window.innerWidth-t),0):"right"===this.positionArray[1]?e.right>window.innerWidth-t?window.innerWidth-e.right-t:Math.max(-1*(e.left-t),0):0:0},close(){this.$emit("close")},hideOverlappingWidgets(){var t,i,e;let s=(null==(t=this.$refs.view)?void 0:t.scrollHeight)||(null==(i=this.$refs.loading)?void 0:i.scrollHeight);s&&(null==(e=m.widgetManager)||e.unfocusOverlap(this.region,s))},getDefaultInset:t=>t?{left:0,right:0,top:0,bottom:0}:{left:null,right:null,top:null,bottom:null},async enterFullscreen(){var t;null==(t=m.widgetManager)||t.hideApps({exemptionSelectors:this.hideAppsExclusions,layer:"appPopup"}),this.animating=!0,await e.delay(this.fullscreenAnimDuration/2),this.instantTransition=!0,this.fullscreenClass=!0,this.inset=this.getFixedRectInset(),await e.doubleRaf(),this.inset=this.getDefaultInset(!0),this.instantTransition=!1,await e.delay(this.fullscreenAnimDuration),this.animating=!1,await e.delay(this.fullscreenAnimDuration/2)},async exitFullscreen(){var t;null==(t=m.widgetManager)||t.showApps({layer:"appPopup"}),this.animating=!0,await e.delay(this.fullscreenAnimDuration/2),this.instantTransition=!0,this.inset=this.getDefaultInset(!1),await this.$nextTick();const i=this.getFixedRectInset();this.inset=this.getDefaultInset(!0),await e.doubleRaf(),this.instantTransition=!1,this.fullscreenClass=!1,this.inset=i,await e.delay(this.fullscreenAnimDuration),this.instantTransition=!0,this.inset=this.getDefaultInset(!1),await e.doubleRaf(),this.instantTransition=!1,this.animating=!1,await e.delay(this.fullscreenAnimDuration/2)},getFixedRectInset(){const t=this.$refs.app;if(!t)return this.getDefaultInset(!0);let i=t.getBoundingClientRect();const s={top:0,bottom:0},n=e.getOppositePosition(this.positionArray[0]);return!this.fullscreen&&this.svgBackground&&(s[n]=this.halfNippleWidth),{top:i.y+s.top+"px",right:window.innerWidth-i.right+"px",bottom:window.innerHeight-i.bottom+s.bottom+"px",left:i.x+"px"}}}},o=()=>{n(((t,i)=>({dfc3ea8e:t.wrapperHeightDashPadding,"4c98da84":t.pseudoElementContents})))},r=l.setup;l.setup=r?(t,i)=>(o(),r(t,i)):o;const h=a(l,(function(){var t=this,i=t._self._c;return i("div",{directives:[{name:"resize-sensor",rawName:"v-resize-sensor",value:t.updateContentMaxHeight,expression:"updateContentMaxHeight"}],ref:"app-wrapper",staticClass:"app-popup nipple",class:[{animating:t.animating,fullscreen:t.fullscreenClass,focused:t.focused,unfocused:!1===t.focused},t.nippleClass],style:[{"--width":t.width+"px","--content-max-height":null===t.dimensions.maxHeight?"":t.dimensions.maxHeight+"px","--nipple-displacement":t.shiftedNippleDisplacement+"px"},t.positionCss],attrs:{"data-test":"app-popup-wrapper"}},[i("div",{directives:[{name:"resize-sensor",rawName:"v-resize-sensor",value:t.updateDimensions,expression:"updateDimensions"}],ref:"app",staticClass:"app popup",style:[t.appStyle,t.svgBackgroundStyles.app],attrs:{"data-test":"app-popup"}},[t.svgBackgroundVisible?i("svg",{style:t.svgBackgroundStyles.appSvgStyle},[i("clipPath",{attrs:{id:"clip"+t.uuid}},[i("path",{style:t.nippleVisible&&t.svgBackgroundStyles.appSvgNipple,attrs:{d:"M5.58579 1.41421L0 7H14L8.41421 1.41421C7.63316 0.633165 6.36684 0.633164 5.58579 1.41421Z",fill:"black"}}),i("rect",{style:t.svgBackgroundStyles.appSvgBackgroundRectangle,attrs:{x:"0",y:"0",rx:"5",ry:"5"}})])]):t._e(),t._t("default",null,{showFullscreenElements:t.fullscreenClass})],2),t.svgBackgroundStyles.appShadowDiv?i("div",{staticClass:"app-shadow",style:t.svgBackgroundStyles.appShadowDiv}):t._e()])}),[],!1,null,"da475883").exports;export{h as A};