const t={version:"2.16.16",environment:"production",apiUrl:"https://api.momentumdash.com/",platform:"chrome"};async function e({method:t,url:e,data:s,headers:n}){const r=await fetch(e,{method:t,headers:n,body:"Object"===(null==s?void 0:s.constructor.name)?JSON.stringify(s):s}).catch((()=>({statusText:"No response from the server"}))),{status:o,headers:a,statusText:i}=r,c={status:o,headers:(null==a?void 0:a.entries)&&Object.fromEntries(a)||{},statusText:i};if(r.ok){const t=await r.text();return t&&(c.data=JSON.parse(t)),c}{let n="%c Request Error: "+(o||"");return i&&(n+=(o?" : ":"")+i),console.groupCollapsed(n,"color: #ff0505"),console.log("Request:",{method:t,url:e,data:s}),console.log("Response:",r),console.groupEnd(),c}}function s(t){return t>=200&&t<300}const n="store",r="_key",o="_value";function a(t){return"object"==typeof t&&null!==t&&r in t&&o in t}class i{constructor(t,e){this.name="keyValueDb:"+t,this.version=10*e,this.database=null}get db(){return this.database?Promise.resolve(this.database):this.open().then((t=>this.database=t))}open(){return new Promise(((t,e)=>{const s=indexedDB.open(this.name,this.version);s.onerror=()=>e(s.error),s.onupgradeneeded=()=>{s.result.createObjectStore(n,{keyPath:r})},s.onsuccess=()=>{const e=s.result;e.onversionchange=()=>{e.close(),this.database=null},t(e)}}))}async bulkPatch(t){const e={};for(const s in t){const n=t[s];n&&(e[s]=await this.patch(s,n))}return e}async patch(t,e){const s=await this.get(t);if("object"!=typeof s)throw new Error(`KeyValueDb:${this.name} Error: patch called on ${typeof s} value. Patch may only be called on objects or empty rows. Key: ${t}, Existing Value: ${String(s)}`);const n=Object.assign({},s||{},e),a={[r]:t,[o]:n};return await this.transaction("readwrite",(t=>t.put(a))),{newValue:n,previousValue:s}}set(t,e){const s={[r]:t,[o]:e};return this.transaction("readwrite",(t=>t.put(s)))}delete(t){return this.transaction("readwrite",(e=>e.delete(t)))}async get(t){const e=await this.transaction("readonly",(e=>e.get(t)));return e&&a(e)?e[o]:null}async transaction(t,e,s={retries:3}){let o=0;return new Promise(((i,c)=>{const l=async()=>{try{const s=(await this.db).transaction([n],t);s.onerror=()=>c(o.error);const o=e(s.objectStore(n));o.onsuccess=()=>{const t=o.result;if(!function(t){return void 0===t||"string"==typeof t||a(t)}(t))throw new Error(`Transaction result does not match schema (does not contain a property matching ${r})`);i(t)}}catch(u){if(++o>s.retries)return void c(u);(await this.db).close(),this.database=null,l()}};l()}))}}const c=new i("misc",1),l="https://api.momentumdash.com/";let u=null,d=null;async function h(s){return u||(d?await d:(d=e({url:l+"config",headers:{"X-Momentum-Version":t.version}}).then((({data:t})=>{if(!t)throw"Request for config from API failed";return t})).catch((t=>(console.error(t),c.get("config").then((t=>t||{}))))),u=await d,u&&await c.set("config",u))),function(t,e){return e?e.split(".").reduce(((t,e)=>null==t?void 0:t[e]),t):t}(u,s)}const m=t.version,p=t.environment,g="extension",f=new URL(`https://browser-http-intake.logs.datadoghq.com/v1/input/pub18ef9128dd80db1a80dfc3f9180b55b5?ddsource=browser&ddtags=${encodeURIComponent(`env:${p},service:${g},version:${m}`)}`).toString();class b{constructor(t,e=1e-5){this.name=t,this.defaultSampleRate=e,this.sampleRate=null}warn(t,e){return this._log(t,e,"warn")}error(t,e){return this._log(t,e,"error")}info(t,e){return this._log(t,e,"info")}async _log(...t){if(!(await this._isEligibleForSubmission()))return;const[s,n,r]=this._parseArgs(t),o={status:r,date:Date.now(),service:g,message:s,_logger:this.name,...n};this.tabId&&(o.tabId=this.tabId),await e({method:"POST",url:f,data:o})}_convertUndefinedPropertiesToStrings(t){const e={};for(const[s,n]of Object.entries(t))e[s]=void 0===n?"<undefined>":n;return e}_parseArgs(t){let[e,s,n]=t;if(s||"object"!=typeof e||(s=e,e=s.message),s instanceof ErrorEvent&&(s=s.error),s instanceof Error){const{name:t,stack:e}=s;s={name:t,errorMessage:s.message,stack:e}}else"string"==typeof s?(e=`${e}: ${s}`,s={}):"string"==typeof e&&(null==s?void 0:s.message)&&(s.message=`${e}: ${s.message}`);return s&&(s=this._convertUndefinedPropertiesToStrings(s)),[e,s,n]}async _isEligibleForSubmission(){return null===this.sampleRate&&(this.sampleRate=await this._getSampleRate()),Math.random()<=this.sampleRate}async _getSampleRate(){const{datadogLoggingSamplingRate:t}=await h();return t?this.name.split(".").reduce(((e,s,n,r)=>{const o=r.slice(0,n+1).join(".");return o in t?t[o]:e}),this.defaultSampleRate):this.defaultSampleRate}}Storage.prototype.setObject=function(t,e){this.setItem(t,JSON.stringify(e))},Storage.prototype.getObject=function(t){const e=this.getItem(t);return e?JSON.parse(e):void 0};export{i as K,b as L,t as e,h as g,s as i,c as m,e as r};