import"./VueBase-W7f1OYgs.js";import{X as o,A as t,n as e,V as s}from"./icon-alert--q0yLTMi.js";import{B as a}from"./BaseDropdown-DBvV1Fy2.js";import{B as i}from"./BaseDropdownOption-umPWLVqy.js";import{B as n}from"./BaseDropdownDivider-z6WJAu5K.js";import{_ as r}from"./icon-heart-v5O7C6eS.js";import{_ as d}from"./icon-skip-intro-BUi8b3Ak.js";import{_ as c}from"./icon-photo-BrwqV1T0.js";import{_ as u}from"./icon-cog-BFr_Pva7.js";import"./index-DQvfDEB6.js";import"./preload-helper-DmNsytk6.js";import"./localStorage-4iHdj-SC.js";import"./migrateLegacyUserMessageHandler-DMvEmYM4.js";import"./main-FH8FpKq2.js";import"./index-CJJH83pl.js";import"./portal-vue.esm-SV1wohGy.js";import"./string-GDe0WbEj.js";import"./BaseDropdownContent-BSCj37As.js";import"./constants-CALDQiUE.js";import"./index-D7SyL4qE.js";import"./icon-ellipsis-D3jS4u3x.js";function p(){const o=m.models.backgroundManager.getActiveItem();return o?{id:o.get("_id")||o.get("id"),title:o.get("title"),source:o.get("source"),fav:o.get("is_favorite"),url:o.get("sourceUrl"),unsplash:o.get("sourceUrl")&&o.get("sourceUrl").includes("unsplash"),destination:o.get("destination_name"),custom:!!o.get("isCustom")}:{}}const l=new t({feature:"photos"});const g=e({name:"BackgroundInfo",components:{BaseDropdownDivider:n,BaseDropdownOption:i,BaseDropdown:a},setup:()=>({admireTimeoutId:null,debounedHover:null}),data:()=>({dropdownActive:!1,background:p(),skipping:!1,admiring:!1}),created(){m.models.activeBackground.on("background:successfullyLoaded",this.setActiveBackground),m.on("photoDetailsChanged",this.updatePhotoDetails),m.on("backgroundInfo:admire:start",this.admire),m.on("backgroundInfo:admire:stop",this.stopAdmire),m.on("globalEvent:windowBlur",this.stopAdmire)},mounted(){m.widgetManager.appReady("background-info")},destroyed(){m.models.activeBackground.off("background:successfullyLoaded",this.setActiveBackground),m.off("photoDetailsChanged",this.updatePhotoDetails),m.off("backgroundInfo:admire:start",this.admire),m.off("backgroundInfo:admire:stop",this.stopAdmire),m.off("globalEvent:windowBlur",this.stopAdmire)},methods:{setActiveBackground(){this.background=p()},updatePhotoDetails(o){o.id&&o.id===this.background.id&&(o.title&&""!==o.title&&(this.background.title=o.title),o.source&&""!==o.source&&(this.background.source=o.source))},toggleFavorite(){this.background.fav=!this.background.fav,m.models.backgroundManager.toggleFavorite(this.background.fav),l.capture("photo "+(this.background.fav?"fav":"unfav"),{custom:this.background.custom})},skipBackground(){var o;if(!this.$plus)return null==(o=this.$refs.settingsDropdown)||o.closeDropdown(),m.cmd("modal.open","UPSELL_PHOTOS",{eventSource:"dash"}),void this.stopAdmire();this.skipping||(this.skipping=!0,m.models.backgroundManager.skipItem().finally((()=>{this.skipping=!1})),l.capture("photo skip",{is_paid_event:!0,custom:this.background.custom}))},clickSource(){this.background.url&&(this.captureAndHandleCustomLocation("photo source click"),o(this.background.url))},admire(){if(document.getElementsByClassName("apps")[0].classList.contains("hide-apps"))return;this.admiring=!0,m.widgetManager.hideApps({exemptionSelectors:".apps .photo-info"});const o=document.getElementsByClassName("background-overlay")[0];o.classList.add("slow"),o.classList.remove("show"),l.capture("photo admire",{custom:this.background.custom})},admireOnHover(o){this.$touch||document.getElementsByClassName("apps")[0].classList.contains("hide-apps")||(this.clearAdmireTimeout(),this.captureDebouncedHover(o),this.admireTimeoutId=setTimeout(this.admire,4e3))},captureDebouncedHover(o){const t=o.target;this.cancelDebouncedHoverCapture(),this.debounedHover=setTimeout((()=>{t.matches(":hover")&&this.captureAndHandleCustomLocation("photo hover")}),1e3)},cancelDebouncedHoverCapture(){clearTimeout(this.debounedHover)},stopAdmire(){if(this.clearAdmireTimeout(),this.cancelDebouncedHoverCapture(),!this.admiring)return;this.admiring=!1,m.widgetManager.showApps();const o=document.getElementsByClassName("background-overlay")[0];o.classList.remove("slow"),o.classList.add("show")},clearAdmireTimeout(){clearTimeout(this.admireTimeoutId)},onEnter(){m.widgetManager.setBottomSideWidth()},openDropdown(){var o;null==(o=this.$refs.settingsDropdown)||o.openDropdown()},onDropdownToggle(o){this.dropdownActive=o},openSettings(){var o;null==(o=this.$refs.settingsDropdown)||o.closeDropdown(),m.commandManager.executeAsync("settings.display",null,{section:"background-settings"})},access:m.utils.access,captureAndHandleCustomLocation(o){const t={custom:this.background.custom,photo_location:this.background.custom?"custom":this.background.title.toLowerCase(),location:"dash"};l.capture(o,t)}}},(function(){var o=this,t=o._self._c;return t("div",{staticClass:"app-container photo-info",on:{mouseenter:o.admireOnHover,mouseleave:o.stopAdmire}},[t("transition",{attrs:{name:"fade",mode:"out-in"},on:{enter:o.onEnter}},[t("div",{directives:[{name:"mobile-click",rawName:"v-mobile-click",value:o.openDropdown,expression:"openDropdown"}],key:o.background.id,staticClass:"app-dash",class:{"show-hover":o.background.unsplash||o.admiring||o.dropdownActive,"add-shadow":o.admiring,"show-anyway":o.admiring,"hotkey-hover":o.admiring},on:{dblclick:o.openDropdown}},[t("div",{staticClass:"title"},[o._v(o._s(o.background.title||"Untitled"))]),t("div",{staticClass:"source"},[t("span",{staticClass:"source-link u--mobile-hide",attrs:{"data-url":o.background.url},on:{click:o.clickSource}},[o._v(o._s(o.background.source||"No source"))]),t("span",{on:{mouseenter:o.stopAdmire}},[t("base-dropdown",{ref:"settingsDropdown",attrs:{"container-class":"app","data-test":"settings-dropdown","mobile-toggle-hidden":!0},on:{toggle:o.onDropdownToggle},scopedSlots:o._u([{key:"toastHeader",fn:function(){return[t("div",{staticClass:"toast-title"},[o._v(o._s(o.background.title||"Untitled"))]),t("div",{staticClass:"toast-source",attrs:{"data-test":"source","data-url":o.background.url},on:{click:o.clickSource}},[o._v(" "+o._s(o.background.source||"No source")+" ")])]},proxy:!0}])},[t("base-dropdown-option",{attrs:{"data-test":"favorite"},on:{click:o.toggleFavorite}},[t("span",{staticClass:"favorite",class:{active:o.background.fav},attrs:{"data-test":"favorite-icon"}},[t("inline-svg",{staticClass:"icon icon-heart",attrs:{src:r}})],1),o._v(" "+o._s(o.background.fav?"Unfavorite":"Favorite")+" ")]),t("base-dropdown-option",{attrs:{"data-test":"skip"},on:{click:o.skipBackground}},[t("inline-svg",{staticClass:"icon",attrs:{src:d}}),o._v(" Skip to new photo "),o.$plus?o._e():t("span",{staticClass:"badge badge-plus"},[o._v("PLUS")])],1),t("base-dropdown-divider"),t("base-dropdown-option",{attrs:{"data-test":"manage"},on:{click:o.openSettings}},[t("inline-svg",{staticClass:"icon",attrs:{src:c}}),o._v(" Manage photos ")],1),t("base-dropdown-divider"),t("base-dropdown-option",{attrs:{"data-test":"settings"},on:{click:o.openSettings}},[t("inline-svg",{staticClass:"icon",attrs:{src:u}}),o._v(" Settings ")],1)],1)],1)])])])],1)}),[],!1,null,"c2949e9c").exports,h=document.querySelector(".region.bottom-left"),v=document.createElement("div");h.appendChild(v),new s({render:o=>o(g)}).$mount(v);