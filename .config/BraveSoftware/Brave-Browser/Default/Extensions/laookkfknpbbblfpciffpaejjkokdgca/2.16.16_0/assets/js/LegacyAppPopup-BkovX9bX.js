import{g as i}from"./globalKeyEventManager-Bi-yHy9P.js";import{n as t}from"./icon-alert--q0yLTMi.js";import"./localStorage-4iHdj-SC.js";import"./preload-helper-DmNsytk6.js";import"./string-GDe0WbEj.js";const e=t({name:"AppPopup",doNotWaitForMount:!0,unreactive:()=>({halfNippleWidth:m.constants.nippleWidthPx/2}),props:{nippleDisplacement:{type:Number,default:m.constants.nippleDisplacementPx},width:{type:Number,default:300},viewManager:{type:Object,default:null},position:{type:String,required:!0},detailedPosition:{type:Object,default:null},region:{type:[String,Array],required:!0},focused:{type:Boolean,default:!1}},data:()=>({flipHorizontalPosition:!1,shiftByPx:0}),computed:{positionArray(){const i=this.position.split("-");return this.flipHorizontalPosition&&(i[1]=m.utils.getOppositePosition(i[1])),i},nippleClass(){return["nipple"].concat(this.positionArray.map(m.utils.getOppositePosition)).join("-")},positionCss(){const i=this.detailedPosition||{[m.utils.getOppositePosition(this.positionArray[0])]:"100%",[m.utils.getOppositePosition(this.positionArray[1])]:"50%"};return Object.entries(i).reduce(((i,[t,e])=>(["left","right"].includes(t)&&("number"==typeof e?e=e-(this.flipHorizontalPosition?this.width-2*this.nippleDisplacement:0)-this.shiftByPx:"string"==typeof e&&(e=`calc(${e} - ${this.nippleDisplacement-this.shiftByPx}px)`)),i["--"+t]="number"==typeof e?e+"px":e,i)),{})},shiftedNippleDisplacement(){return this.nippleDisplacement-this.halfNippleWidth-this.shiftByPx}},mounted(){this.flipHorizontalPosition=this.shouldFlipHorizontalPosition(),this.$nextTick((()=>this.shiftByPx=this.getShiftPx())),this.hideOverlappingWidgets()},created(){i.registerEventListener("closeApp","keyup",27,this.close),window.addEventListener("resize",this.onWindowResize)},destroyed(){i.removeEventListener("closeApp","keyup",27),window.removeEventListener("resize",this.onWindowResize),m.widgetManager.refocusOverlap(this.region)},methods:{onClickOutside(i){this.viewManager?this.viewManager.awaitCloseConfirmationIfNeeded().then((()=>this.$emit("clickOutside",i))):this.$emit("close")},onWindowResize(){this.disableSmoothReflow=!0,clearTimeout(this.debouceResize),this.debouceResize=setTimeout((()=>{this.disableSmoothReflow=!1}),500)},shouldFlipHorizontalPosition(){const i=this.$refs.app&&this.$refs.app.getBoundingClientRect();return!!i&&i.left<0},getShiftPx(){const i=this.$refs.app&&this.$refs.app.getBoundingClientRect();return i?"left"===this.positionArray[1]?Math.max(i.right-(window.innerWidth-m.constants.dashboardSidePaddingPx),0):Math.max(-1*(i.left-m.constants.dashboardSidePaddingPx),0):0},close(){this.$emit("close")},hideOverlappingWidgets(){var i,t;let e=(null==(i=this.$refs.view)?void 0:i.scrollHeight)||(null==(t=this.$refs.loading)?void 0:t.scrollHeight);e&&m.widgetManager.unfocusOverlap(this.region,e)}}},(function(){var i=this;return(0,i._self._c)("div",{directives:[{name:"click-outside",rawName:"v-click-outside",value:i.onClickOutside,expression:"onClickOutside"}],ref:"app",staticClass:"app popup nipple",class:[{focused:i.focused},"display-"+i.positionArray[0],"display-"+i.positionArray[1],i.nippleClass],style:[{"--width":i.width+"px","--nipple-displacement":i.shiftedNippleDisplacement+"px"},i.positionCss],attrs:{"data-test":"app-popup"}},[i._t("default")],2)}),[],!1,null,"8ea9d606").exports;export{e as default};