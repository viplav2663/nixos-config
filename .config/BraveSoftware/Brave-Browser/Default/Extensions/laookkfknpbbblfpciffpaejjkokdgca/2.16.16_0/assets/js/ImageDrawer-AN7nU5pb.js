import{r as e}from"./index-CKsl0Wzi.js";import{drawGif as i}from"./Utils-DZTJGEEY.js";import{e as a}from"./FlashMessage-DPJrdJ6u.js";import"./preload-helper-DmNsytk6.js";import"./icon-alert--q0yLTMi.js";import"./localStorage-4iHdj-SC.js";import"./string-GDe0WbEj.js";import"./globalKeyEventManager-Bi-yHy9P.js";import"./icon-close-BUGl_M7j.js";class t{constructor(e){this.loadImageShape=async e=>{if(!this._engine.loadImage)throw new Error(`${a} image shape not initialized`);await this._engine.loadImage({gif:e.gif,name:e.name,replaceColor:e.replaceColor??!1,src:e.src})},this._engine=e}addImage(e){this._engine.images||(this._engine.images=[]),this._engine.images.push(e)}draw(e){const{context:a,radius:t,particle:s,opacity:o}=e,n=s.image,r=null==n?void 0:n.element;if(n){if(a.globalAlpha=o,n.gif&&n.gifData)i(e);else if(r){const e=n.ratio,i={x:-t,y:-t},s=2*t;a.drawImage(r,i.x,i.y,s,s/e)}a.globalAlpha=1}}getSidesCount(){return 12}async init(e){const i=e.actualOptions;if(i.preload&&this._engine.loadImage)for(const a of i.preload)await this._engine.loadImage(a)}loadShape(e){if("image"!==e.shape&&"images"!==e.shape)return;this._engine.images||(this._engine.images=[]);const i=e.shapeData;if(!i)return;this._engine.images.find((e=>e.name===i.name||e.source===i.src))||this.loadImageShape(i).then((()=>{this.loadShape(e)}))}particleInit(i,a){if("image"!==a.shape&&"images"!==a.shape)return;this._engine.images||(this._engine.images=[]);const t=this._engine.images,s=a.shapeData;if(!s)return;const o=a.getFillColor(),n=t.find((e=>e.name===s.name||e.source===s.src));if(!n)return;const r=s.replaceColor??n.replaceColor;n.loading?setTimeout((()=>{this.particleInit(i,a)})):(async()=>{let i;i=n.svgData&&o?await e(n,s,o,a):{color:o,data:n,element:n.element,gif:n.gif,gifData:n.gifData,gifLoopCount:n.gifLoopCount,loaded:!0,ratio:s.width&&s.height?s.width/s.height:n.ratio??1,replaceColor:r,source:s.src},i.ratio||(i.ratio=1);const t={image:i,fill:s.fill??a.shapeFill,close:s.close??a.shapeClose};a.image=t.image,a.shapeFill=t.fill,a.shapeClose=t.close})()}}export{t as ImageDrawer};