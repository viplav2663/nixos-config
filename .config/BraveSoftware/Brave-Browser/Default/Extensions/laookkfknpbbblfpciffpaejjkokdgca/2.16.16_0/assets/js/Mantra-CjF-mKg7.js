const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/ToastMenuLegacy-FWR1i4hA.js","assets/js/icon-alert--q0yLTMi.js","assets/js/localStorage-4iHdj-SC.js","assets/js/preload-helper-DmNsytk6.js","assets/js/string-GDe0WbEj.js","assets/css/ToastMenuLegacy-DzMwE8K6.css","assets/js/Dropdown-OXqSLuGU.js","assets/js/icon-ellipsis-D3jS4u3x.js","assets/css/Dropdown-BcLAxJWG.css","assets/js/DropdownOption-Doji5Bwd.js"])))=>i.map(i=>d[i]);
import{_ as t}from"./preload-helper-DmNsytk6.js";import{M as n}from"./Message-CoS2-mx6.js";import{V as i,n as a,A as e}from"./icon-alert--q0yLTMi.js";import{V as s}from"./VueBase-W7f1OYgs.js";import{a as o}from"./allComponentsMounted-C3UsG_cA.js";import{a as r}from"./reactiveCustomization-DqGARD3C.js";import{T as p}from"./index-DQvfDEB6.js";import{s as c}from"./showAnyway-d_ZUKj8O.js";import{_ as d}from"./icon-heart-v5O7C6eS.js";import{_ as l}from"./icon-pin-BHeOuzvO.js";import{_ as u,a as g}from"./icon-skip-BOkC5L0N.js";import"./MobileBlur-B2s9dLKD.js";import"./localStorage-4iHdj-SC.js";import"./string-GDe0WbEj.js";import"./index-CJJH83pl.js";import"./portal-vue.esm-SV1wohGy.js";import"./migrateLegacyUserMessageHandler-DMvEmYM4.js";import"./main-FH8FpKq2.js";i.use(s);const h=new(i.extend({name:"MantraManager",manager:m.models.mantraManager,bb:()=>({mantras:m.collect.mantras,mantraSettings:m.models.mantraSettings}),computed:{pinned(){return this.mantraSettings?this.mantraSettings.pinnedMantra:null},active(){let t;if(this.pinned)return t=this.mantras.findWhere({forDate:"pinned"}),t&&t.get("_id")===this.pinned.id?t:null;if(this.mantras&&this.isEnabled()){if(t=this.mantras.getActiveItem(),!t)return m.trigger("sync:download","mantra"),null;if(t.get("hardSkip"))return null}return t}},watch:{active(t){!t&&this.pinned&&this.mantras.create({forDate:"pinned",_id:this.pinned.id,body:this.pinned.body,is_custom:this.pinned.isCustom,is_favorite:this.pinned.isFavorite})}},methods:{isEnabled:function(){return this.$options.manager.isEnabled()},pinMantra:function(t,n){this.$options.manager.pinMantra(t,n)},toggleFav:function(t){this.$options.manager.toggleFav(t)},skipItem:function(t){return this.$options.manager.skipItem(t)},getMantraForDisplay:function(t,n){return this.$options.manager.getMantraForDisplay(t,n)},markGreetingAsSeenToday:function(){this.$options.manager.markGreetingAsSeenToday()}}})),v=new e({feature:"mantra"});const f=a({name:"Mantra",components:{ThreeColLayout:p,Message:n,ToastMenu:()=>t((()=>import("./ToastMenuLegacy-FWR1i4hA.js")),__vite__mapDeps([0,1,2,3,4,5])),Dropdown:()=>t((()=>import("./Dropdown-OXqSLuGU.js")),__vite__mapDeps([6,7,1,2,3,4,8])),DropdownOption:()=>t((()=>import("./DropdownOption-Doji5Bwd.js")),__vite__mapDeps([9,1,2,3,4]))},mixins:[o],props:{mantraOverride:{type:String,default:""}},unreactive:()=>({showAnyway:c}),data:()=>({dropdownActive:!1,editingName:!1,skipping:!1,useLastShowName:!1}),computed:{isFavorite(){return this.mantra&&this.mantra.activeMantra&&this.mantra.activeMantra.get("is_favorite")},isPinned(){return this.mantra&&this.mantra.activeMantra&&this.mantra.activeMantra.isPinned()},isCustom(){return this.mantra&&this.mantra.activeMantra&&this.mantra.activeMantra.get("is_custom")},mantra(){if(this.mantraOverride)return{activeMantra:"",content:this.mantraOverride,name:"",punctuation:""};const t=h.active,n=h.getMantraForDisplay(t,this.useLastShowName);return n?{activeMantra:t,content:n.start,name:n.name,punctuation:n.end||"."}:{activeMantra:"",content:" ",name:"",punctuation:""}},skipOrSkipping(){return this.skipping?"Skipping…":"Skip mantra"},pinOrUnpin(){return this.isPinned?"Unpin":"Pin"}},watch:{mantra(){this.useLastShowName=!0}},mounted(){m.trigger("mantra:mounted")},methods:{toggleDropdown(t=!this.dropdownActive){this.$emit("stop-cycle",t),m.trigger("mantra:dropdown:visible",t),this.dropdownActive=t},openMantraSettings(){this.editingName||(m.commandManager.executeAsync("settings.display",null,{section:"mantra-settings"}),this.dropdownActive=!1)},toggleFavorite(){h.toggleFav(this.mantra.activeMantra),v.capture("mantra "+(this.isFavorite?"fav":"unfav"),{location:"dash",custom:this.isCustom})},togglePin(){if(!this.$plus)return void m.cmd("modal.open","UPSELL_MANTRAS",{eventSource:"dash"});v.capture("mantra "+(this.isPinned?"unpin":"pin"),{location:"dash",custom:this.isCustom,is_paid_event:!0});const t=this.mantra.name===r.displayname;h.pinMantra(this.mantra.activeMantra,t)},skip(){if(this.$plus){if(!this.mantra.activeMantra)return m.trigger("sync:download","mantra"),void this.$emit("show-greeting");v.capture("mantra skip",{custom:this.isCustom,is_paid_event:!0}),this.skipping=!0,h.skipItem().finally((()=>{this.dropdownActive=!1,this.skipping=!1}))}else m.cmd("modal.open","UPSELL_MANTRAS",{eventSource:"dash"})},dontShowAgain(){h.skipItem(!0).finally((()=>{this.dropdownActive=!1,this.$plus||this.$emit("show-greeting")})),v.capture("mantra don't show again")},editing(t){this.$emit("stop-cycle",t),this.editingName=t},onEditNameClick(){this.editingName=!0,this.dropdownActive=!1,e.capture("display name change",{feature:"profile"})}}},(function(){var t=this,n=t._self._c;return n("three-col-layout",{directives:[{name:"mobile-click",rawName:"v-mobile-click",value:t.toggleDropdown.bind(null,!0),expression:"toggleDropdown.bind(null, true)"}],staticClass:"app-container has-dash-icon greeting",class:{"show-anyway":t.showAnyway.includes("greeting")},attrs:{"data-show-anyway":"greeting","data-test":"mantra"},scopedSlots:t._u([{key:"center",fn:function(){return[n("message",{attrs:{message:t.mantra,"editing-name":t.editingName},on:{editing:t.editing,toggle:t.toggleDropdown}})]},proxy:!0},{key:"right",fn:function(){return[n(t.$touch?"ToastMenu":"Dropdown",{tag:"component",attrs:{"on-dash":!0,active:t.dropdownActive,"section-title":"Mantra Actions"},on:{toggle:t.toggleDropdown}},[n("dropdown-option",{class:{active:t.isFavorite},attrs:{name:t.isFavorite?"Unfavorite":"Favorite","data-test":"favorite"},nativeOn:{click:function(n){return t.toggleFavorite.apply(null,arguments)}},scopedSlots:t._u([{key:"icon",fn:function(){return[n("inline-svg",{staticClass:"icon icon-heart",attrs:{src:d}})]},proxy:!0}])}),n("dropdown-option",{class:{active:t.isPinned},attrs:{name:t.pinOrUnpin,"is-plus":!0,"data-test":"pin"},nativeOn:{click:function(n){return t.togglePin.apply(null,arguments)}},scopedSlots:t._u([{key:"icon",fn:function(){return[n("inline-svg",{staticClass:"icon dropdown-list-icon icon-pin",attrs:{src:l}})]},proxy:!0}])}),n("dropdown-option",{class:{active:t.skipping},attrs:{name:t.skipOrSkipping,"is-plus":!0,"data-test":"skip"},nativeOn:{click:function(n){return t.skip.apply(null,arguments)}},scopedSlots:t._u([{key:"icon",fn:function(){return[n("inline-svg",{staticClass:"icon dropdown-list-icon icon-skip",attrs:{src:u}})]},proxy:!0}])}),t.isCustom?t._e():n("dropdown-option",{attrs:{name:"Don't show again","data-test":"dont-show-again"},nativeOn:{click:function(n){return t.dontShowAgain.apply(null,arguments)}},scopedSlots:t._u([{key:"icon",fn:function(){return[n("inline-svg",{staticClass:"icon dropdown-list-icon icon-remove",attrs:{src:g}})]},proxy:!0}],null,!1,2335645709)}),n("li",{staticClass:"line"}),n("dropdown-option",{attrs:{name:"Mantra settings","data-test":"mantra-settings"},nativeOn:{click:function(n){return n.stopPropagation(),t.openMantraSettings.apply(null,arguments)}}}),t.mantra.name?n("dropdown-option",{attrs:{name:"Edit your name","data-test":"edit-name"},nativeOn:{click:function(n){return n.stopPropagation(),t.onEditNameClick.apply(null,arguments)}}}):t._e()],1)]},proxy:!0}])})}),[],!1,null,null).exports;export{f as default};