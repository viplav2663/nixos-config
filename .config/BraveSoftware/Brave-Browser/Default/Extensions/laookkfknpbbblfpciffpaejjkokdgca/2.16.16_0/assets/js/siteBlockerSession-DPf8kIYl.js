import{d as e,j as t,p as s,k as i,l as r,m as o}from"./icon-alert--q0yLTMi.js";import{d as a,e as n,F as c}from"./index-DQvfDEB6.js";import{u as l,a as p}from"./siteBlockerGroups-E8GFJ9Dm.js";import{S as d,a as u,b as g}from"./constants-BT5o8PmI.js";import{useFocusModeDashViewStateStore as h}from"./focusModeViewState-BpbRF0A0.js";import{u as j}from"./pomodoroCompleted-DWEcdQPX.js";import{g as S}from"./focusModeHelpers-CiIJnkuY.js";import{c as b}from"./reactiveCustomization-DqGARD3C.js";import"./localStorage-4iHdj-SC.js";import"./preload-helper-DmNsytk6.js";import"./string-GDe0WbEj.js";import"./migrateLegacyUserMessageHandler-DMvEmYM4.js";import"./main-FH8FpKq2.js";import"./compareObjects-BF7sSNEf.js";import"./ViewState-_YxhE_TX.js";import"./VueBase-W7f1OYgs.js";import"./index-CJJH83pl.js";import"./portal-vue.esm-SV1wohGy.js";import"./scenes-D8jpYIdj.js";import"./ocean-bubbles-GcKjBI5B.js";import"./PomodoroTimers-BWkB-14p.js";import"./loginHelpers-BZASe8UD.js";import"./authService-CGVTYYkM.js";import"./customization-fX3KDebH.js";const f=new a(d,!1),v=new a(u,""),w=e("siteBlockerSession",{state:()=>({active:f.currentValue,hasPermissions:!1}),getters:{urls:()=>[...l().items.reduce(((e,t)=>t.enabled?(p().getWebsitesByGroup(t).filter((e=>e.enabled)).forEach((t=>e.add(t.hostWithWildcard))),e):e),new Set([]))].join(" "),settingsEnabled:()=>b.siteBlockerVisible,focusModeEnabledAndFocusModeSettingActive:()=>n.currentValue&&S().apps.siteBlocker.enabled&&h().activeViewId===c.Focusing.toString(),featureEnabled:()=>m.conditionalFeatures.featureEnabled("site-blocker")||n.currentValue,activeAndBlockingUrls:e=>e.active&&e.hasPermissions&&0!==l().items.length},actions:{toggleActive(e){const t=e??!this.active;t&&this.checkSiteBlockerFeatureDisabledAndOpenUpsell()||(t&&this.registerOrUpdateContentScript(),this.active=t)},async ensurePermissions(e=!1){return this.hasPermissions?await this.registerOrUpdateContentScript():new Promise((t=>{m.cmd("modal.open","PERMISSION_REQUEST",{source:"Site Blocker",reason:"To block sites while focusing",permissions:g,requestImmediately:e,resolve:async e=>{if(!e)return t(!1);this.hasPermissions=!0,await this.registerOrUpdateContentScript(),t(!0)},extraInstructions:o()?' Please select "Always allow on every website..."':"",watchPermissionCheck:!0})}))},async registerOrUpdateContentScript(){if(!t().scripting)return;const e=await t().scripting.getRegisteredContentScripts();return await new Promise((s=>{t().scripting[e.length?"updateContentScripts":"registerContentScripts"]([{id:"site-blocker",js:["/content-scripts/siteBlocker.js"],matches:["*://*/*"],runAt:"document_start"}],(()=>s(!0)))}))},checkSiteBlockerFeatureDisabledAndOpenUpsell(){return!this.featureEnabled&&(m.cmd("modal.open","UPSELL_SITE_BLOCKER",{eventSource:"site-blocker"}),!0)}}});(async()=>{const e=w(),o=l(),a=p(),c=j();f.switchOverToWatchedStoreItem((()=>e.active)),t().permissions&&s.permissions.contains(g).then((t=>e.hasPermissions=t)),await i((()=>c.loaded)).toBe(!0),r([()=>n.currentValue,()=>e.focusModeEnabledAndFocusModeSettingActive,()=>c.anyFocusTimerActive,()=>c.playing,()=>e.featureEnabled,()=>e.settingsEnabled],(([t,s,i,r,o,a])=>{o&&a||e.toggleActive(!1),t&&(s&&i&&r?e.toggleActive(!0):e.toggleActive(!1))})),await i((()=>o.loaded)).toBe(!0),await i((()=>a.loaded)).toBe(!0),v.switchOverToWatchedStoreItem((()=>e.urls))})();export{w as default};