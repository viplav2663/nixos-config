import{S as e}from"./SoftFocus-BUhesXB-.js";import{S as t}from"./SmoothReflow-Du5fECCq.js";import{n as s,a2 as n}from"./icon-alert--q0yLTMi.js";import"./allComponentsMounted-C3UsG_cA.js";import"./localStorage-4iHdj-SC.js";import"./preload-helper-DmNsytk6.js";import"./string-GDe0WbEj.js";const l=s({name:"LocationTypeahead",components:{Typeahead:s({name:"Typeahead",components:{SmoothReflow:t},directives:{softFocus:e},props:{value:{type:String,default:""},type:{type:String,default:""},results:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},placeholder:{type:String,required:!0},noResults:{type:Boolean,default:!1}},data:()=>({selected:0}),computed:{resultsVisible(){return this.results.length||this.loading||this.noResults}},methods:{onEnter(){this.results.length&&this.$emit("select",this.results[this.selected])},onArrowUp(){this.selected=Math.max(this.selected-1,0)},onArrowDown(){this.selected=Math.min(this.selected+1,this.results.length-1)}}},(function(){var e=this,t=e._self._c;return t("div",{staticClass:"typeahead",class:{searching:e.resultsVisible}},[t("div",{staticClass:"input-wrapper"},[t("input",{directives:[{name:"soft-focus",rawName:"v-soft-focus"}],staticClass:"input",attrs:{type:"text",placeholder:e.placeholder,spellcheck:"false",autocomplete:"off","data-test":e.type+"-input"},domProps:{value:e.value},on:{keydown:[function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"down",40,t.key,["Down","ArrowDown"])?null:(t.preventDefault(),e.onArrowDown.apply(null,arguments))},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"up",38,t.key,["Up","ArrowUp"])?null:(t.preventDefault(),e.onArrowUp.apply(null,arguments))},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.onEnter.apply(null,arguments)}],keyup:[function(t){if(!t.type.indexOf("key")&&e._k(t.keyCode,"down",40,t.key,["Down","ArrowDown"]))return null;t.preventDefault()},function(t){if(!t.type.indexOf("key")&&e._k(t.keyCode,"up",38,t.key,["Up","ArrowUp"]))return null;t.preventDefault()}],input:function(t){return e.$emit("input",t.target.value)},focus:function(e){return e.target.select()}}}),e._t("default")],2),e.resultsVisible?t("smooth-reflow",{staticClass:"dropdown-list",attrs:{nested:!0,"hide-overflow":!0}},[t("ul",{attrs:{"data-test":"typeahead-dropdown"}},[t("li",{directives:[{name:"show",rawName:"v-show",value:e.loading,expression:"loading"}],staticClass:"searching"},[e._v("Searching...")]),e._l(e.results,(function(s,n){return t("li",{key:n,staticClass:"result",class:{selected:e.selected===n},attrs:{"data-test":e.type+"-result"},on:{click:function(t){return e.$emit("select",s)},mouseover:function(t){e.selected=n}}},[t("span",{staticClass:"name"},[e._v(e._s(s.name))])])})),t("li",{directives:[{name:"show",rawName:"v-show",value:e.noResults,expression:"noResults"}],staticClass:"no-results",attrs:{"data-test":"not-found"}},[e._v("No "+e._s(e.type)+"s found.")])],2)]):e._e()],1)}),[],!1,null,"c98ec9c2").exports},props:{value:{type:Object,default:()=>({})},type:{type:String,default:"location"},beforeFetchResults:{type:Function,default:null}},data:()=>({results:[],inputValue:"",loading:!1,noResults:!1}),created(){this.value.name&&(this.inputValue=this.value.name)},methods:{clear(){this.inputValue=this.value.name,this.noResults=!1,this.results=[]},async fetchResults(e){var t;if(this.inputValue=e,e.length>2){this.noResults=!1;const l=null==(t=this.beforeFetchResults)?void 0:t.call(this,e);if(l)this.results=l;else{this.loading=!0,this.cancelTokenSource&&this.cancelTokenSource.cancel(),this.cancelTokenSource=n.CancelToken.source();try{const{data:t}=await this.$xhr.get("/locations:search?input="+e,{cancelToken:this.cancelTokenSource.token});this.loading=!1,this.results=t,this.results.length||(this.noResults=!0)}catch(s){if(n.isCancel(s))return;console.error(s),this.loading=!1}}}else this.cancelTokenSource&&this.cancelTokenSource.cancel(),this.results=[],this.noResults=!1,this.loading=!1},onSelect(e){this.results=[],this.noResults=!1,this.$emit("input",e),this.inputValue=e.name}}},(function(){var e=this;return(0,e._self._c)("typeahead",{attrs:{value:e.inputValue,results:e.results,loading:e.loading,"no-results":e.noResults,type:e.type,placeholder:"Type a location"},on:{input:e.fetchResults,select:e.onSelect}},[e._t("default")],2)}),[],!1,null,null).exports;export{l as default};